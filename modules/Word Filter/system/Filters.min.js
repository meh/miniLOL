(function(){var b={};b.paths=[];b.filters=[];b.Filter=Class.create({initialize:function(a,c){this.type=a.getAttribute("type")||"censor";if(a.getAttribute("regexp"))this.regexp=eval(a.getAttribute("regexp"));else if(a.getAttribute("raw"))this.regexp=RegExp(a.getAttribute("raw"),"gi");this.to=this.type=="censor"?c||"@#!%$":this.type=="replace"?a.getAttribute("to")||"$1":"$1"},apply:function(a){return a.replace(this.regexp,this.to)},toString:function(){return"s/#{regexp}/#{to}/gi".interpolate(this)}});
b.apply=function(a){this.filters.each(function(c){a=c.apply(a)});return a};b.load=function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){var d=miniLOL.Document.check(c.responseXML);if(d)miniLOL.error("Error while parsing `#{filter}`\n\n#{error}".interpolate({filter:a,error:d}));else{var e=miniLOL.Document.fix(c.responseXML);e.xpath("/filters/filter").each(function(f){b.filters.push(new b.Filter(f,e.documentElement.getAttribute("censor")))});b.paths.push(a)}}})};b.reload=
function(){var a=b.paths;b.filters=[];b.paths=[];a.each(function(c){b.load(c)})};return b})();
