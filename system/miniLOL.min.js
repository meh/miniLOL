miniLOL={version:"1.2",initialize:function(){if(miniLOL.initialized)throw new Error("miniLOL has already been initialized.");miniLOL.initialized=false;miniLOL.path=location.href.match(/^(.*?)\/[^\/]*?(#|$)/)[1];miniLOL.resources={};miniLOL.tmp={};Event.observe(document,":go",miniLOL.tmp.fixScroll=function(){miniLOL.theme.content().scrollTo()});[function(){Event.observe(document,":resource.loaded",function(a){if(!(a.memo.resource.name!="miniLOL.config"||a.memo.arguments[0]!="resources/config.xml")){miniLOL.config.core||
(miniLOL.config.core={});if(!miniLOL.config.core.siteTitle)miniLOL.config.core.siteTitle="miniLOL #{version}".interpolate(miniLOL);if(!miniLOL.config.core.loadingMessage)miniLOL.config.core.loadingMessage="Loading...";if(miniLOL.config.core.homePage){if(miniLOL.config.core.homePage.charAt(0)!="#"&&!miniLOL.config.core.homePage.isURL())miniLOL.config.core.homePage="#"+miniLOL.config.core.homePage}else miniLOL.config.core.homePage="#home";if(!document.title)document.title=miniLOL.config.core.siteTitle}});
miniLOL.resource.set(new miniLOL.Resource("miniLOL.config",{initialize:function(){miniLOL.config=this.data},load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){if(!miniLOL.utils.checkXML(b.responseXML,a)){b=miniLOL.utils.fixDOM(b.responseXML).documentElement;var c=b.getAttribute("domain")||"core";miniLOL.config[c]=Object.extend(miniLOL.config[c]||{},Element.toObject(b))}}.bind(this),onFailure:function(b){miniLOL.error("miniLOL.config: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,
status:b.status,statusText:b.statusText}),true)}});if(miniLOL.error())return false;return true},clear:function(){this.data=miniLOL.config={}}}));miniLOL.resource.get("miniLOL.config").load("resources/config.xml");$(document.body).update(miniLOL.config.core.loadingMessage)},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.menus",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){if(!miniLOL.utils.checkXML(b.responseXML,a)){b=miniLOL.utils.fixDOM(b.responseXML);
miniLOL.menus["default"]=b.getElementById("default");$A(b.documentElement.childNodes).each(function(c){if(c.nodeType==Node.ELEMENT_NODE){var d=c.getAttribute("id");if(!d&&!miniLOL.menus["default"])miniLOL.menus["default"]=c;else miniLOL.menus[d]=c}});miniLOL.menus["default"]||miniLOL.error("Error while analyzing menus.xml\n\nNo default menu was found.",true)}}});if(miniLOL.error())return false;return true},clear:function(){this.data=miniLOL.menus={}}}));miniLOL.resource.get("miniLOL.menus").load("resources/menus.xml")},
function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.pages",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){miniLOL.utils.checkXML(b.responseXML,a)||miniLOL.utils.fixDOM(b.responseXML).xpath("//page").each(function(c){var d=c.getAttribute("id");delete miniLOL.pages.cache[d];miniLOL.pages.data[d]=c})},onFailure:function(b){miniLOL.error("miniLOL.pages: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:b.status,statusText:b.statusText},
true))}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.pages=this.data={data:{},cache:{}}}}));miniLOL.utils.exists("resources/pages.xml")&&miniLOL.resource.get("miniLOL.pages").load("resources/pages.xml")},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.functions",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){miniLOL.utils.checkXML(b.responseXML,a)||miniLOL.utils.fixDOM(b.responseXML).xpath("//function").each(function(c){try{miniLOL.functions[c.getAttribute("name")]=
new Function("var text = arguments[0]; var args = arguments[1]; arguments = args; #{code}; return text;".interpolate({code:c.firstChild.nodeValue}))}catch(d){miniLOL.error("Error while creating `#{name}` wrapper from #{path}:\n\n#{error}".interpolate({name:c.getAttribute("name"),path:a,error:d.toString()}),true)}})},onFailure:function(b){miniLOL.error("miniLOL.functions: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:b.status,statusText:b.statusText}),true)}});
if(miniLOL.error())return false;return true},clear:function(){miniLOL.functions=this.data={}},render:function(a,b,c){a.split(/\s*,\s*/).each(function(d){if(Object.isFunction(this.data[d]))b=this.data[d](b,c)},this);return b}}));miniLOL.resource.get("miniLOL.functions").load("resources/functions.xml")},function(){$$("link").each(function(a){miniLOL.theme.style.list[a.getAttribute("href")]=a});if(miniLOL.config.core.theme){miniLOL.error(!miniLOL.theme.load(miniLOL.config.core.theme));miniLOL.theme.template.menu()}else miniLOL.error(!miniLOL.theme.deprecated())},
function(){miniLOL.menu.enabled()&&miniLOL.menu.set(miniLOL.config.core.loadingMessage)},function(){miniLOL.content.set("Loading modules...");miniLOL.resource.set(new miniLOL.Resource("miniLOL.modules",{load:function(a,b){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.utils.checkXML(c.responseXML,a)){miniLOL.module.path=c.responseXML.documentElement.getAttribute("path")||"modules";var d=miniLOL.utils.fixDOM(c.responseXML).xpath("//module").filter(function(e){return e.getAttribute("name")});
d.each(function(e,g){b&&miniLOL.content.set("Loading `#{name}`... [#{number}/#{total}]".interpolate({name:e.getAttribute("name"),number:g+1,total:d.length}));miniLOL.module.load(e.getAttribute("name"))||miniLOL.error(true);if(miniLOL.error())throw $break;},this)}},onFailure:function(c){miniLOL.error("Error while loading modules.xml (#{status} - #{statusText})".interpolate(c),true)}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.modules=this.data={}}}));miniLOL.resource.get("miniLOL.modules").load("resources/modules.xml",
true)},function(){miniLOL.menu.enabled()&&miniLOL.menu.change("default")},function(){miniLOL.content.set("Checking dependencies...");try{miniLOL.module.dependencies.check()}catch(a){miniLOL.error("`#{module}` requires `#{require}`".interpolate(a),true)}}].each(function(a){try{a()}catch(b){miniLOL.error(b.toString(),true)}if(miniLOL.error())throw $break;});if(miniLOL.error()){document.body.innerHTML||miniLOL.error("Something went wrong, but nobody told me what :(",true);return false}miniLOL.config.core.initialization&&
eval(miniLOL.config.core.initialization);miniLOL.go(/[#?]./.test(location.href)?location.href.replace(/^.*[#?]/,"#"):miniLOL.config.core.homePage);Event.observe(document,":refresh",function(){miniLOL.resource.reload()});new PeriodicalExecuter(function(){Event.fire(document,":refresh")},miniLOL.config.core.refreshEvery||360);Event.fire(document,":initialized");Event.stopObserving(document,":initialized");miniLOL.initialized=true},error:function(a,b,c){if(miniLOL.error.major)return true;if(Object.isUndefined(a))return Boolean(miniLOL.error.major);
if(Object.isBoolean(a))return miniLOL.error.major=a;c=c||miniLOL.theme.content()||document.body;$(c).update("<pre>"+a.replace(/<br\/>/g,"\n").escapeHTML()+"</pre>");if(b)miniLOL.error.major=true;Event.fire(document,":error",{text:a,element:c,major:b})},content:{set:function(a){a={content:a};Event.fire(document,":content.set",a);miniLOL.theme.content().update(a.content)},get:function(){return miniLOL.theme.content().innerHTML}},resource:{set:function(a,b){if(Object.isString(a))miniLOL.resources[a]=
b;else miniLOL.resources[a.name]=a},get:function(a){return miniLOL.resources[a]},reload:function(a){if(Object.isArray(a))a.each(function(c){miniLOL.resource.get(c).reload()});else if(Object.isString(a))miniLOL.resource.get(name).reload();else for(var b in miniLOL.resources)b.reload()}},theme:{style:{list:{},load:function(a,b,c){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.load",{name:a,path:b,overload:Boolean(c)});if(miniLOL.theme.style.exists(a,
b))if(c)miniLOL.theme.style.unload(miniLOL.theme.style.list[a],b);else return true;a="#{path}/#{style}.css".interpolate({path:b,style:a});b=miniLOL.utils.includeCSS(a);if(!b)return false;miniLOL.theme.style.list[a]=b;return true},unload:function(a,b){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.unload",{name:a,path:b});var c="#{path}/#{style}.css".interpolate({path:b,style:a});if(miniLOL.theme.style.list[c]){miniLOL.theme.style.list[c].remove();
delete miniLOL.theme.style.list[c]}},exists:function(a,b){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});return Boolean(miniLOL.theme.style.list["#{path}/#{style}.css".interpolate({path:b,style:a})])}},template:{load:function(a,b,c){if(!b&&!miniLOL.theme.name)return 0;b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.template.load",{name:a,path:b});var d="#{path}/#{name}.xml".interpolate({path:b,
name:a});if(!c&&!Object.isUndefined(miniLOL.theme.template.cache[d]))return miniLOL.theme.template.cache[d];new Ajax.Request(d,{method:"get",asynchronous:false,onSuccess:function(e){miniLOL.utils.checkXML(e.responseXML,d)||(miniLOL.theme.template.cache[d]=miniLOL.utils.fixDOM(e.responseXML))},onFailure:function(){miniLOL.theme.template.cache[d]=false}});if(miniLOL.error())return false;return miniLOL.theme.template.cache[d]},menu:function(){return miniLOL.theme.templates.menu},exists:function(a,b){return Boolean(miniLOL.theme.template.load(a,
b))},clearCache:function(){miniLOL.theme.template.cache={};miniLOL.theme.templates={};miniLOL.theme.templates.list={};miniLOL.theme.templates.list["default"]={global:"<div #{attributes}>#{data}</div>",before:"#{data}",after:"#{data}",link:'<div class="#{class}" id="#{id}">#{before}<a href="#{href}" target="#{target}" #{attributes}>#{text}</a>#{after}</div>',item:'<div class="#{class}" id="#{id}">#{before}<span #{attributes}>#{text}</span>#{after}</div>',nest:'<div class="#{class}" style="#{style}">#{data}</div>',
data:'<div class="data">#{before}#{data}#{after}</div>'};miniLOL.theme.templates.list.table={global:"<table #{attributes}>#{data}</table>",before:"#{data}",after:"#{data}",link:'<tr><td>#{before}</td><td><a href="#{href}" target="#{target}" #{attributes}>#{text}</a></td><td>#{after}</td></tr>',item:"<tr><td>#{before}</td><td>#{text}</td><td>#{after}</td></tr>",nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'}}},load:function(a,b,c){miniLOL.theme.unload();
var d=miniLOL.theme.path,e=miniLOL.theme.name,g=a.match(/^(.+?):(.+)$/);if(g){miniLOL.theme.path=g[1];miniLOL.theme.name=g[2]}else{miniLOL.theme.path="themes";miniLOL.theme.name=a}if(miniLOL.theme.name==e&&miniLOL.theme.path==d)return true;g="#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:a});Event.fire(document,":theme.load",{name:a,runtime:Boolean(b)});var l;new Ajax.Request("#{path}/theme.xml".interpolate({path:g,theme:a}),{method:"get",asynchronous:false,onSuccess:function(k){var i=
miniLOL.theme.information={};k=miniLOL.utils.fixDOM(k.responseXML);i.name=k.documentElement.getAttribute("name")||"Unknown";i.author=k.documentElement.getAttribute("author")||"Anonymous";i.homepage=k.documentElement.getAttribute("homepage")||"";miniLOL.theme.menu.node=k.documentElement.getAttribute("menu")||"menu";miniLOL.theme.content.node=k.documentElement.getAttribute("content")||"body";try{var n=k.getElementsByTagName("initialize");miniLOL.theme.initialize=n.length?new Function(n[0].firstChild.nodeValue):
new Function}catch(h){l="An error occurred on the theme's initialize function:\n\n"+h.toString();return false}try{var f=k.getElementsByTagName("finalize");miniLOL.theme.finalize=f.length?new Function(f[0].firstChild.nodeValue):new Function}catch(j){l="An error occurred on the theme's finalize function:\n\n"+j.toString();return false}i.styles=[];k.xpath("/theme/styles/style").each(function(m){i.styles.push(m.getAttribute("name"))});k.xpath("/theme/templates/*").each(function(m){miniLOL.theme.templates[m.nodeName]=
Element.toObject(m)},this)},onFailure:function(){l="Could not load theme's information."}});if(l){miniLOL.error(l,true);return false}new Ajax.Request("#{path}/template.html".interpolate({path:g,theme:a}),{method:"get",asynchronous:false,onSuccess:function(k){$(document.body).update(k.responseText)},onFailure:function(){l="Could not load template.html."}});if(l){miniLOL.error(l,true);return false}miniLOL.theme.information.styles.each(function(k){if(!miniLOL.theme.style.load(k,false,true)){miniLOL.error("Couldn't load `#{style}` style/".interpolate({style:k}),
true);throw $break;}});if(miniLOL.error())return false;if(b&&miniLOL.initialized){miniLOL.menu.change(miniLOL.menu.current,true);miniLOL.go(location.href)}miniLOL.theme.tmp={};!c&&miniLOL.theme.initialize&&miniLOL.theme.initialize.call(miniLOL.theme.tmp);Event.fire(document,":theme.loaded",{name:a,runtime:Boolean(b)});return true},unload:function(a){miniLOL.theme.template.clearCache();if(miniLOL.theme.name){Event.fire(document,":theme.unload",{name:miniLOL.theme.name});if(!a&&miniLOL.theme.finalize)miniLOL.theme.finalize.call(miniLOL.theme.tmp||
{});delete miniLOL.theme.tmp;$A(miniLOL.theme.information.styles).each(function(b){miniLOL.theme.style.unload(b)});delete miniLOL.theme.name;delete miniLOL.theme.initialize;delete miniLOL.theme.finalize;delete miniLOL.theme.information}},content:function(){return $(miniLOL.theme.content.node)},menu:function(){return $(miniLOL.theme.menu.node)},deprecated:function(){miniLOL.theme.path="themes";miniLOL.theme.content.node=miniLOL.config.core.contentNode||"body";miniLOL.theme.menu.node=miniLOL.config.core.menuNode||
"menu";miniLOL.theme.template.clearCache();new Ajax.Request("resources/template.html",{method:"get",asynchronous:false,onSuccess:function(a){$(document.body).update(a.responseText)},onFailure:function(){$(document.body).update('<div id="menu"></div><div id="body"></div>')}});miniLOL.utils.includeCSS("resources/style.css");miniLOL.theme.template.clearCache();return true}},menu:{set:function(a){miniLOL.menu.enabled()&&miniLOL.theme.menu().update(a)},get:function(a,b){b=b||0;if(!miniLOL.menu.enabled())return"";
a=a||"default";if(!miniLOL.menu.exists(a))return null;return miniLOL.menu.parse(miniLOL.menus[a],b)},change:function(a,b){if(!(a==miniLOL.menu.current&&!b)){var c=miniLOL.menu.get(a);if(c){miniLOL.menu.set(c);miniLOL.menu.current=a}else{c="The menu `#{name}` doesn't exist.".interpolate({name:a});miniLOL.error(c,true);return c}Event.fire(document,":menu.change",miniLOL.menus[a])}},enabled:function(){return Boolean(miniLOL.menus["default"])},exists:function(a){return Boolean(miniLOL.menus[a])},parse:function(a,
b){b=b||0;var c=miniLOL.theme.template.menu();if(!c||!a)if(miniLOL.error())return false;var d=true,e="";$A(a.childNodes).each(function(g){switch(g.nodeType){case Node.ELEMENT_NODE:e+=g.nodeName=="menu"?miniLOL.menu.parsers.layer(c,b).menu.interpolate({data:miniLOL.menu.parse(g,b)}):g.nodeName=="item"?miniLOL.menu.parsers.item(g,c,b):miniLOL.menu.parsers.other(g,c);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:d||(e+=g.nodeValue);d=false;break}});return e.isEmpty()?"":b==0?miniLOL.menu.parsers.layer(c,
b).menu.interpolate({data:e}):e},parsers:{layer:function(a,b){var c={menu:"",item:""};if(a){c=Object.extend(c,a.layers["_"+b]||a.layers["default"]||{});if(!c.menu)c.menu="#{data}";if(!c.item)c.item='<a href="#{href}" #{attributes}>#{text}</a> '}return c},item:function(a,b,c){var d=a.cloneNode(true),e=d.getAttribute("class")||"";d.removeAttribute("class");var g=d.getAttribute("id")||"";d.removeAttribute("id");var l=d.getAttribute("href")||"";d.removeAttribute("href");return miniLOL.menu.parsers.layer(b,
c).item.interpolate(Object.extend(Object.fromAttributes(d.attributes),{"class":e,id:g,href:l,attributes:String.fromAttributes(d.attributes),text:miniLOL.utils.getFirstText(a.childNodes),data:miniLOL.menu.parse(a,c+1)}))},other:function(a,b){if(!a||!b)return"";var c=b[a.nodeName];if(!c)return"";var d={};$A(a.childNodes).each(function(e){if(e.nodeType==Node.ELEMENT_NODE)d[e.nodeName]=miniLOL.menu.parsers.other(e,b)});d.text=miniLOL.utils.getFirstText(a.childNodes);return c.interpolate(Object.extend(d,
Object.fromAttributes(a.attributes)))}}},page:{get:function(a,b,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.get",{name:a,queries:b});var d=miniLOL.pages.data[a],e=b.type;if(!d){miniLOL.content.set("404 - Not Found");return false}if(d.getAttribute("alias")){typeof b[a]!="string"&&delete b[a];delete b.page;if(!b.title&&d.getAttribute("title"))b.title=encodeURIComponent(d.getAttribute("title"));if(b=Object.toQueryString(b))b="&"+b;d=d.getAttribute("alias");if(!d.isURL()&&
d.charAt(0)!="#")d="#"+d;return miniLOL.go(d+b)}if(Object.isUndefined(e))e=d.getAttribute("type");if(c){c={};Object.extend(c,miniLOL.config.core);Object.extend(c,b);document.title=(b.title||d.getAttribute("title")||miniLOL.config.core.siteTitle).interpolate(c)}if(miniLOL.pages.cache[a]){e?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(e,miniLOL.pages.cache[a],b)):miniLOL.content.set(miniLOL.pages.cache[a]);return true}if(c=d.getAttribute("arguments")){c=c.replace(/[ ,]+/g,"&amp;").toQueryParams();
for(var g in c)if(b[g]==null)b[g]=c[g]}d=miniLOL.page.parse(d);miniLOL.pages.cache[a]=d;if(e)d=miniLOL.resource.get("miniLOL.functions").render(e,d,b);miniLOL.content.set(d);return true},parse:function(a,b){var c="";$A(a.childNodes).each(function(d){switch(d.nodeType){case Node.ELEMENT_NODE:if(Object.isFunction(miniLOL.page.parsers[d.nodeName]))c+=miniLOL.page.parsers[d.nodeName](d,b);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:c+=d.nodeValue;break}});return c},parsers:{list:function(a,
b){var c=a.cloneNode(false);b=b||[a];var d=c.getAttribute("before")||b[0].getAttribute("before")||"";c.removeAttribute("before");var e=c.getAttribute("after")||b[0].getAttribute("after")||"";c.removeAttribute("after");var g=c.getAttribute("arguments")||b[0].getAttribute("arguments")||"";c.removeAttribute("arguments");var l=c.getAttribute("type")||b[0].getAttribute("type")||"";c.removeAttribute("type");var k=c.getAttribute("menu")||b[0].getAttribute("menu");c.removeAttribute("menu");var i=c.getAttribute("template");
c.removeAttribute("template");miniLOL.theme.templates.list[i]||(i="default");var n="";$A(a.childNodes).each(function(h){if(h.nodeType==Node.ELEMENT_NODE)if(h.nodeName=="link"){var f=h.cloneNode(true),j=f.getAttribute("href");f.removeAttribute("href");var m=f.getAttribute("target");f.removeAttribute("target");h=f.getAttribute("text")||(f.firstChild?f.firstChild.nodeValue:j);var q=f.getAttribute("before")||d||"";f.removeAttribute("before");var r=f.getAttribute("after")||e||"";f.removeAttribute("after");
var u=f.getAttribute("domain")||"";f.removeAttribute("domain");var s=f.getAttribute("arguments")||g;f.removeAttribute("arguments");var t=f.getAttribute("menu")||k;f.removeAttribute("menu");var o=f.getAttribute("title")||"";f.removeAttribute("title");var p=j.isURL(),v=f.getAttribute("class")||"";f.removeAttribute("class");var w=f.getAttribute("id")||"";f.removeAttribute("id");if(m||p){j=!p?"data/"+j:j;m=m||"_blank"}else{p=f.getAttribute("type")||l||"";f.removeAttribute("type");if(u=="in"||j.charAt(0)==
"#"){if(j.charAt(0)!="#")j="#"+j}else j="#page="+j;s=s?"&"+s.replace(/[ ,]+/g,"&amp;"):"";p=p?"&type="+p:"";t=miniLOL.menu.enabled()&&t?"&amp;menu="+t:"";m="";if(o){o=o.interpolate({text:h,href:j});o="&title="+encodeURIComponent(o)}j=j+s+p+t+o}n+=miniLOL.theme.templates.list[i].link.interpolate(Object.extend(Object.fromAttributes(f.attributes),{"class":v,id:w,attributes:String.fromAttributes(f.attributes),before:miniLOL.theme.templates.list[i].before.interpolate({data:q}),after:miniLOL.theme.templates.list[i].after.interpolate({data:r}),
href:j,target:m,text:h,title:o}))}else if(h.nodeName=="item"){f=h.cloneNode(true);h=f.getAttribute("text")||(f.firstChild?f.firstChild.nodeValue:"");q=f.getAttribute("before")||d||"";f.removeAttribute("before");r=f.getAttribute("after")||e||"";f.removeAttribute("after");j=f.getAttribute("class")||"";f.removeAttribute("class");m=f.getAttribute("id")||"";f.removeAttribute("id");n+=miniLOL.theme.templates.list[i].item.interpolate(Object.extend(Object.fromAttributes(f.attributes),{"class":j,id:m,attributes:String.fromAttributes(f.attributes),
before:miniLOL.theme.templates.list[i].before.interpolate({data:q}),after:miniLOL.theme.templates.list[i].after.interpolate({data:r}),text:h}))}else if(h.nodeName=="list")n+=miniLOL.page.parsers.list(h,[a]);else{if(h.nodeName=="nest"){toParse=h.cloneNode(true);q=h.getAttribute("before")||d||"";r=h.getAttribute("after")||e||"";n+=miniLOL.theme.templates.list[i].nest.interpolate({"class":h.getAttribute("class")||"",style:h.getAttribute("style")||"",before:miniLOL.theme.templates.list[i].before.interpolate({data:q}),
after:miniLOL.theme.templates.list[i].after.interpolate({data:r}),data:miniLOL.page.parse(toParse,[a])})}}else if(h.nodeType==Node.CDATA_SECTION_NODE||h.nodeType==Node.TEXT_NODE)h.nodeValue.isEmpty()||(n+=miniLOL.theme.templates.list[i].data.interpolate({data:h.nodeValue}))});return miniLOL.theme.templates.list[i].global.interpolate(Object.extend(Object.fromAttributes(c.attributes),{attributes:String.fromAttributes(c.attributes),data:n}))},include:function(a){a.cloneNode(false);var b=a.getAttribute("href");
a.removeAttribute("href");a.getAttribute("update");a.removeAttribute("update");var c=location.href.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/)[3],d=b.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/);d&&d[3]!=c&&'<iframe src="#{href}" #{attributes}></iframe>'.interpolate({href:b,attributes:Object.fromAttributes(a.attributes)});return""}},load:function(a,b,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.load",{path:a,queries:b});if(c)document.title=(b.title||miniLOL.config.core.siteTitle).interpolate(Object.extend(Object.extend({},
miniLOL.config.core),b));new Ajax.Request("data/#{path}?#{queries}".interpolate({path:a,queries:Object.toQueryString(b)}),{method:"get",onSuccess:function(d){b.type?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(b.type,d.responseText,b)):miniLOL.content.set(d.responseText);Event.fire(document,":page.loaded",d);Event.fire(document,":go",c)},onFailure:function(d){miniLOL.content.set("#{status} - #{statusText}".interpolate(d));Event.fire(document,":page.loaded",d)}})}},module:{create:function(a,
b){if(!b){miniLOL.error("Like, do I know how this module is done?",true);return false}b.name=a;b.root="#{path}/#{module}".interpolate({path:miniLOL.module.path,module:a});if(!b.type)b.type="active";if(!b.execute)b.execute=new Function;for(var c in b)if(Object.isFunction(b[c]))b[c]=b[c].bind(b);if(b.initialize)try{if(b.initialize()===false){if(miniLOL.error())return false;throw new Error("An error occurred while initializing the module.");}}catch(d){d.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,
path:miniLOL.module.path,module:a});throw d;}miniLOL.modules[a]=b;$A(b.aliases).each(function(e){miniLOL.modules[e]=b});Event.fire(document,":module.create",b)},execute:function(a,b,c){if(!a){miniLOL.error("What module should be executed?");return false}if(!miniLOL.module.exists(a)){c&&miniLOL.error("The module `#{name}` isn't loaded.".interpolate({name:a}),true);return false}if(c){miniLOL.content.set(miniLOL.config.core.loadingMessage);c={};Object.extend(c,miniLOL.config.core);Object.extend(c,b);
document.title=(b.title||miniLOL.module.get(a).title||miniLOL.config.core.siteTitle).interpolate(c)}b=Object.isArray(b)?b:[b];Event.fire(document,":module.execute",{name:a,arguments:b});var d;try{d=miniLOL.module.get(a).execute.apply(miniLOL.module.get(a),b)}catch(e){e.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,module:a});miniLOL.error("An error occurred while executing the module `#{name}`\n\n#{file} @ #{line}:\n#{error}".interpolate({name:a,
file:e.fileName,line:e.lineNumber,error:e.toString()}),true);return false}Event.fire(document,":module.executed",{name:a,arguments:b,result:d});if(Object.isUndefined(d))d=true;return d},load:function(a){Event.fire(document,":module.load",a);try{try{miniLOL.utils.require("#{path}/#{module}/main.min.js".interpolate({path:miniLOL.module.path,module:a}))}catch(b){if(b.http)miniLOL.utils.require("#{path}/#{module}/main.js".interpolate({path:miniLOL.module.path,module:a}));else throw b;}if(miniLOL.error())return false;
if(!miniLOL.module.exists(a))throw new Error("Something went wrong while loading the module `#{name}`.".interpolate({name:a}));Event.fire(document,":module.loaded",a);return true}catch(c){miniLOL.error("An error occurred while loading the module `#{name}`\n\n#{root}/#{file} @ #{line}:\n\n#{error}".interpolate({name:a,root:miniLOL.path,file:c.fileName,line:c.lineNumber,error:c.toString()}),true);return false}},get:function(a){return miniLOL.modules[a]},exists:function(a){return Boolean(miniLOL.module.get(a))},
dependencies:{check:function(){for(var a in miniLOL.modules){var b=miniLOL.module.get(a).dependencies;if(b)for(var c=0;c<b.length;c++)if(!miniLOL.module.get(b[c]))throw{module:a,require:b[c]};}return true},needs:function(a,b,c,d){miniLOL.module.get(a)?b.call(c||window):setTimeout(function(){miniLOL.module.dependencies.needs(a,b,c)},d||10)}}},go:function(a,b){if(a.isURL()){if(!a.startsWith(miniLOL.path))location.href=a}else if(a.charAt(0)!="#")a="#"+a;var c=a.toQueryParams(),d=a.match(/#(([^=&]*)&|([^=&]*)$)/),
e=false;c.menu&&miniLOL.menu.change(c.menu);if(d){c.page=d[2]||d[3];if(c.page)e=miniLOL.page.get(c.page,c,a);else b||(e=miniLOL.go("#{page}&#{queries}".interpolate({page:miniLOL.config.core.homePage,queries:Object.toQueryString(c)}),true))}else if(c.module)e=miniLOL.module.execute(c.module,c,true);else if(c.page){d=c.page;delete c.page;miniLOL.page.load(d,c,a)}else e=miniLOL.go(miniLOL.config.core.homePage);e&&Event.fire(document,":go",a);return e},utils:{getElementById:function(a){var b;$A(this.getElementsByTagName("*")).each(function(c){if(c.getAttribute("id")==
a){b=c;throw $break;}});return b},xpath:function(a){var b=[];if(Prototype.Browser.IE){a=this.real.selectNodes(a);for(var c=0;c<a.length;c++)b.push(a.item(c))}else{a=this.evaluate(a,this,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(c=0;c<a.snapshotLength;c++)b.push(a.snapshotItem(c))}return b},fixDOM:function(a){if(a){if(Prototype.Browser.IE){a={real:a};a.documentElement=a.real.documentElement;a.getElementsByTagName=function(b){return this.real.getElementsByTagName(b)};a.getElementById=function(b){return miniLOL.utils.getElementById.call(this.real,
b)};a.real.setProperty("SelectionLanguage","XPath")}else if(!Prototype.Browser.Good)a.getElementById=miniLOL.utils.getElementById;a.xpath=miniLOL.utils.xpath;return a}},checkXML:function(a,b){var c=false;a||(c="There's a syntax error.");if(a.documentElement.nodeName=="parsererror")c=a.documentElement.textContent;if(b&&c){miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:b,error:c}),true);return c}return c},getFirstText:function(a){var b="";(Object.isArray(a)?a:$A(a)).each(function(c){switch(c.nodeType){case Node.ELEMENT_NODE:throw $break;
case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(!c.nodeValue.isEmpty()){b=c.nodeValue.strip();throw $break;}break}});return b},exists:function(a){var b=false;new Ajax.Request(a,{method:"head",asynchronous:false,onSuccess:function(){b=true}});return b},includeCSS:function(a){var b;if(b=miniLOL.theme.style.list[a])return b;else if(b=$$("link").find(function(c){return c.getAttribute("href")==a}))return miniLOL.theme.style.list[a]=b;else if(b=miniLOL.utils.exists(a)){b=new Element("link",{rel:"stylesheet",
href:a,type:"text/css"});$$("head")[0].insert(b);Event.fire(document,":css.include",a);return b}else return false},css:function(a){a=(new Element("style",{type:"text/css"})).update(a);$$("head").first().appendChild(a);Event.fire(document,":css.create",a);return a},execute:function(a){var b,c;new Ajax.Request(a,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(d){try{b=window.eval(d.responseText)}catch(e){c=e;c.fileName=a;c.lineNumber-=5}},onFailure:function(d){c=new Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,
status:d.status,statusText:d.statusText}));c.fileName=a;c.lineNumber=0}});if(c)throw c;return b},include:function(a){var b=false;new Ajax.Request(a,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(c){try{window.eval(c.responseText);b=true}catch(d){b=false}}});return b},require:function(a){var b=false;new Ajax.Request(a,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(c){try{window.eval(c.responseText)}catch(d){b=d;b.fileName=a;b.lineNumber-=5}},onFailure:function(c){b=
new Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,status:c.status,statusText:c.statusText}));b.fileName=a;b.lineNumber=0;b.http={status:c.status,text:c.statusText}}});if(b)throw b;return true}}};
miniLOL.Resource=Class.create({initialize:function(a,b){if(!b)throw new Error("No wrapper has been passed.");this.name=a;this.wrapper=b;if(!this.wrapper.clear)this.wrapper.clear=function(){this.data={}};for(var c in this.wrapper){if(Object.isFunction(this.wrapper[c])){if(this.wrapper[c].parent==this.wrapper)break;this.wrapper[c]=this.wrapper[c].bind(this.wrapper);this.wrapper[c].parent=this.wrapper}if(Object.isUndefined(this[c]))this[c]=this.wrapper[c]}this.clear();this.flush();this.wrapper.initialize&&
this.wrapper.initialize()},load:function(){var a,b=$A(arguments);Event.fire(document,":resource.load",{resource:this,arguments:b});this.calls.push(b);try{a=this.wrapper.load.apply(this.wrapper,b)}catch(c){miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this.name,error:c.toString()}));return false}Event.fire(document,":resource.loaded",{resource:this,arguments:b});return a},reload:function(){Event.fire(document,":resource.reload",{resource:this});this.wrapper.clear();
this.flush().each(function(a){this.load.apply(this,a)},this);Event.fire(document,":resource.reloaded",{resource:this})},clear:function(){Event.fire(document,":resource.clear",{resource:this});this.wrapper.clear()},flush:function(a){Event.fire(document,":resource.flush",{resource:this,call:a});var b;if(Object.isArray(a)){if(b=this.calls.find(function(c){if(c.length!=a.length)return false;for(var d=false,e=0;e<c.length;e++){if(a[e]==c[e])d=true;if(!d)break}return d}))this.calls=this.calls.filter(function(c){return c!=
b})}else{b=this.calls;this.calls=[]}return b},data:function(){return this.wrapper.data}});unFocus.History.addEventListener("historyChange",function(a){a?miniLOL.go(a):miniLOL.go(miniLOL.config.core.homePage)});if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=true;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=true;if(Prototype.Browser.Gecko||Prototype.Browser.Opera)Prototype.Browser.Good=true;else Prototype.Browser.Bad=true;
if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:(this.stack||"").replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,
"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};Function.prototype.clone=Prototype.Browser.IE?function(){var a=this.toString();return new Function(a.substring(a.indexOf("{")+1,a.lastIndexOf("}")))}:function(){return eval("("+this.toString().replace(/^function .*?\(/,"function (")+")")};
Object.extend(Object,{isBoolean:function(a){return a.constructor===Boolean},fromAttributes:function(a){for(var b={},c=0;c<a.length;c++)b[a.item(c).nodeName]=a.item(c).nodeName;return b},toQueryString:function(a){var b="";for(var c in a)b+="#{name}=#{value}&".interpolate({name:c,value:a[c]});return b.substr(0,b.length-1)}});
if(!Object.isFunction(Object.defineProperty))Object.defineProperty=function(a,b,c){Object.isFunction(c.get)&&Object.isFunction(a.__defineGetter__)&&a.__defineGetter__(b,c.get);Object.isFunction(c.set)&&Object.isFunction(a.__defineSetter__)&&a.__defineSetter__(b,c.set)};if(!Object.isFunction(Object.defineProperties))Object.defineProperties=function(a,b){for(var c in b)Object.defineProperty(a,c,b[c])};
if(!Object.isFunction(Object.create))Object.create=function(a,b){var c=new Object(a);Object.defineProperties(c,b);return c};Object.extend(String,{fromAttributes:function(a){for(var b="",c=0;c<a.length;c++)b+='#{name}="#{value}" '.interpolate({name:a.item(c).nodeName,value:a.item(c).nodeValue});return b}});
Object.extend(String.prototype,{toQueryParams:function(){var a={},b=this.match(/[?#](.*)$/);if(!b)return a;b=b[1].split(/&/);for(var c=0;c<b.length;c++){var d=b[c].split(/=/),e=decodeURIComponent(d[0]);a[e]=d[1]?decodeURIComponent(d[1]):true}return a},isEmpty:function(){return this==0},isURL:function(){var a=this.match(/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/);if(a)return{protocol:"mailto",uri:a[1]};a=this.match(/^(\w+):(\/\/.+?(:\d)?)(\/)?/);if(!a)return false;return{protocol:a[1],uri:a[2]}}});
Element.addMethods({load:function(a,b){if(b&&!Object.isUndefined(b.frequency))new Ajax.PeriodicalUpdater(this,a,b);else new Ajax.Updater(this,a,b)},getTextDescendants:function(a){function b(d){for(d=d.firstChild;d;){Node.TEXT_NODE==d.nodeType&&c.push(d);Object.isElement(d)&&b(d);d=d.nextSibling}}var c=[];b(a);return c},toObject:function(a){var b={};$A((a||this).childNodes).each(function(c){if(c.nodeType==Node.ELEMENT_NODE)if(c.getElementsByTagName("*").length==0){var d="";$A(c.childNodes).each(function(e){e.nodeType!=
Node.CDATA_SECTION_NODE&&e.nodeType!=Node.TEXT_NODE||e.nodeValue.isEmpty()||(d+=e.nodeValue)});b[c.nodeName]=d}else b[c.nodeName]=Element.toObject(c)});return b}});
