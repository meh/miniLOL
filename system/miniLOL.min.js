/* miniLOL is released under AGPLv3. Copyleft meh. [http://meh.doesntexist.org | meh@paranoici.org] */
miniLOL={version:"1.2",initialize:function(){if(miniLOL.initialized)throw Error("miniLOL has already been initialized.");miniLOL.Template.Engine.load("system/templates/HAML.js",{minified:true});miniLOL.initialized=false;miniLOL.path=location.href.match(/^\w+:\/\/.*?(\/.*?)(#|$)/)[1];miniLOL.storage=new miniLOL.Storage("miniLOL.core");miniLOL.resources={};miniLOL.tmp={};[function(){Event.observe(document,":resource.loaded",function(a){if(!(a.memo.resource.name!="miniLOL.config"||a.memo.arguments[0]!=
"resources/config.xml")){miniLOL.config.core||(miniLOL.config.core={});if(!miniLOL.config.core.siteTitle)miniLOL.config.core.siteTitle="miniLOL #{version}".interpolate(miniLOL);if(!miniLOL.config.core.loadingMessage)miniLOL.config.core.loadingMessage="Loading...";if(miniLOL.config.core.homePage){if(miniLOL.config.core.homePage.charAt(0)!="#"&&!miniLOL.config.core.homePage.isURL())miniLOL.config.core.homePage="#"+miniLOL.config.core.homePage}else miniLOL.config.core.homePage="#home";$("__miniLOL.core.style")&&
$("__miniLOL.core.style").remove();miniLOL.config.core.style&&miniLOL.CSS.create(miniLOL.config.core.style,"__miniLOL.core.style");if(!document.title)document.title=miniLOL.config.core.siteTitle}});miniLOL.resource.set(new miniLOL.Resource("miniLOL.config",{initialize:function(){miniLOL.config=this.data},load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){if(!miniLOL.Document.check(b.responseXML,a)){var b=miniLOL.Document.fix(b.responseXML).documentElement,c=
b.getAttribute("domain")||"core";miniLOL.config[c]=Object.extend(miniLOL.config[c]||{},Element.toObject(b))}},onFailure:function(b){miniLOL.error("miniLOL.config: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:b.status,statusText:b.statusText}),true)}});return miniLOL.error()?false:true},clear:function(){this.data=miniLOL.config={}}}));miniLOL.resource.get("miniLOL.config").load("resources/config.xml");$(document.body).update(miniLOL.config.core.loadingMessage);
Event.fire(document,":initialization");Event.stopObserving(document,":initialization")},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.menus",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){miniLOL.Document.check(b.responseXML,a)||(b=miniLOL.Document.fix(b.responseXML),miniLOL.menus["default"]=b.getElementById("default"),$A(b.documentElement.childNodes).each(function(a){if(a.nodeType==Node.ELEMENT_NODE){var b=a.getAttribute("id");!b&&!miniLOL.menus["default"]?
miniLOL.menus["default"]=a:miniLOL.menus[b]=a}}),miniLOL.menus["default"]||miniLOL.error("Error while analyzing menus.xml\n\nNo default menu was found.",true))}});return miniLOL.error()?false:true},clear:function(){this.data=miniLOL.menus={}}}));miniLOL.resource.get("miniLOL.menus").load("resources/menus.xml")},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.pages",{load:function(a,b){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){miniLOL.Document.check(c.responseXML,
a)||miniLOL.Document.fix(c.responseXML).xpath("//page").each(function(a){var c=a.getAttribute("id");delete miniLOL.pages.cache[c];miniLOL.pages.data[c]=a})},onFailure:function(c){b||miniLOL.error("miniLOL.pages: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:c.status,statusText:c.statusText},true))}});return miniLOL.error()?false:true},clear:function(){miniLOL.pages=this.data={data:{},cache:{}}}}));miniLOL.resource.get("miniLOL.pages").load("resources/pages.xml",
true)},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.functions",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){miniLOL.Document.check(b.responseXML,a)||miniLOL.Document.fix(b.responseXML).xpath("//function").each(function(c){try{miniLOL.functions[c.getAttribute("name")]=new Function("var text = arguments[0]; var args = arguments[1]; arguments = args; #{code}; return text;".interpolate({code:c.firstChild.nodeValue}))}catch(b){miniLOL.error("Error while creating `#{name}` wrapper from #{path}:\n\n#{error}".interpolate({name:c.getAttribute("name"),
path:a,error:b.toString()}),true)}})},onFailure:function(b){miniLOL.error("miniLOL.functions: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:b.status,statusText:b.statusText}),true)}});return miniLOL.error()?false:true},clear:function(){miniLOL.functions=this.data={}},render:function(a,b,c){a.split(/\s*,\s*/).each(function(a){Object.isFunction(this.data[a])&&(b=this.data[a](b,c))},this);return b}}));miniLOL.resource.get("miniLOL.functions").load("resources/functions.xml")},
function(){miniLOL.config.core.theme?miniLOL.error(!miniLOL.theme.load(miniLOL.config.core.theme)):miniLOL.error(!miniLOL.theme.deprecated())},function(){miniLOL.menu.enabled()&&miniLOL.menu.set(miniLOL.config.core.loadingMessage)},function(){miniLOL.content.set("Loading modules...");miniLOL.resource.set(new miniLOL.Resource("miniLOL.modules",{load:function(a,b){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.Document.check(c.responseXML,a)){miniLOL.module.path=
c.responseXML.documentElement.getAttribute("path")||"modules";var d=miniLOL.Document.fix(c.responseXML).xpath("//module").filter(function(a){return a.getAttribute("name")});d.each(function(a,c){b&&miniLOL.content.set("Loading `#{name}`... [#{number}/#{total}]".interpolate({name:a.getAttribute("name"),number:c+1,total:d.length}));miniLOL.module.load(a.getAttribute("name"))||miniLOL.error(true);if(miniLOL.error())throw $break;},this)}},onFailure:function(a){miniLOL.error("Error while loading modules.xml (#{status} - #{statusText})".interpolate(a),
true)}});return miniLOL.error()?false:true},clear:function(){miniLOL.modules=this.data={}}}));miniLOL.resource.get("miniLOL.modules").load("resources/modules.xml",true)},function(){miniLOL.menu.enabled()&&miniLOL.menu.change("default")},function(){miniLOL.content.set("Checking dependencies...");try{miniLOL.module.dependencies.check()}catch(a){miniLOL.error("`#{module}` requires `#{require}`".interpolate(a),true)}}].each(function(a){try{a()}catch(b){miniLOL.error(b.toString(),true)}if(miniLOL.error())throw $break;
});if(miniLOL.error())return false;Event.observe(document,"unload",function(a){Event.fire(document,":finalization",a)});Event.observe(document,":url.change",function(a){a.stopped||(a.memo?miniLOL.go(a.memo):miniLOL.go(miniLOL.config.core.homePage))});Event.observe(document,":go",miniLOL.tmp.fixScroll=function(){$(document.body).scrollTo()});miniLOL.config.core.initialization&&eval(miniLOL.config.core.initialization);miniLOL.go(/[#?]./.test(location.href)?location.href.replace(/^.*[#?]/,"#"):miniLOL.config.core.homePage);
Event.observe(document,":refresh",function(){miniLOL.resource.reload("miniLOL.config","miniLOL.pages","miniLOL.menus")});new PeriodicalExecuter(function(){Event.fire(document,":refresh")},miniLOL.config.core.refreshEvery||360);Event.fire(document,":initialized");Event.stopObserving(document,":initialized");miniLOL.initialized=true},error:function(a,b,c){if(miniLOL.error.major)return true;if(Object.isUndefined(a))return Boolean(miniLOL.error.major);if(Object.isBoolean(a))return miniLOL.error.major=
a;if(!miniLOL.error.done){c=c||miniLOL.theme.content()||document.body;$(c).update("<pre>"+a.replace(/<br\/>/g,"\n").escapeHTML()+"</pre>");miniLOL.error.done=true;if(b)miniLOL.error.major=true;Event.fire(document,":error",{text:a,element:c,major:b})}},content:{set:function(a){a={content:a};Event.fire(document,":content.set",a);miniLOL.theme.content().update(a.content)},get:function(){return miniLOL.theme.content().innerHTML}},resource:{set:function(a,b){Object.isString(a)?miniLOL.resources[a]=b:miniLOL.resources[a.name]=
a},get:function(a){return miniLOL.resources[a]},reload:function(a){arguments.length>1&&(a=$A(arguments));if(Object.isArray(a))a.each(function(a){miniLOL.resource.get(a).reload()});else if(Object.isString(a))miniLOL.resource.get(name).reload();else for(var b in miniLOL.resources)miniLOL.resource.get(b).reload()}},theme:{style:{list:{},load:function(a,b,c){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.load",{name:a,path:b,overload:Boolean(c)});
if(miniLOL.theme.style.exists(a,b))if(c)miniLOL.theme.style.unload(miniLOL.theme.style.list[a],b);else return true;a="#{path}/#{style}.css".interpolate({path:b,style:a});b=miniLOL.CSS.include(a,true);if(!b)return false;miniLOL.theme.style.list[a]=b;return true},unload:function(a,b){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.unload",{name:a,path:b});var c="#{path}/#{style}.css".interpolate({path:b,style:a});miniLOL.theme.style.list[c]&&
(miniLOL.theme.style.list[c].remove(),delete miniLOL.theme.style.list[c])},exists:function(a,b){b=b||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});return Boolean(miniLOL.theme.style.list["#{path}/#{style}.css".interpolate({path:b,style:a})])}},template:{initialize:function(){miniLOL.theme.templates={}},setDefaults:function(){if(!miniLOL.theme.templates.list)miniLOL.theme.templates.list={};miniLOL.theme.templates.list["default"]=Object.extend({global:"<div #{attributes}>#{data}</div>",
before:"#{data}",after:"#{data}",link:'<div class="#{class}" id="#{id}">#{before}<a href="#{href}" target="#{target}" #{attributes}>#{text}</a>#{after}</div>',item:'<div class="#{class}" id="#{id}">#{before}<span #{attributes}>#{text}</span>#{after}</div>',nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'},miniLOL.theme.templates.list["default"]||{});miniLOL.theme.templates.list.table=Object.extend({global:"<table #{attributes}>#{data}</table>",
before:"#{data}",after:"#{data}",link:'<tr><td>#{before}</td><td><a href="#{href}" target="#{target}" #{attributes}>#{text}</a></td><td>#{after}</td></tr>',item:"<tr><td>#{before}</td><td>#{text}</td><td>#{after}</td></tr>",nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'},miniLOL.theme.templates.list.table||{});if(!miniLOL.theme.templates.menu)miniLOL.theme.templates.menu={};miniLOL.theme.templates.menu.layers=Object.extend({0:{menu:'<div class="menu">#{data}</div>',
item:'<span class="item"><a href="#{href}">#{text}</a></span>'}},miniLOL.theme.templates.menu.layers||{})}},load:function(a,b,c){miniLOL.theme.unload();var d=miniLOL.theme.path,e=miniLOL.theme.name,f=a.match(/^(.+?):(.+)$/);f?(miniLOL.theme.path=f[1],miniLOL.theme.name=f[2]):(miniLOL.theme.path="themes",miniLOL.theme.name=a);if(miniLOL.theme.name==e&&miniLOL.theme.path==d)return true;f="#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:a});Event.fire(document,":theme.load",{name:a,runtime:Boolean(b)});
var g;new Ajax.Request("#{path}/theme.xml".interpolate({path:f,theme:a}),{method:"get",asynchronous:false,onSuccess:function(a){var c=miniLOL.theme.information={},a=miniLOL.Document.fix(a.responseXML);c.name=a.documentElement.getAttribute("name")||"Unknown";c.author=a.documentElement.getAttribute("author")||"Anonymous";c.homepage=a.documentElement.getAttribute("homepage")||"";miniLOL.theme.menu.node=a.documentElement.getAttribute("menu")||"menu";miniLOL.theme.content.node=a.documentElement.getAttribute("content")||
"body";try{var b=a.getElementsByTagName("initialize");miniLOL.theme.initialize=b.length?new Function(b[0].firstChild.nodeValue):new Function}catch(d){return g="An error occurred on the theme#initialize function:\n\n"+d.toString(),false}try{var f=a.getElementsByTagName("finalize");miniLOL.theme.finalize=f.length?new Function(f[0].firstChild.nodeValue):new Function}catch(e){return g="An error occurred on the theme#finalize function:\n\n"+e.toString(),false}c.styles=[];a.xpath("/theme/styles/style").each(function(a){c.styles.push(a.getAttribute("name"))});
a.xpath("/theme/templates/*").each(function(a){miniLOL.theme.templates[a.nodeName]=Element.toObject(a)},this);miniLOL.theme.template.setDefaults()},onFailure:function(){g="Could not load theme#information."}});if(g)return miniLOL.error(g,true),false;if(d=miniLOL.utils.get("#{path}/template.html".interpolate({path:f,theme:a}),{minified:true}))$(document.body).update(d);else return miniLOL.error("Could not load template.html.",true),false;miniLOL.theme.information.styles.each(function(a){if(!miniLOL.theme.style.load(a,
false,true))throw miniLOL.error("Could not load `#{style}` style/".interpolate({style:a}),true),$break;});if(miniLOL.error())return false;b&&miniLOL.initialized&&(miniLOL.menu.change(miniLOL.menu.current,true),miniLOL.go(location.href));miniLOL.theme.tmp={};!c&&miniLOL.theme.initialize&&miniLOL.theme.initialize.call(miniLOL.theme.tmp);Event.fire(document,":theme.loaded",{name:a,runtime:Boolean(b)});return true},unload:function(a){miniLOL.theme.template.initialize();miniLOL.theme.name&&(Event.fire(document,
":theme.unload",{name:miniLOL.theme.name}),!a&&miniLOL.theme.finalize&&miniLOL.theme.finalize.call(miniLOL.theme.tmp||{}),delete miniLOL.theme.tmp,$A(miniLOL.theme.information.styles).each(function(a){miniLOL.theme.style.unload(a)}),delete miniLOL.theme.name,delete miniLOL.theme.initialize,delete miniLOL.theme.finalize,delete miniLOL.theme.information)},content:function(){return $(miniLOL.theme.content.node)},menu:function(){return $(miniLOL.theme.menu.node)},deprecated:function(){miniLOL.theme.path=
"themes";miniLOL.theme.content.node=miniLOL.config.core.contentNode||"body";miniLOL.theme.menu.node=miniLOL.config.core.menuNode||"menu";miniLOL.theme.template.initialize();new Ajax.Request("resources/template.html",{method:"get",asynchronous:false,onSuccess:function(a){$(document.body).update(a.responseText)},onFailure:function(){$(document.body).update('<div id="menu"></div><div id="body"></div>')}});miniLOL.CSS.include("resources/style.css");miniLOL.theme.template.setDefaults();return true}},menu:{set:function(a){miniLOL.menu.enabled()&&
miniLOL.theme.menu().update(a)},get:function(a,b){b=b||0;if(!miniLOL.menu.enabled())return"";a=a||"default";return!miniLOL.menu.exists(a)?null:miniLOL.menu.parse(miniLOL.menus[a],b)},change:function(a,b){if(a!=miniLOL.menu.current||b){var c=miniLOL.menu.get(a);if(c)miniLOL.menu.set(c),miniLOL.menu.current=a;else return c="The menu `#{name}` does not exist.".interpolate({name:a}),miniLOL.error(c,true),c;Event.fire(document,":menu.change",miniLOL.menus[a])}},enabled:function(){return Boolean(miniLOL.menus["default"])},
exists:function(a){return Boolean(miniLOL.menus[a])},parse:function(a,b){var b=b||0,c=miniLOL.theme.templates.menu;if((!c||!a)&&miniLOL.error())return false;var d=true,e="";$A(a.childNodes).each(function(a){switch(a.nodeType){case Node.ELEMENT_NODE:e+=a.nodeName=="menu"?miniLOL.menu.parsers.layer(c,b).menu.interpolate({data:miniLOL.menu.parse(a,b)}):a.nodeName=="item"?miniLOL.menu.parsers.item(a,c,b):miniLOL.menu.parsers.other(a,c);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:d||(e+=a.nodeValue),
d=false}});return e.blank()?"":b==0?miniLOL.menu.parsers.layer(c,b).menu.interpolate({data:e}):e},parsers:{layer:function(a,b){var c={menu:"",item:""};if(a){c=Object.extend(c,a.layers["_"+b]||a.layers["default"]||{});if(!c.menu)c.menu="#{data}";if(!c.item)c.item='<a href="#{href}" #{attributes}>#{text}</a> '}return c},item:function(a,b,c){var d=a.cloneNode(true),e=d.getAttribute("class")||"";d.removeAttribute("class");var f=d.getAttribute("id")||"";d.removeAttribute("id");var g=d.getAttribute("href")||
"";d.removeAttribute("href");return miniLOL.menu.parsers.layer(b,c).item.interpolate(Object.extend(Object.fromAttributes(d.attributes),{"class":e,id:f,href:g,attributes:String.fromAttributes(d.attributes),text:Element.getFirstText(a),data:miniLOL.menu.parse(a,c+1)}))},other:function(a,b){if(!a||!b)return"";var c=b[a.nodeName];if(!c)return"";var d={};$A(a.childNodes).each(function(a){a.nodeType==Node.ELEMENT_NODE&&(d[a.nodeName]=miniLOL.menu.parsers.other(a,b))});d.text=Element.getFirstText(a);return c.interpolate(Object.extend(d,
Object.fromAttributes(a.attributes)))}}},page:{get:function(a,b,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.get",{name:a,queries:b});var d=miniLOL.page.current=miniLOL.pages.data[a],e=b.type;if(!d)return miniLOL.content.set("404 - Not Found"),false;if(d.getAttribute("alias")){typeof b[a]!="string"&&delete b[a];delete b.page;if(!b.title&&d.getAttribute("title"))b.title=d.getAttribute("title").encodeURIComponent();(b=Object.toQueryString(b))&&(b="&"+b);d=d.getAttribute("alias");
!d.isURL()&&d.charAt(0)!="#"&&(d="#"+d);return miniLOL.go(d+b)}Object.isUndefined(e)&&(e=d.getAttribute("type"));if(c)c={},Object.extend(c,miniLOL.config.core),Object.extend(c,b),document.title=(b.title||d.getAttribute("title")||miniLOL.config.core.siteTitle).interpolate(c);if(miniLOL.pages.cache[a])return e?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(e,miniLOL.pages.cache[a],b)):miniLOL.content.set(miniLOL.pages.cache[a]),true;if(c=d.getAttribute("arguments")){var c=c.replace(/[ ,]+/g,
"&amp;").toQueryParams(),f;for(f in c)b[f]==null&&(b[f]=c[f])}d=miniLOL.page.parse(d);miniLOL.pages.cache[a]=d;e&&(d=miniLOL.resource.get("miniLOL.functions").render(e,d,b));miniLOL.content.set(d);return true},parse:function(a,b){var c="";$A(a.childNodes).each(function(a){switch(a.nodeType){case Node.ELEMENT_NODE:Object.isFunction(miniLOL.page.parsers[a.nodeName])&&(c+=miniLOL.page.parsers[a.nodeName](a,b));break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:c+=a.nodeValue}});return c},parsers:{list:function(a,
b){var c=a.cloneNode(false),b=b||[a],d=c.getAttribute("before")||b[0].getAttribute("before")||"";c.removeAttribute("before");var e=c.getAttribute("after")||b[0].getAttribute("after")||"";c.removeAttribute("after");var f=c.getAttribute("arguments")||b[0].getAttribute("arguments")||"";c.removeAttribute("arguments");var g=c.getAttribute("type")||b[0].getAttribute("type")||"";c.removeAttribute("type");var j=c.getAttribute("menu")||b[0].getAttribute("menu");c.removeAttribute("menu");var h=c.getAttribute("template");
c.removeAttribute("template");miniLOL.theme.templates.list[h]||(h="default");var k="";$A(a.childNodes).each(function(c){if(c.nodeType==Node.ELEMENT_NODE)if(c.nodeName=="link"){var b=c.cloneNode(true),i=b.getAttribute("href");b.removeAttribute("href");var l=b.getAttribute("target");b.removeAttribute("target");var c=b.getAttribute("text")||(b.firstChild?b.firstChild.nodeValue:i),o=b.getAttribute("before")||d||"";b.removeAttribute("before");var p=b.getAttribute("after")||e||"";b.removeAttribute("after");
var t=b.getAttribute("domain")||"";b.removeAttribute("domain");var q=b.getAttribute("arguments")||f;b.removeAttribute("arguments");var r=b.getAttribute("menu")||j;b.removeAttribute("menu");var m=b.getAttribute("title")||"";b.removeAttribute("title");var n=i.isURL(),u=b.getAttribute("class")||"";b.removeAttribute("class");var v=b.getAttribute("id")||"";b.removeAttribute("id");l||n?(i=!n?"data/"+i:i,l=l||"_blank"):(n=b.getAttribute("type")||g||"",b.removeAttribute("type"),t=="in"||i.charAt(0)=="#"?
i.charAt(0)!="#"&&(i="#"+i):i="#page="+i,q=q?"&"+q.replace(/[ ,]+/g,"&amp;"):"",n=n?"&type="+n:"",r=miniLOL.menu.enabled()&&r?"&amp;menu="+r:"",l="",m&&(m=m.interpolate({text:c,href:i}),m="&title="+m.encodeURIComponent()),i=i+q+n+r+m);k+=miniLOL.theme.templates.list[h].link.interpolate(Object.extend(Object.fromAttributes(b.attributes),{"class":u,id:v,attributes:String.fromAttributes(b.attributes),before:miniLOL.theme.templates.list[h].before.interpolate({data:o}),after:miniLOL.theme.templates.list[h].after.interpolate({data:p}),
href:i,target:l,text:c,title:m}))}else c.nodeName=="item"?(b=c.cloneNode(true),c=b.getAttribute("text")||(b.firstChild?b.firstChild.nodeValue:""),o=b.getAttribute("before")||d||"",b.removeAttribute("before"),p=b.getAttribute("after")||e||"",b.removeAttribute("after"),i=b.getAttribute("class")||"",b.removeAttribute("class"),l=b.getAttribute("id")||"",b.removeAttribute("id"),k+=miniLOL.theme.templates.list[h].item.interpolate(Object.extend(Object.fromAttributes(b.attributes),{"class":i,id:l,attributes:String.fromAttributes(b.attributes),
before:miniLOL.theme.templates.list[h].before.interpolate({data:o}),after:miniLOL.theme.templates.list[h].after.interpolate({data:p}),text:c}))):c.nodeName=="list"?k+=miniLOL.page.parsers.list(c,[a]):c.nodeName=="nest"&&(toParse=c.cloneNode(true),o=c.getAttribute("before")||d||"",p=c.getAttribute("after")||e||"",k+=miniLOL.theme.templates.list[h].nest.interpolate({"class":c.getAttribute("class")||"",style:c.getAttribute("style")||"",before:miniLOL.theme.templates.list[h].before.interpolate({data:o}),
after:miniLOL.theme.templates.list[h].after.interpolate({data:p}),data:miniLOL.page.parse(toParse,[a])}));else if((c.nodeType==Node.CDATA_SECTION_NODE||c.nodeType==Node.TEXT_NODE)&&!c.nodeValue.blank())k+=miniLOL.theme.templates.list[h].data.interpolate({data:c.nodeValue})});return miniLOL.theme.templates.list[h].global.interpolate(Object.extend(Object.fromAttributes(c.attributes),{attributes:String.fromAttributes(c.attributes),data:k}))},include:function(a){a.cloneNode(false);var b=a.getAttribute("href");
a.removeAttribute("href");a.getAttribute("update");a.removeAttribute("update");var c=location.href.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/)[3],d=b.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/);d&&d[3]!=c&&'<iframe src="#{href}" #{attributes}></iframe>'.interpolate({href:b,attributes:Object.fromAttributes(a.attributes)});return""}},load:function(a,b,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.load",{path:a,queries:b});if(c)document.title=(b.title||miniLOL.config.core.siteTitle).interpolate(Object.extend(Object.extend({},
miniLOL.config.core),b));new Ajax.Request("data/#{path}?#{queries}".interpolate({path:a,queries:Object.toQueryString(b)}),{method:"get",cached:!b.nocache,onSuccess:function(a){b.type?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(b.type,a.responseText,b)):miniLOL.content.set(a.responseText);Event.fire(document,":page.loaded",a);Event.fire(document,":go",c.getHashFragment())},onFailure:function(a){miniLOL.content.set("#{status} - #{statusText}".interpolate(a));Event.fire(document,
":page.loaded",a)}})}},module:{create:function(a,b){if(!b)return miniLOL.error("Like, do I know how this module is done?",true),false;Event.fire(document,":module.create",{name:a,module:b});b.name=a;b.root="#{path}/#{module}".interpolate({path:miniLOL.module.path,module:a});if(!Object.isArray(b.dependencies))b.dependencies=[];if(!b.type)b.type="active";if(!b.execute)b.execute=new Function;for(var c in b)Object.isFunction(b[c])&&(b[c]=b[c].bind(b));b.storage=new miniLOL.Storage("module."+a);if(b.initialize)try{if(b.initialize()===
false){if(miniLOL.error())return false;throw Error("An error occurred while initializing the module.");}}catch(d){throw d.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,module:a}),d;}miniLOL.modules[a]=b;$A(b.aliases).each(function(a){miniLOL.modules[a]=b});document.fire(":module.created",b);return b},execute:function(a,b,c){if(!a)return miniLOL.error("What module should be executed?"),false;if(!miniLOL.module.exists(a))return c&&miniLOL.error("The module `#{name}` is not loaded.".interpolate({name:a})),
false;if(c)miniLOL.content.set(miniLOL.config.core.loadingMessage),c={},Object.extend(c,miniLOL.config.core),Object.extend(c,b),document.title=(b.title||miniLOL.module.get(a).title||miniLOL.config.core.siteTitle).interpolate(c);b=Object.isArray(b)?b:[b];Event.fire(document,":module.execute",{name:a,arguments:b});var d;try{d=miniLOL.module.get(a).execute.apply(miniLOL.module.get(a),b)}catch(e){return e.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,
module:a}),miniLOL.error("An error occurred while executing the module `#{name}`\n\n#{file} @ #{line}:\n#{error}".interpolate({name:a,file:e.fileName,line:e.lineNumber,error:e.toString()}),true),false}Event.fire(document,":module.executed",{name:a,arguments:b,result:d});Object.isUndefined(d)&&(d=true);return d},load:function(a){Event.fire(document,":module.load",a);try{miniLOL.utils.require("#{path}/#{module}/main.js".interpolate({path:miniLOL.module.path,module:a}),{minified:true});if(miniLOL.error())return false;
if(!miniLOL.module.exists(a))throw Error("Something went wrong while loading the module `#{name}`.".interpolate({name:a}));Event.fire(document,":module.loaded",a);return true}catch(b){return miniLOL.error("An error occurred while loading the module `#{name}`\n\n#{root}/#{file} @ #{line}:\n\n#{error}".interpolate({name:a,root:miniLOL.path,file:b.fileName,line:b.lineNumber,error:b.toString()}),true),false}},get:function(a){return miniLOL.modules[a]},exists:function(a){return Boolean(miniLOL.module.get(a))},
dependencies:{check:function(){for(var a in miniLOL.modules){var b=miniLOL.module.get(a).dependencies;if(b)for(var c=0;c<b.length;c++)if(!miniLOL.module.get(b[c]))throw{module:a,require:b[c]};}return true},needs:function(a,b,c,d){miniLOL.module.get(a)?b.call(c||window):setTimeout(function(){miniLOL.module.dependencies.needs(a,b,c)},d||10)}}},go:function(a,b){if(!Object.isString(a))return false;a.isURL()?(a=a.parseURL(),a.host!=location.host||!a.path.startsWith(miniLOL.path)?location.href=a.full:a=
a.full.replace(RegExp("^.*"+miniLOL.path),"")):a.charAt(0)!="#"&&(a="#"+a);var a=a.replace(/#!/,"#"),c=a.toQueryParams(),d=a.match(/#(([^=&]*)&|([^=&]*)$)/),e=false;c.menu&&miniLOL.menu.change(c.menu);miniLOL.page.current=null;d?(c.page=d[2]||d[3],c.page?e=miniLOL.page.get(c.page,c,a):b||(e=miniLOL.go("#{page}&#{queries}".interpolate({page:miniLOL.config.core.homePage,queries:Object.toQueryString(c)}),true))):c.module?e=miniLOL.module.execute(c.module,c,true):c.page?(d=c.page,delete c.page,miniLOL.page.load(d,
c,a)):e=miniLOL.go(miniLOL.config.core.homePage);e&&Event.fire(document,":go",a.getHashFragment());return e}};
(function(){if(Prototype.Browser.IE)Prototype.Browser.InternetExplorer=true;if(Prototype.Browser.Gecko)Prototype.Browser.Mozilla=true;if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=true;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=true;Prototype.Browser.Mozilla||Prototype.Browser.Opera?Prototype.Browser.Good=true:Prototype.Browser.Bad=true;Prototype.Browser.Name=window.navigator.appName;var a=window.navigator.appVersion;try{if(Prototype.Browser.IE)Prototype.Browser.Version=
parseFloat(a.match(/MSIE ([^;]*)/)[1]);else if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Version=parseFloat(a);else throw null;}catch(b){Prototype.Browser.Version=0}if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:(this.stack||"").replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};
else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};if(Prototype.Browser.IE){if(!window.DOMParser)window.DOMParser=
Class.create({parseFromString:function(a){var b=new AciveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b}});if(!window.XMLSerializer)window.XMLSerializer=Class.create({serializeToString:function(a){return a.xml}})}})();Function.empty=function(){};Object.extend(Function,function(){return{parse:function(a){if(a=a.match(/^function\s*\((.*?)\)[\s\n]*\{([\s\S]*)\}[\s\n]*/m)){var b=a[1].split(/\s*,\s*/);return new Function(b,a[2])}}}}());Object.extend(Function.prototype,function(){return{clone:function(){return Function.parse(this.toString())}}}());
Object.extend(Object,function(){var a,b;if(function(){for(var a in{toString:1})if(a==="toString")return false;return true}()){var c=Object.keys,d=Object.values,e=["toString","valueOf"];a=function(a){var b=c(a);e.each(function(c){a[c]!=Object.prototype[c]&&b.push(c)});return b};b=function(a){var c=d(a);e.each(function(b){a[b]!=Object.prototype[b]&&c.push(a[b])});return c}}else a=Object.keys,b=Object.values;var f=Object.isFunction(Object.defineProperty)?Object.defineProperty:function(a,c,b){Object.isFunction(b.get)&&
Object.isFunction(a.__defineGetter__)&&a.__defineGetter__(c,b.get);Object.isFunction(b.set)&&Object.isFunction(a.__defineSetter__)&&a.__defineSetter__(c,b.set)};if(Object.isFunction(Object.defineProperties))var g=Object.defineProperties;else Object.defineProperties=function(a,c){for(var b in c)Object.defineProperty(a,b,c[b])};if(Object.isFunction(Object.create))var j=Object.create;else Object.create=function(a,c){var b=Object(a);Object.defineProperties(b,c);return b};return{is:function(a,c){return!Object.isUndefined(c)&&
(c instanceof a||c==a)},isObject:function(a){return typeof a=="object"&&a.constructor===Object},isBoolean:function(a){return typeof a=="boolean"||a.constructor===Boolean},isRegExp:function(a){return!Object.isUndefined(a)&&a.constructor==window.RegExp},isClass:function(a){return Boolean(a["__miniLOL.Class__"])},isDocument:function(a){return a.nodeType===Node.DOCUMENT_NODE},isXML:function(a){if(typeof a!=="object")return false;a=a.ownerDocument||a;return!a.documentElement?false:a.documentElement.nodeName!=
"HTML"},fromAttributes:function(a){for(var c={},b=0;b<a.length;b++)c[a.item(b).nodeName]=a.item(b).nodeName;return c},toQueryString:function(a){var c="",b;for(b in a)c+="#{name}=#{value}&".interpolate({name:b,value:a[b]});return c.substr(0,c.length-1)},keys:a,values:b,extend:function(a,c,b){for(var b=Object.isUndefined(b)?true:Boolean(b),d=Object.keys(c||{}),f=0,e=d.length;f<e;f++){var g=d[f];if(b||Object.isUndefined(destionation[g]))a[g]=c[g]}return a},extendAttributes:function(a,c,b){var b=Object.isUndefined(b)?
true:Boolean(b),d;for(d in c)(b||Object.isUndefined(destionation[d]))&&function(){var b;a[d]=function(a,f){return Object.isUndefined(a)&&!f?Object.isFunction(c[d].get)?c[d].get(b):b:Object.isFunction(c[d].set)?b=c[d].set(b,a):b=a}}();return a},without:function(a,c){var b=Object.extend({},a);Object.isArray(c)?c.each(function(a){delete b[a]}):delete b[c];return b},defineProperty:f,defineProperties:g,create:j}}());
Object.extend(String,function(){return{fromAttributes:function(a){for(var b="",c=0;c<a.length;c++)b+='#{name}="#{value}" '.interpolate({name:a.item(c).nodeName,value:a.item(c).nodeValue});return b},fromXML:function(a){return!Object.isXML(a)?false:(new XMLSerializer).serializeToString(a)}}}());
Object.extend(String.prototype,function(){function a(a){Object.isRegExp(a)||(a=/&/);var c={},b=this.match(/[?#](.*?)([#?]|$)/);if(!b)return c;a=b[1].split(a);for(b=0;b<a.length;b++){var d=a[b].split(/=/),e=d[0].decodeURIComponent();(d=d[1])?Object.isUndefined(c[e])?c[e]=d.decodeURIComponent():Object.isArray(c[e])?c[e].push(d):c[e]=[c[e],d]:c[e]=true}return c}var b=window.encodeURI,c=window.decodeURI,d=window.encodeURIComponent,e=window.decodeURIComponent;return{toQueryParams:a,parseQuery:a,toXML:function(){return(new DOMParser).parseFromString(this,
"text/xml")},isURL:function(){return/^(\w+):(\/\/.+?(:\d)?)(\/)?/.test(this)||/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/.test(this)},parseURL:function(){var a;return(a=this.match(/^mailto:(([\w.%+-]+)@([\w.]+\.[A-Za-z]{2,4}))$/))?{protocol:"mailto",uri:a[1],user:a[2],host:a[3]}:(a=this.match(/^((\w+):\/\/(((.+?)(:(\d+))?)(\/.*)?))$/))?{full:a[1],protocol:a[2],uri:a[3],host:a[4],hostname:a[5],port:a[7],path:a[8]}:false},blank:function(){return this==0},getHashFragment:function(){var a=this.match(/(#.*)$/);
return a?a[1]:""},splitEvery:function(a){for(var c=[],b=0;b<this.length;b+=a)c.push(this.substr(b,a));return c},test:function(a){return a.test(this)},commonChars:function(a){return this.toArray().intersect(a.toArray())},format:function(a){var c=this,b;for(b in a)c=c.replace(RegExp("\\{"+b+"\\}","g"),a[b].toString());return c},reverse:function(){return this.toArray().reverse().join("")},translate:function(a,c){var b=this;c?Object.keys(a).each(function(d){if(!c[d])throw Error("The second table value is missing.");
b=a[d].is(RegExp)?b.replace(eval(a[d].global?a[d].toString():a[d].toString()+"g")):b.replace(RegExp(a[d],"g"),c[d])}):Object.values(a).each(function(a){if(a.length!=2)throw Error("The array has to be [regex, translation].");b=a[0].is(RegExp)?b.replace(eval(a[0].global?a[0].toString():a[0].toString()+"g"),a[1]):b.replace(RegExp(a[0],"g"),a[1])});return b},interpolate:function(a,c){return Object.isRegExp(c)?(new Template(this,c)).evaluate(a):(new miniLOL.Template(this,c)).evaluate(a)},toNumber:function(a){return a?
parseInt(this):parseFloat(this)},toBase:function(a){return this.toNumber().toBase(a)},fromBase:function(a){return parseInt(this,a)},toCode:function(){return this.charCodeAt(0)},toPaddedString:function(a,c,b){c=Object.isUndefined(b||c)?"0":(b||c).toString();return c.times(a-this.length)+this},toInvertedCase:function(){for(var a="",c=0,b=this.length;c<b;c++){var d=this.charAt(c),e=d.toLowerCase(),s=d.toUpperCase();a+=s==e?e:d==e?s:e}return a},encodeURI:function(){return b(this)},decodeURI:function(){return c(this)},
encodeURIComponent:function(){return d(this)},decodeURIComponent:function(){return e(this)}}}());
Object.extend(Number.prototype,function(){function a(){return this*1E3}function b(){return this}function c(){return this*60}function d(){return this*3600}function e(){return this*86400}function f(){return this*604800}function g(){return this*324E5}return{milliseconds:a,ms:a,seconds:b,second:b,minutes:c,minute:c,hours:d,hour:d,days:e,day:e,weeks:f,week:f,years:g,year:g,upTo:function(a,c,b){$R(this,a+1,true).each(c,b);return this},isEven:function(){return this%2==0},isOdd:function(){return this%2!=
0},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)},log:function(){return Math.log(this)},pow:function(a){return Math.pow(this,a)},sqrt:function(){return Math.sqrt(this)},sin:function(){return Math.sin(this)},cos:function(){return Math.cos(this)},tan:function(){return Math.tan(this)},asin:function(){return Math.asin(this)},acos:function(){return Math.acos(this)},atan:function(){return Math.atan(this)},
toPaddedString:function(a,c,b){b=Object.isUndefined(b)?"0":b.toString();c=this.toString(c||10);return b.times(a-c.length)+c},toBase:function(a){return this.toString(a).toUpperCase()},toChar:function(){return String.fromCharCode(this)},digits:function(){var a=this.toString().match(/e(.*)$/);return a?a[1].toNumber()>0?1+a[1].toNumber():0:this.toString().length},ordinalized:function(){switch(parseInt(this)){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}}());
Object.extend(Enumerable,function(){return{empty:function(){return this.length==0}}}());Object.extend(Array.prototype,Enumerable);Hash.addMethods(function(){var a=Hash.prototype.toJSON;return{remove:Hash.prototype.unset,clear:function(){var a=this._object;this._object={};return a},replace:function(a){var c=this._object;this._object=Object.isString(a)?miniLOL.JSON.unserialize(a):Object.extend({},a);return c},toJSON:function(b){return b?miniLOL.JSON.serialize(this._object)||"{}":a.call(this)}}}());
(function(){Date.weekDays="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");Date.months="January,February,March,April,May,June,July,August,September,October,November,December".split(",");var a={d:2,H:2,I:2,j:3,k:2,l:2,m:2,M:2,N:9,S:2,U:2,V:2,W:2,y:2,i:3};Object.extend(Date,function(){var a=Date.parse;return{parse:function(b){if(!b.include("%"))return a(b)}}}());var b={flag:{"-":function(a){return a},_:function(a,b){return a.toPaddedString(b,10," ")},0:function(a,b){return a.toPaddedString(b,
10,"0")},"^":function(a,b){return a.toString().toUpperCase().toPaddedString(b," ")},"#":function(a,b){return a.toString().toInvertedCase().toPaddedString(b," ")}},"%":function(){return"%"},a:function(a){return Date.weekDays[a.getDay()].substr(0,3)},A:function(a){return Date.weekDays[a.getDay()]},b:function(a){return Date.months[a.getMonth()].substr(0,3)},B:function(a){return Date.months[a.getMonth()]},c:function(a){return a.format("%a %b %_d %X %Y")},C:function(a){return a.getFullYear().toString().substr(0,
2)},d:function(a){return a.getDate()},D:function(a){return a.format("%m/%d/%y")},e:function(a){return a.format("%_d")},F:function(a){return a.format("%Y-%m-%d")},g:function(a){return a.format("%y")},G:function(a){return a.format("%Y")},h:function(a){return a.format("%b")},H:function(a){return a.getHours()},I:function(a){a=a.getHours();return a+1>12?(a+1)/2:a+1},j:function(a){var b=new Date;b.setFullYear(a.getFullYear());b.setDate(1);b.setMonth(0);return((a.getTime()-b.getTime())/1E3/60/60/24).ceil()},
k:function(a){return a.format("%_H")},l:function(a){return a.format("%_l")},m:function(a){return a.getMonth()+1},M:function(a){return a.getMinutes()},n:function(){return"\n"},N:function(a){return a.getMilliseconds()*1E6},p:function(a){return a.getHours()>12?"PM":"AM"},P:function(a){return a.format("%#p")},r:function(a){return a.format("%I:%M:%S %p")},R:function(a){return a.format("%H:%M")},s:function(a){return a.getDate()},S:function(a){return a.getSeconds()},t:function(){return"\t"},T:function(a){return a.format("%H:%M:%S")},
u:function(a){return a.getDay()==0?7:a.getDay()},U:function(a){var b=new Date;b.setFullYear(a.getFullYear());b.setDate(1);b.setMonth(0);return((a.getTime()-b.getTime())/1E3/60/60/24/7).ceil()},V:function(a){return a.format("%U")},w:function(a){return a.getDay()},W:function(a){return a.format("%U")},x:function(a){return a.format("%m/%d/%y")},X:function(a){return a.format("%T")},y:function(a){return a.getFullYear().toString().substr(2,2)},Y:function(a){return a.getFullYear()},E:function(a){return a.getMonth()%
2==0?31:a.getMonth()==1?a.getFullYear()%4==0?29:28:30},o:function(a){return a.getDate().ordinalized()},O:function(a){return a.getFullYear()%4?0:1},i:function(a){var b=new Date(a);b.setHours(0);b.setSeconds(0);b.setMinutes(0);return((a.getTime()-b.getTime())/1E3/86.4).toFixed(2)}};Object.extend(Date.prototype,function(){return{format:function(c){var d=this;return c.gsub(/%([\-_0^#])?(\d+)?(.)/,function(c){var f=c[1]||"0",g=parseInt(c[2]||a[j]||"0"),j=c[3];return!b[j]?c[0]:b.flag[f](b[j](d),g)})}}}())})();
if(Prototype.Browser.IE&&!document.head)document.head=document.getElementsByTagName("head")[0];
Element.addMethods(function(){return{load:function(a,b){b&&!Object.isUndefined(b.frequency)?new Ajax.PeriodicalUpdater(this,a,b):new Ajax.Updater(this,a,b)},xpath:Prototype.Browser.IE?function(a,b){Object.isUndefined(b)&&(b=a,a=this);for(var c=[],d=a.selectNodes(b),e=0;e<d.length;e++)c.push(d.item(e));return c}:function(a,b){Object.isUndefined(b)&&(b=a,a=this);for(var c=[],d=(a.ownerDocument||a).evaluate(b,a,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),e=0;e<d.snapshotLength;e++)c.push(d.snapshotItem(e));
return c},select:function(a,b){Object.isUndefined(b)&&(b=a,a=this);return Prototype.Selector.select(b,a)},getTextDescendants:function(a){function b(a){for(a=a.firstChild;a;)Node.TEXT_NODE==a.nodeType&&c.push(a),Object.isElement(a)&&b(a),a=a.nextSibling}var c=[];b(a||this);return c},getFirstText:function(a){var a=a||this,b="";Object.isElement(a)?a=$A(a.childNodes):Object.isArray(a)||(a=$A(a));a.each(function(a){switch(a.nodeType){case Node.ELEMENT_NODE:throw $break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(!a.nodeValue.blank())throw b=
a.nodeValue.strip(),$break;}});return b},toObject:function(a){var a=a||this,b={};if(!Object.isElement(a)&&!Object.isDocument(a))return b;$A(a.childNodes).each(function(a){if(a.nodeType==Node.ELEMENT_NODE)if(a.getElementsByTagName("*").length==0){var d="";$A(a.childNodes).each(function(a){a.nodeType!=Node.CDATA_SECTION_NODE&&a.nodeType!=Node.TEXT_NODE||a.nodeValue.blank()||(d+=a.nodeValue)});b[a.nodeName]=d}else b[a.nodeName]=Element.toObject(a)});return b}}}());
Ajax.Request.addMethods({request:function(a){this.url=a;this.method=this.options.method;if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();if(this.options.minified&&(a=this.url.replace(/\.([^.]+)$/,".min.$1"),miniLOL.utils.exists(a)))this.url=a;if(this.options.cached===false)this.url+=(this.url.include("?")?"&":"?")+Math.random(),this.options.requestHeaders=Object.extend(this.options.requestHeaders||{},{"Cache-Control":"must-revalidate",Pragma:"no-cache"});
a=Object.toQueryString(this.options.parameters);if(!["get","post","head"].include(this.method))a+=(a?"&":"")+"_method="+this.method,this.method="post";a&&(this.method=="get"||this.method=="head"?this.url+=(this.url.include("?")?"&":"?")+a:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(a+="&_="));this.parameters=a.toQueryParams();try{var b=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),
this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)this.onStateChange()}catch(c){this.dispatchException(c)}}});if(!Object.isObject(window.miniLOL))window.miniLOL={error:Function.empty,Framework:{Version:"0.1"}};
Class=function(){var a={Normal:1,Abstract:2},b=function(){return{addMethods:function(a){for(var b=this.superclass&&this.superclass.prototype,e=Object.keys(a),f=0,g=e.length;f<g;f++){var j=e[f],h=a[j];if(b&&Object.isFunction(h)&&h.argumentNames().first()=="$super"){var k=h,h=function(a){return function(){return b[a].apply(this,arguments)}}(j).wrap(k);h.valueOf=k.valueOf.bind(k);h.toString=k.toString.bind(k)}this.prototype[j]=h;this.__type__==Class.Abstract&&(this[j]=h)}},addStatic:function(a){for(var b=
Object.keys(a),e=0,f=b.length;e<f;e++){var g=b[e];this[g]=a[g]}},addAttributes:function(a){Object.extendAttributes(this.prototype,a);this.__type__==Class.Abstract&&Object.extendAttributes(this,a)}}}();return{create:function(){var b=$A(arguments),d=Object.isFunction(b.first())?b.shift():null,e=function(){switch(this.__type__){case a.Abstract:throw Error("You cannot instantiate an abstract class.");default:if(Object.isFunction(this.initialize))return this.initialize.apply(this,arguments)}return null};
e["__miniLOL.Class__"]=true;Object.extend(e,Class.Methods);e.superclass=d;e.subclasses=[];if(d){if(!d.__type__)d.__type__=a.Normal;if(!d.subclasses)d.subclasses=[];var f=Function.empty.clone();f.prototype=d.prototype;e.prototype=new f;d.subclasses.push(e)}e.__type__=e.prototype.__type__=b.first().type||Class.Normal;b.each(function(a){e.addMethods({initialize:a.initialize||a.constructor||Function.empty.clone()});e.addMethods(Object.without(a,["constructor","initialize","Methods","Static","Attributes"]));
e.addMethods(a.Methods||{});e.addStatic(a.Static||{});e.addAttributes(a.Attributes||{})});return e.prototype.constructor=e},Type:a,Methods:b}}();
miniLOL.utils=function(){return{exists:function(a){var b=false;new Ajax.Request(a,{method:"head",asynchronous:false,evalJS:false,onSuccess:function(){b=true}});return b},get:function(a,b){var b=Object.extend({raw:true},b||{}),c;new Ajax.Request(a,Object.extend(b||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(a){if(b.raw)c=a.responseText;else try{c=JSON.unserialize(a.responseText)}catch(e){c=a.responseXML||a.responseText}}}));return c},execute:function(a,b){var c,d;new Ajax.Request(a,
Object.extend(b||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(b){try{c=window.eval(b.responseText)}catch(f){d=f,d.fileName=a,d.lineNumber-=5}},onFailure:function(b){d=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,status:b.status,statusText:b.statusText}));d.fileName=a;d.lineNumber=0}}));if(d)throw d;return c},include:function(a,b){b=b||{};if(a.startsWith("http")){var c=new Element("script",{type:"text/javascript",src:a,id:b.id});$(document.head).insert(c);
return true}var d=false;new Ajax.Request(a,Object.extend(b||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(a){try{window.eval(a.responseText),d=true}catch(b){d=false}}}));return d},require:function(a,b){b=b||{};if(a.startsWith("http")){var c=new Element("script",{type:"text/javascript",src:a,id:b.id});$(document.head).insert(c);return true}var d=false;new Ajax.Request(a,Object.extend(b||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(b){try{window.eval(b.responseText)}catch(c){d=
c,d.fileName=a,d.lineNumber-=5}},onFailure:function(b){d=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,status:b.status,statusText:b.statusText}));d.fileName=a;d.lineNumber=0;d.http={status:b.status,text:b.statusText}}}));if(d)throw d;return true}}}();
miniLOL.File=Class.create({initialize:function(a,b){this.options=Object.extend({method:"get",asynchronous:false,evalJS:false,minified:false,cached:true,onSuccess:function(a){this.content=a.responseText;this.special=a.responseXML;this.loaded=true;if(Object.isFunction(this.options.onLoaded))this.options.onLoaded(this)}.bind(this),onFailure:function(a){this.error=Object.clone(a)}.bind(this)},b||{});this.loaded=false;this.path=a;this.extension=miniLOL.File.extension(a);new Ajax.Request(this.path,this.options)},
reload:function(){this.loaded=false;new Ajax.Request(this.path,this.options)},interpolate:function(a,b){return b?this.content.interpolate(a,b):(new miniLOL.Template(this)).evaluate(a)},Static:{extension:function(a){return(a=a.match(/\.([^.]+)$/))?a[1]:""}}});
miniLOL.Template=Class.create({initialize:function(a,b){if(Object.is(miniLOL.File,a)){if(!a.loaded||!a.extension)throw"The File has to be loaded and have an extension.";this.engine=miniLOL.Template.Engine.get(a.extension);if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(a.content)}else{this.engine=miniLOL.Template.Engine.get(b)||Template;if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(a)}},evaluate:function(a,
b){return this.template.evaluate(a,b)}});miniLOL.Template.Engine=function(){var a={},b={};return{get:function(b){return a[(b||"").toLowerCase()]},add:function(b,d){a[b.toLowerCase()]||(a[b.toLowerCase()]=d)},load:function(a,d){b[a]||(miniLOL.utils.execute(a,d),b[a]=true)}}}();
miniLOL.Document=function(){return{fix:Prototype.Browser.IE?function(a){if(a)return a={real:a},a.documentElement=a.real.documentElement,a.getElementsByTagName=function(a){return this.real.getElementsByTagName(a)},a.getElementById=function(a){return Element.xpath(this,"//*[@id='#{0}']".interpolate([a])).first()}.bind(a.real),a.real.setProperty("SelectionLanguage","XPath"),a.xpath=Element.xpath.bind(a.real),a.select=Element.select.bind(a.real),a}:Prototype.Browser.Good?function(a){if(a)return a.xpath=
Element.xpath,a.select=Element.select,a}:function(a){if(a)return a.getElementById=function(a){return this.xpath("//*[@id='#{0}']".interpolate([a])).first()},a.xpath=Element.xpath,a.select=Element.select,a},check:function(a,b){var c=false;a||(c="There is a syntax error.");if(a.documentElement.nodeName=="parsererror")c=a.documentElement.textContent;b&&c&&miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:b,error:c}),true);return c}}}();
miniLOL.CSS=function(){return{include:function(a,b){b&&(b=a.replace(/\.css$/,".min.css"));var c=$$("link").find(function(c){return c.getAttribute("href")==a||c.getAttribute("href")===b});if(!c){if(b&&miniLOL.utils.exists(b))a=b;else if(!miniLOL.utils.exists(a))return false;c=new Element("link",{rel:"stylesheet",href:a,type:"text/css"});$$("head")[0].insert(c);Event.fire(document,":css.included",c)}return c},create:function(a,b){var c=new Element("style",{type:"text/css"});Prototype.Browser.IE?c.styleSheet.cssText=
a:c.update(a);b&&c.setAttribute("id",b);$$("head").first().appendChild(c);Event.fire(document,":css.created",c);return c}}}();
miniLOL.Resource=Class.create({initialize:function(a,b){if(!b)throw Error("No wrapper has been passed.");this.name=a;this.wrapper=b;if(!this.wrapper.clear)this.wrapper.clear=function(){this.data={}};for(var c in this.wrapper){if(Object.isFunction(this.wrapper[c])){if(this.wrapper[c].parent==this.wrapper)break;this.wrapper[c]=this.wrapper[c].bind(this.wrapper);this.wrapper[c].parent=this.wrapper}Object.isUndefined(this[c])&&(this[c]=this.wrapper[c])}this.clear();this.flush();this.wrapper.initialize&&
this.wrapper.initialize()},load:function(){var a,b=$A(arguments);Event.fire(document,":resource.load",{resource:this,arguments:b});this.calls.push(b);try{a=this.wrapper.load.apply(this.wrapper,b)}catch(c){return miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this.name,error:c.toString()})),false}Event.fire(document,":resource.loaded",{resource:this,arguments:b});return a},reload:function(){Event.fire(document,":resource.reload",{resource:this});this.wrapper.clear();
this.flush().each(function(a){this.load.apply(this,a)},this);Event.fire(document,":resource.reloaded",{resource:this})},clear:function(){Event.fire(document,":resource.clear",{resource:this});this.wrapper.clear()},flush:function(a){Event.fire(document,":resource.flush",{resource:this,call:a});var b;if(Object.isArray(a)){if(b=this.calls.find(function(b){if(b.length!=a.length)return false;for(var d=false,e=0;e<b.length;e++)if(a[e]==b[e]&&(d=true),!d)break;return d}))this.calls=this.calls.filter(function(a){return a!=
b})}else b=this.calls,this.calls=[];return b},data:function(){return this.wrapper.data}});
miniLOL.JSON=function(){function a(a){return Object.isObject(a)?a.__miniLOL_is_xml?a.value.toXML():a.__miniLOL_is_function?Function.parse(a.value):miniLOL.JSON.unserializeSpecial(a):Object.isXML(a)?{__miniLOL_is_xml:true,value:String.fromXML(a)}:Object.isFunction(a)?{__miniLOL_is_function:true,value:a.toString()}:miniLOL.JSON.serializeSpecial(a)}function b(b){var d;if(Object.isObject(b)){d=Object.clone(b);for(var e in b)d[e]=a(b[e])}else Object.isArray(b)?(d=[],b.each(function(b){d.push(a(b))})):
d=b;return d}return{special:b,serializeSpecial:b,unserializeSpecial:b,serialize:function(a){try{return Object.toJSON(miniLOL.JSON.serializeSpecial(a))}catch(b){return false}},unserialize:function(a){if(!Object.isString(a))return null;try{return miniLOL.JSON.unserializeSpecial(a.evalJSON())}catch(b){return null}},convert:a}}();
miniLOL.Cookie=function(){function a(a){return Object.extend({expires:new Date(Date.now()+(1).day().ms()),path:"",domain:"",secure:"",raw:false},a||{})}function b(a,b,c){Object.isUndefined(c)&&(c={});return"#{key}=#{value}; #{maxAge}#{expires}#{path}#{domain}#{secure}".interpolate({key:a.encodeURIComponent(),value:b.encodeURIComponent(),maxAge:!Object.isUndefined(c.maxAge)?"max-age=#{0}; ".interpolate([c.maxAge]):"",expires:!Object.isUndefined(c.expires)?"expires=#{0}; ".interpolate([c.expires.toUTCString()]):
"",path:!Object.isUndefined(c.path)?"path=#{0}; ".interpolate([c.path]):"",domain:!Object.isUndefined(c.domain)?"domain=#{0}; ".interpolate([c.domain]):"",secure:c.secure?"secure":""})}function c(){var a=[];window.document.cookie.split(/; /).each(function(b){b=b.split(/=/);a.push(b[0])});return a.uniq()}function d(b,c){var c=a(c),d=window.document.cookie.match(RegExp.escape(b.encodeURIComponent())+"=([^;]*)","g");if(d){var e=[];$A(d).each(function(a){a=a.match(/^.*?=(.*)$/)[1].decodeURIComponent();
e.push(c.raw?a:miniLOL.JSON.unserialize(a)||a)});e.length==1&&(e=e[0]);return e}}function e(c,d){window.document.cookie=b(c,"",Object.extend(a(d),{expires:new Date(0)}))}return Object.extend(Enumerable,{_each:function(a){c().each(function(b){var c=d(b),e=[b,c];e.name=b;e.key=b;e.value=c;a(e)})},encode:b,keys:c,get:d,set:function(c,d,e){e=a(e);e.raw||(d=miniLOL.JSON.serialize(d)||d);window.document.cookie=b(c,d,e)},remove:e,unset:e,clear:function(){c().each(function(a){e(a)})}})}();
miniLOL.Storage=Class.create({initialize:function(a,b){this.name=a;this.backend=miniLOL.Storage.Instances[a]?miniLOL.Storage.Instances[a]:miniLOL.Storage.Instances[a]=new (b||miniLOL.Storage.Backends.available())(a)},get:function(a){return this.backend.get(a.toString())},set:function(a,b,c){return this.backend.set(a.toString(),b,c)},remove:function(a,b){return this.backend.remove(a.toString(),b)},clear:function(a){return this.backend.clear(a)},size:function(){return this.backend.size},save:function(){this.backend.save()}});
miniLOL.Storage.Instances={};
miniLOL.Storage.Backend=Class.create(Hash,{initialize:function($super,b,c){$super((Object.isString(c)?miniLOL.JSON.unserialize(c):c)||{});this.name=miniLOL.Storage.Backend.filter(b);if(Object.isString(c))this.size=c.size},get:function($super,b){return $super(b)},set:function($super,b,c,d){b=$super(b,c);d||this.save();return b},remove:function($super,b,c){b=$super(b);c||this.save();return b},clear:function($super,b){var c=$super();b||this.save();return c},replace:function($super,b){this.size=Object.isString(b)?
b.length:0;return $super(b)},Static:{filter:function(a){return a.replace(/\s/g,"")}}});
miniLOL.Storage.Backends={available:function(){try{return window.localStorage?miniLOL.Storage.Backends.LocalStorage:window.globalStorage?miniLOL.Storage.Backends.GlobalStorage:document.body.addBehavior?miniLOL.Storage.Backends.UserDataBehavior:miniLOL.Storage.Backends.Cookie}catch(a){return miniLOL.Storage.Backends.Null}},LocalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,b){$super(b);this.replace(window.localStorage["__miniLOL.storage."+this.name]||"{}")},save:function(){var a=
this.toJSON(true);this.size=a.length;window.localStorage["__miniLOL.storage."+this.name]=a}}),GlobalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,b){$super(b);this.replace(window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]||"{}")},save:function(){var a=this.toJSON(true);this.size=a.length;window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]=a}}),UserDataBehavior:Class.create(miniLOL.Storage.Backend,{initialize:function($super,
b){$super(b);this.element=document.createElement("link");this.element.addBehavior("#default#userData");$$("head")[0].appendChild(this.element);this.element.load("__miniLOL.storage."+b);var c=this.element.getAttribute("__miniLOL.storage."+this.name)||"{}";this.size=c.length;this.replace(c)},save:function(){var a=this.toJSON(true);this.size=a.length;this.element.setAttribute("__miniLOL.storage."+this.name,a);this.element.save("__miniLOL.storage."+this.name)}}),Cookie:Class.create(miniLOL.Storage.Backend,
{initialize:function($super,b){$super(b);this.replace(miniLOL.Cookie.get("__miniLOL.storage."+this.name,{raw:true})||"{}")},save:function(){var a=this.toJSON(true);this.size=a.length;miniLOL.Cookie.set("__miniLOL.storage."+this.name,a,{expires:31536E3,raw:true})}}),Null:Class.create(miniLOL.Storage.Backend,{save:Function.empty})};
miniLOL.History={interval:0.15,initialize:function(){miniLOL.History.current=window.location.hash||"#";if(Prototype.Browser.Opera&&history.navigationMode)history.navigationMode="compatible";Event.observe(document,":url.change",function(a){miniLOL.History.current=a.memo.toString()||"#"});miniLOL.History.Initializers.get().call()},reset:function(a,b){if(Object.isNumber(a))miniLOL.History.interval=a;Object.isUndefined(miniLOL.History.timer)||clearInterval(miniLOL.History.timer);miniLOL.History.timer=
setInterval(b,miniLOL.History.interval*1E3)},Initializers:{get:function(){return"onhashchange"in window&&!(Prototype.Browser.InternetExplorer&&Prototype.Browser.Version==7)?miniLOL.History.Initializers.Default:Prototype.Browser.InternetExplorer?miniLOL.History.Initializers.InternetExplorer:miniLOL.History.Initializers.Unsupported},Default:function(){Event.observe(window,"hashchange",function(){Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||
"#"))})},Unsupported:function(){document.observe("dom:loaded",function(){miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.Default)})},InternetExplorer:function(){document.observe("dom:loaded",function(){miniLOL.History.IE={check:function(){(!miniLOL.History.IE.element.parentNode||miniLOL.History.IE.element.parentNode.nodeName=="#document-fragment")&&$(document.body).insert({top:miniLOL.History.IE.element})},put:function(a){miniLOL.History.IE.check();var b=miniLOL.History.IE.element.contentWindow.document;
b.open();b.close();b.location.hash=encodeURIComponent(a.substring(1))},get:function(){miniLOL.History.IE.check();return miniLOL.History.IE.element.contentWindow.document.location.hash},element:new Element("iframe",{id:"__miniLOL.History",style:"display: none !important; z-index: -9001 !important;",src:"javascript:false;"})};$(document.body).insert({top:miniLOL.History.IE.element});miniLOL.History.IE.put(miniLOL.History.current);miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.InternetExplorer)})}},
Checkers:{Default:function(){miniLOL.History.current!=window.location.hash&&Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||"#"))},InternetExplorer:function(){var a=miniLOL.History.IE.get(),b=window.location.hash||"#",c=miniLOL.History.current;if(b!=a)b&&b==c?window.location.hash=(miniLOL.History.current=a).substring(1):miniLOL.History.IE.put(miniLOL.History.current=b),Event.fire(document,":url.change",miniLOL.History.current)}}};
miniLOL.History.initialize();
