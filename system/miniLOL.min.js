/* miniLOL is released under AGPLv3. Copyleft meh. [http://meh.doesntexist.org | meh@paranoici.org] */
miniLOL={version:"1.2",initialize:function(){if(miniLOL.initialized)throw Error("miniLOL has already been initialized.");miniLOL.Template.Engine.load("system/templates/HAML.js",{minified:true});miniLOL.initialized=false;miniLOL.path=location.href.match(/^\w+:\/\/.*?(\/.*?)(#|$)/)[1];miniLOL.storage=new miniLOL.Storage("miniLOL.core");miniLOL.resources={};miniLOL.tmp={};[function(){Event.observe(document,":resource.loaded",function(a){if(!(a.memo.resource.name!="miniLOL.config"||a.memo.arguments[0]!=
"resources/config.xml")){miniLOL.config.core||(miniLOL.config.core={});if(!miniLOL.config.core.siteTitle)miniLOL.config.core.siteTitle="miniLOL #{version}".interpolate(miniLOL);if(!miniLOL.config.core.loadingMessage)miniLOL.config.core.loadingMessage="Loading...";if(miniLOL.config.core.homePage){if(miniLOL.config.core.homePage.charAt(0)!="#"&&!miniLOL.config.core.homePage.isURL())miniLOL.config.core.homePage="#"+miniLOL.config.core.homePage}else miniLOL.config.core.homePage="#home";$("__miniLOL.core.style")&&
$("__miniLOL.core.style").remove();miniLOL.config.core.style&&miniLOL.CSS.create(miniLOL.config.core.style,"__miniLOL.core.style");if(!document.title)document.title=miniLOL.config.core.siteTitle}});miniLOL.resource.set(new miniLOL.Resource("miniLOL.config",{initialize:function(){miniLOL.config=this.data},load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.Document.check(c.responseXML,a)){c=miniLOL.Document.fix(c.responseXML).documentElement;var b=
c.getAttribute("domain")||"core";miniLOL.config[b]=Object.extend(miniLOL.config[b]||{},Element.toObject(c))}},onFailure:function(c){miniLOL.error("miniLOL.config: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:c.status,statusText:c.statusText}),true)}});if(miniLOL.error())return false;return true},clear:function(){this.data=miniLOL.config={}}}));miniLOL.resource.get("miniLOL.config").load("resources/config.xml");$(document.body).update(miniLOL.config.core.loadingMessage);
Event.fire(document,":initialization");Event.stopObserving(document,":initialization")},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.menus",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.Document.check(c.responseXML,a)){c=miniLOL.Document.fix(c.responseXML);miniLOL.menus["default"]=c.getElementById("default");$A(c.documentElement.childNodes).each(function(b){if(b.nodeType==Node.ELEMENT_NODE){var d=b.getAttribute("id");if(!d&&
!miniLOL.menus["default"])miniLOL.menus["default"]=b;else miniLOL.menus[d]=b}});miniLOL.menus["default"]||miniLOL.error("Error while analyzing menus.xml\n\nNo default menu was found.",true)}}});if(miniLOL.error())return false;return true},clear:function(){this.data=miniLOL.menus={}}}));miniLOL.resource.get("miniLOL.menus").load("resources/menus.xml")},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.pages",{load:function(a,c){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){miniLOL.Document.check(b.responseXML,
a)||miniLOL.Document.fix(b.responseXML).xpath("//page").each(function(d){var f=d.getAttribute("id");delete miniLOL.pages.cache[f];miniLOL.pages.data[f]=d})},onFailure:function(b){c||miniLOL.error("miniLOL.pages: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:b.status,statusText:b.statusText},true))}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.pages=this.data={data:{},cache:{}}}}));miniLOL.resource.get("miniLOL.pages").load("resources/pages.xml",
true)},function(){miniLOL.resource.set(new miniLOL.Resource("miniLOL.functions",{load:function(a){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(c){miniLOL.Document.check(c.responseXML,a)||miniLOL.Document.fix(c.responseXML).xpath("//function").each(function(b){try{miniLOL.functions[b.getAttribute("name")]=new Function("var text = arguments[0]; var args = arguments[1]; arguments = args; #{code}; return text;".interpolate({code:b.firstChild.nodeValue}))}catch(d){miniLOL.error("Error while creating `#{name}` wrapper from #{path}:\n\n#{error}".interpolate({name:b.getAttribute("name"),
path:a,error:d.toString()}),true)}})},onFailure:function(c){miniLOL.error("miniLOL.functions: Error while loading #{path} (#{status} - #{statusText})".interpolate({path:a,status:c.status,statusText:c.statusText}),true)}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.functions=this.data={}},render:function(a,c,b){a.split(/\s*,\s*/).each(function(d){if(Object.isFunction(this.data[d]))c=this.data[d](c,b)},this);return c}}));miniLOL.resource.get("miniLOL.functions").load("resources/functions.xml")},
function(){miniLOL.config.core.theme?miniLOL.error(!miniLOL.theme.load(miniLOL.config.core.theme)):miniLOL.error(!miniLOL.theme.deprecated())},function(){miniLOL.menu.enabled()&&miniLOL.menu.set(miniLOL.config.core.loadingMessage)},function(){miniLOL.content.set("Loading modules...");miniLOL.resource.set(new miniLOL.Resource("miniLOL.modules",{load:function(a,c){new Ajax.Request(a,{method:"get",asynchronous:false,onSuccess:function(b){if(!miniLOL.Document.check(b.responseXML,a)){miniLOL.module.path=
b.responseXML.documentElement.getAttribute("path")||"modules";var d=miniLOL.Document.fix(b.responseXML).xpath("//module").filter(function(f){return f.getAttribute("name")});d.each(function(f,g){c&&miniLOL.content.set("Loading `#{name}`... [#{number}/#{total}]".interpolate({name:f.getAttribute("name"),number:g+1,total:d.length}));miniLOL.module.load(f.getAttribute("name"))||miniLOL.error(true);if(miniLOL.error())throw $break;},this)}},onFailure:function(b){miniLOL.error("Error while loading modules.xml (#{status} - #{statusText})".interpolate(b),
true)}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.modules=this.data={}}}));miniLOL.resource.get("miniLOL.modules").load("resources/modules.xml",true)},function(){miniLOL.menu.enabled()&&miniLOL.menu.change("default")},function(){miniLOL.content.set("Checking dependencies...");try{miniLOL.module.dependencies.check()}catch(a){miniLOL.error("`#{module}` requires `#{require}`".interpolate(a),true)}}].each(function(a){try{a()}catch(c){miniLOL.error(c.toString(),true)}if(miniLOL.error())throw $break;
});if(miniLOL.error())return false;Event.observe(document,"unload",function(a){Event.fire(document,":finalization",a)});Event.observe(document,":url.change",function(a){a.stopped||(a.memo?miniLOL.go(a.memo):miniLOL.go(miniLOL.config.core.homePage))});Event.observe(document,":go",miniLOL.tmp.fixScroll=function(){$(document.body).scrollTo()});miniLOL.config.core.initialization&&eval(miniLOL.config.core.initialization);miniLOL.go(/[#?]./.test(location.href)?location.href.replace(/^.*[#?]/,"#"):miniLOL.config.core.homePage);
Event.observe(document,":refresh",function(){miniLOL.resource.reload("miniLOL.config","miniLOL.pages","miniLOL.menus")});new PeriodicalExecuter(function(){Event.fire(document,":refresh")},miniLOL.config.core.refreshEvery||360);Event.fire(document,":initialized");Event.stopObserving(document,":initialized");miniLOL.initialized=true},error:function(a,c,b){if(miniLOL.error.major)return true;if(Object.isUndefined(a))return Boolean(miniLOL.error.major);if(Object.isBoolean(a))return miniLOL.error.major=
a;if(!miniLOL.error.done){b=b||miniLOL.theme.content()||document.body;$(b).update("<pre>"+a.replace(/<br\/>/g,"\n").escapeHTML()+"</pre>");miniLOL.error.done=true;if(c)miniLOL.error.major=true;Event.fire(document,":error",{text:a,element:b,major:c})}},content:{set:function(a){a={content:a};Event.fire(document,":content.set",a);miniLOL.theme.content().update(a.content)},get:function(){return miniLOL.theme.content().innerHTML}},resource:{set:function(a,c){if(Object.isString(a))miniLOL.resources[a]=
c;else miniLOL.resources[a.name]=a},get:function(a){return miniLOL.resources[a]},reload:function(a){if(arguments.length>1)a=$A(arguments);if(Object.isArray(a))a.each(function(b){miniLOL.resource.get(b).reload()});else if(Object.isString(a))miniLOL.resource.get(name).reload();else for(var c in miniLOL.resources)miniLOL.resource.get(c).reload()}},theme:{style:{list:{},load:function(a,c,b){c=c||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.load",
{name:a,path:c,overload:Boolean(b)});if(miniLOL.theme.style.exists(a,c))if(b)miniLOL.theme.style.unload(miniLOL.theme.style.list[a],c);else return true;a="#{path}/#{style}.css".interpolate({path:c,style:a});c=miniLOL.CSS.include(a,true);if(!c)return false;miniLOL.theme.style.list[a]=c;return true},unload:function(a,c){c=c||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.unload",{name:a,path:c});var b="#{path}/#{style}.css".interpolate({path:c,
style:a});if(miniLOL.theme.style.list[b]){miniLOL.theme.style.list[b].remove();delete miniLOL.theme.style.list[b]}},exists:function(a,c){c=c||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});return Boolean(miniLOL.theme.style.list["#{path}/#{style}.css".interpolate({path:c,style:a})])}},template:{initialize:function(){miniLOL.theme.templates={}},setDefaults:function(){if(!miniLOL.theme.templates.list)miniLOL.theme.templates.list={};miniLOL.theme.templates.list["default"]=
Object.extend({global:"<div #{attributes}>#{data}</div>",before:"#{data}",after:"#{data}",link:'<div class="#{class}" id="#{id}">#{before}<a href="#{href}" target="#{target}" #{attributes}>#{text}</a>#{after}</div>',item:'<div class="#{class}" id="#{id}">#{before}<span #{attributes}>#{text}</span>#{after}</div>',nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'},miniLOL.theme.templates.list["default"]||{});miniLOL.theme.templates.list.table=
Object.extend({global:"<table #{attributes}>#{data}</table>",before:"#{data}",after:"#{data}",link:'<tr><td>#{before}</td><td><a href="#{href}" target="#{target}" #{attributes}>#{text}</a></td><td>#{after}</td></tr>',item:"<tr><td>#{before}</td><td>#{text}</td><td>#{after}</td></tr>",nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'},miniLOL.theme.templates.list.table||{});if(!miniLOL.theme.templates.menu)miniLOL.theme.templates.menu=
{};miniLOL.theme.templates.menu.layers=Object.extend({"0":{menu:'<div class="menu">#{data}</div>',item:'<span class="item"><a href="#{href}">#{text}</a></span>'}},miniLOL.theme.templates.menu.layers||{})}},load:function(a,c,b){miniLOL.theme.unload();var d=miniLOL.theme.path,f=miniLOL.theme.name,g=a.match(/^(.+?):(.+)$/);if(g){miniLOL.theme.path=g[1];miniLOL.theme.name=g[2]}else{miniLOL.theme.path="themes";miniLOL.theme.name=a}if(miniLOL.theme.name==f&&miniLOL.theme.path==d)return true;g="#{path}/#{theme}".interpolate({path:miniLOL.theme.path,
theme:a});Event.fire(document,":theme.load",{name:a,runtime:Boolean(c)});var i;new Ajax.Request("#{path}/theme.xml".interpolate({path:g,theme:a}),{method:"get",asynchronous:false,onSuccess:function(h){var e=miniLOL.theme.information={};h=miniLOL.Document.fix(h.responseXML);e.name=h.documentElement.getAttribute("name")||"Unknown";e.author=h.documentElement.getAttribute("author")||"Anonymous";e.homepage=h.documentElement.getAttribute("homepage")||"";miniLOL.theme.menu.node=h.documentElement.getAttribute("menu")||
"menu";miniLOL.theme.content.node=h.documentElement.getAttribute("content")||"body";try{var j=h.getElementsByTagName("initialize");miniLOL.theme.initialize=j.length?new Function(j[0].firstChild.nodeValue):new Function}catch(k){i="An error occurred on the theme#initialize function:\n\n"+k.toString();return false}try{var l=h.getElementsByTagName("finalize");miniLOL.theme.finalize=l.length?new Function(l[0].firstChild.nodeValue):new Function}catch(m){i="An error occurred on the theme#finalize function:\n\n"+
m.toString();return false}e.styles=[];h.xpath("/theme/styles/style").each(function(n){e.styles.push(n.getAttribute("name"))});h.xpath("/theme/templates/*").each(function(n){miniLOL.theme.templates[n.nodeName]=Element.toObject(n)},this);miniLOL.theme.template.setDefaults()},onFailure:function(){i="Could not load theme#information."}});if(i){miniLOL.error(i,true);return false}if(d=miniLOL.utils.get("#{path}/template.html".interpolate({path:g,theme:a}),{minified:true}))$(document.body).update(d);else{miniLOL.error("Could not load template.html.",
true);return false}miniLOL.theme.information.styles.each(function(h){if(!miniLOL.theme.style.load(h,false,true)){miniLOL.error("Could not load `#{style}` style/".interpolate({style:h}),true);throw $break;}});if(miniLOL.error())return false;if(c&&miniLOL.initialized){miniLOL.menu.change(miniLOL.menu.current,true);miniLOL.go(location.href)}miniLOL.theme.tmp={};!b&&miniLOL.theme.initialize&&miniLOL.theme.initialize.call(miniLOL.theme.tmp);Event.fire(document,":theme.loaded",{name:a,runtime:Boolean(c)});
return true},unload:function(a){miniLOL.theme.template.initialize();if(miniLOL.theme.name){Event.fire(document,":theme.unload",{name:miniLOL.theme.name});if(!a&&miniLOL.theme.finalize)miniLOL.theme.finalize.call(miniLOL.theme.tmp||{});delete miniLOL.theme.tmp;$A(miniLOL.theme.information.styles).each(function(c){miniLOL.theme.style.unload(c)});delete miniLOL.theme.name;delete miniLOL.theme.initialize;delete miniLOL.theme.finalize;delete miniLOL.theme.information}},content:function(){return $(miniLOL.theme.content.node)},
menu:function(){return $(miniLOL.theme.menu.node)},deprecated:function(){miniLOL.theme.path="themes";miniLOL.theme.content.node=miniLOL.config.core.contentNode||"body";miniLOL.theme.menu.node=miniLOL.config.core.menuNode||"menu";miniLOL.theme.template.initialize();new Ajax.Request("resources/template.html",{method:"get",asynchronous:false,onSuccess:function(a){$(document.body).update(a.responseText)},onFailure:function(){$(document.body).update('<div id="menu"></div><div id="body"></div>')}});miniLOL.CSS.include("resources/style.css");
miniLOL.theme.template.setDefaults();return true}},menu:{set:function(a){miniLOL.menu.enabled()&&miniLOL.theme.menu().update(a)},get:function(a,c){c=c||0;if(!miniLOL.menu.enabled())return"";a=a||"default";if(!miniLOL.menu.exists(a))return null;return miniLOL.menu.parse(miniLOL.menus[a],c)},change:function(a,c){if(!(a==miniLOL.menu.current&&!c)){var b=miniLOL.menu.get(a);if(b){miniLOL.menu.set(b);miniLOL.menu.current=a}else{b="The menu `#{name}` does not exist.".interpolate({name:a});miniLOL.error(b,
true);return b}Event.fire(document,":menu.change",miniLOL.menus[a])}},enabled:function(){return Boolean(miniLOL.menus["default"])},exists:function(a){return Boolean(miniLOL.menus[a])},parse:function(a,c){c=c||0;var b=miniLOL.theme.templates.menu;if(!b||!a)if(miniLOL.error())return false;var d=true,f="";$A(a.childNodes).each(function(g){switch(g.nodeType){case Node.ELEMENT_NODE:f+=g.nodeName=="menu"?miniLOL.menu.parsers.layer(b,c).menu.interpolate({data:miniLOL.menu.parse(g,c)}):g.nodeName=="item"?
miniLOL.menu.parsers.item(g,b,c):miniLOL.menu.parsers.other(g,b);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:d||(f+=g.nodeValue);d=false;break}});return f.blank()?"":c==0?miniLOL.menu.parsers.layer(b,c).menu.interpolate({data:f}):f},parsers:{layer:function(a,c){var b={menu:"",item:""};if(a){b=Object.extend(b,a.layers["_"+c]||a.layers["default"]||{});if(!b.menu)b.menu="#{data}";if(!b.item)b.item='<a href="#{href}" #{attributes}>#{text}</a> '}return b},item:function(a,c,b){var d=a.cloneNode(true),
f=d.getAttribute("class")||"";d.removeAttribute("class");var g=d.getAttribute("id")||"";d.removeAttribute("id");var i=d.getAttribute("href")||"";d.removeAttribute("href");return miniLOL.menu.parsers.layer(c,b).item.interpolate(Object.extend(Object.fromAttributes(d.attributes),{"class":f,id:g,href:i,attributes:String.fromAttributes(d.attributes),text:Element.getFirstText(a),data:miniLOL.menu.parse(a,b+1)}))},other:function(a,c){if(!a||!c)return"";var b=c[a.nodeName];if(!b)return"";var d={};$A(a.childNodes).each(function(f){if(f.nodeType==
Node.ELEMENT_NODE)d[f.nodeName]=miniLOL.menu.parsers.other(f,c)});d.text=Element.getFirstText(a);return b.interpolate(Object.extend(d,Object.fromAttributes(a.attributes)))}}},page:{get:function(a,c,b){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.get",{name:a,queries:c});var d=miniLOL.pages.data[a],f=c.type;if(!d){miniLOL.content.set("404 - Not Found");return false}if(d.getAttribute("alias")){typeof c[a]!="string"&&delete c[a];delete c.page;if(!c.title&&d.getAttribute("title"))c.title=
d.getAttribute("title").encodeURIComponent();if(c=Object.toQueryString(c))c="&"+c;d=d.getAttribute("alias");if(!d.isURL()&&d.charAt(0)!="#")d="#"+d;return miniLOL.go(d+c)}if(Object.isUndefined(f))f=d.getAttribute("type");if(b){b={};Object.extend(b,miniLOL.config.core);Object.extend(b,c);document.title=(c.title||d.getAttribute("title")||miniLOL.config.core.siteTitle).interpolate(b)}if(miniLOL.pages.cache[a]){f?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(f,miniLOL.pages.cache[a],
c)):miniLOL.content.set(miniLOL.pages.cache[a]);return true}if(b=d.getAttribute("arguments")){b=b.replace(/[ ,]+/g,"&amp;").toQueryParams();for(var g in b)if(c[g]==null)c[g]=b[g]}d=miniLOL.page.parse(d);miniLOL.pages.cache[a]=d;if(f)d=miniLOL.resource.get("miniLOL.functions").render(f,d,c);miniLOL.content.set(d);return true},parse:function(a,c){var b="";$A(a.childNodes).each(function(d){switch(d.nodeType){case Node.ELEMENT_NODE:if(Object.isFunction(miniLOL.page.parsers[d.nodeName]))b+=miniLOL.page.parsers[d.nodeName](d,
c);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:b+=d.nodeValue;break}});return b},parsers:{list:function(a,c){var b=a.cloneNode(false);c=c||[a];var d=b.getAttribute("before")||c[0].getAttribute("before")||"";b.removeAttribute("before");var f=b.getAttribute("after")||c[0].getAttribute("after")||"";b.removeAttribute("after");var g=b.getAttribute("arguments")||c[0].getAttribute("arguments")||"";b.removeAttribute("arguments");var i=b.getAttribute("type")||c[0].getAttribute("type")||"";b.removeAttribute("type");
var h=b.getAttribute("menu")||c[0].getAttribute("menu");b.removeAttribute("menu");var e=b.getAttribute("template");b.removeAttribute("template");miniLOL.theme.templates.list[e]||(e="default");var j="";$A(a.childNodes).each(function(k){if(k.nodeType==Node.ELEMENT_NODE)if(k.nodeName=="link"){var l=k.cloneNode(true),m=l.getAttribute("href");l.removeAttribute("href");var n=l.getAttribute("target");l.removeAttribute("target");k=l.getAttribute("text")||(l.firstChild?l.firstChild.nodeValue:m);var o=l.getAttribute("before")||
d||"";l.removeAttribute("before");var r=l.getAttribute("after")||f||"";l.removeAttribute("after");var u=l.getAttribute("domain")||"";l.removeAttribute("domain");var s=l.getAttribute("arguments")||g;l.removeAttribute("arguments");var t=l.getAttribute("menu")||h;l.removeAttribute("menu");var p=l.getAttribute("title")||"";l.removeAttribute("title");var q=m.isURL(),v=l.getAttribute("class")||"";l.removeAttribute("class");var w=l.getAttribute("id")||"";l.removeAttribute("id");if(n||q){m=!q?"data/"+m:m;
n=n||"_blank"}else{q=l.getAttribute("type")||i||"";l.removeAttribute("type");if(u=="in"||m.charAt(0)=="#"){if(m.charAt(0)!="#")m="#"+m}else m="#page="+m;s=s?"&"+s.replace(/[ ,]+/g,"&amp;"):"";q=q?"&type="+q:"";t=miniLOL.menu.enabled()&&t?"&amp;menu="+t:"";n="";if(p){p=p.interpolate({text:k,href:m});p="&title="+p.encodeURIComponent()}m=m+s+q+t+p}j+=miniLOL.theme.templates.list[e].link.interpolate(Object.extend(Object.fromAttributes(l.attributes),{"class":v,id:w,attributes:String.fromAttributes(l.attributes),
before:miniLOL.theme.templates.list[e].before.interpolate({data:o}),after:miniLOL.theme.templates.list[e].after.interpolate({data:r}),href:m,target:n,text:k,title:p}))}else if(k.nodeName=="item"){l=k.cloneNode(true);k=l.getAttribute("text")||(l.firstChild?l.firstChild.nodeValue:"");o=l.getAttribute("before")||d||"";l.removeAttribute("before");r=l.getAttribute("after")||f||"";l.removeAttribute("after");m=l.getAttribute("class")||"";l.removeAttribute("class");n=l.getAttribute("id")||"";l.removeAttribute("id");
j+=miniLOL.theme.templates.list[e].item.interpolate(Object.extend(Object.fromAttributes(l.attributes),{"class":m,id:n,attributes:String.fromAttributes(l.attributes),before:miniLOL.theme.templates.list[e].before.interpolate({data:o}),after:miniLOL.theme.templates.list[e].after.interpolate({data:r}),text:k}))}else if(k.nodeName=="list")j+=miniLOL.page.parsers.list(k,[a]);else{if(k.nodeName=="nest"){toParse=k.cloneNode(true);o=k.getAttribute("before")||d||"";r=k.getAttribute("after")||f||"";j+=miniLOL.theme.templates.list[e].nest.interpolate({"class":k.getAttribute("class")||
"",style:k.getAttribute("style")||"",before:miniLOL.theme.templates.list[e].before.interpolate({data:o}),after:miniLOL.theme.templates.list[e].after.interpolate({data:r}),data:miniLOL.page.parse(toParse,[a])})}}else if(k.nodeType==Node.CDATA_SECTION_NODE||k.nodeType==Node.TEXT_NODE)k.nodeValue.blank()||(j+=miniLOL.theme.templates.list[e].data.interpolate({data:k.nodeValue}))});return miniLOL.theme.templates.list[e].global.interpolate(Object.extend(Object.fromAttributes(b.attributes),{attributes:String.fromAttributes(b.attributes),
data:j}))},include:function(a){a.cloneNode(false);var c=a.getAttribute("href");a.removeAttribute("href");a.getAttribute("update");a.removeAttribute("update");var b=location.href.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/)[3],d=c.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/);d&&d[3]!=b&&'<iframe src="#{href}" #{attributes}></iframe>'.interpolate({href:c,attributes:Object.fromAttributes(a.attributes)});return""}},load:function(a,c,b){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,
":page.load",{path:a,queries:c});if(b)document.title=(c.title||miniLOL.config.core.siteTitle).interpolate(Object.extend(Object.extend({},miniLOL.config.core),c));new Ajax.Request("data/#{path}?#{queries}".interpolate({path:a,queries:Object.toQueryString(c)}),{method:"get",cached:!c.nocache,onSuccess:function(d){c.type?miniLOL.content.set(miniLOL.resource.get("miniLOL.functions").render(c.type,d.responseText,c)):miniLOL.content.set(d.responseText);Event.fire(document,":page.loaded",d);Event.fire(document,
":go",b.getHashFragment())},onFailure:function(d){miniLOL.content.set("#{status} - #{statusText}".interpolate(d));Event.fire(document,":page.loaded",d)}})}},module:{create:function(a,c){if(!c){miniLOL.error("Like, do I know how this module is done?",true);return false}Event.fire(document,":module.create",{name:a,module:c});c.name=a;c.root="#{path}/#{module}".interpolate({path:miniLOL.module.path,module:a});if(!Object.isArray(c.dependencies))c.dependencies=[];if(!c.type)c.type="active";if(!c.execute)c.execute=
new Function;for(var b in c)if(Object.isFunction(c[b]))c[b]=c[b].bind(c);c.storage=new miniLOL.Storage("module."+a);if(c.initialize)try{if(c.initialize()===false){if(miniLOL.error())return false;throw Error("An error occurred while initializing the module.");}}catch(d){d.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,module:a});throw d;}miniLOL.modules[a]=c;$A(c.aliases).each(function(f){miniLOL.modules[f]=c});document.fire(":module.created",c);
return c},execute:function(a,c,b){if(!a){miniLOL.error("What module should be executed?");return false}if(!miniLOL.module.exists(a)){b&&miniLOL.error("The module `#{name}` is not loaded.".interpolate({name:a}));return false}if(b){miniLOL.content.set(miniLOL.config.core.loadingMessage);b={};Object.extend(b,miniLOL.config.core);Object.extend(b,c);document.title=(c.title||miniLOL.module.get(a).title||miniLOL.config.core.siteTitle).interpolate(b)}c=Object.isArray(c)?c:[c];Event.fire(document,":module.execute",
{name:a,arguments:c});var d;try{d=miniLOL.module.get(a).execute.apply(miniLOL.module.get(a),c)}catch(f){f.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,module:a});miniLOL.error("An error occurred while executing the module `#{name}`\n\n#{file} @ #{line}:\n#{error}".interpolate({name:a,file:f.fileName,line:f.lineNumber,error:f.toString()}),true);return false}Event.fire(document,":module.executed",{name:a,arguments:c,result:d});if(Object.isUndefined(d))d=
true;return d},load:function(a){Event.fire(document,":module.load",a);try{miniLOL.utils.require("#{path}/#{module}/main.js".interpolate({path:miniLOL.module.path,module:a}),{minified:true});if(miniLOL.error())return false;if(!miniLOL.module.exists(a))throw Error("Something went wrong while loading the module `#{name}`.".interpolate({name:a}));Event.fire(document,":module.loaded",a);return true}catch(c){miniLOL.error("An error occurred while loading the module `#{name}`\n\n#{root}/#{file} @ #{line}:\n\n#{error}".interpolate({name:a,
root:miniLOL.path,file:c.fileName,line:c.lineNumber,error:c.toString()}),true);return false}},get:function(a){return miniLOL.modules[a]},exists:function(a){return Boolean(miniLOL.module.get(a))},dependencies:{check:function(){for(var a in miniLOL.modules){var c=miniLOL.module.get(a).dependencies;if(c)for(var b=0;b<c.length;b++)if(!miniLOL.module.get(c[b]))throw{module:a,require:c[b]};}return true},needs:function(a,c,b,d){miniLOL.module.get(a)?c.call(b||window):setTimeout(function(){miniLOL.module.dependencies.needs(a,
c,b)},d||10)}}},go:function(a,c){if(!Object.isString(a))return false;if(a.isURL()){a=a.parseURL();if(a.host!=location.host||!a.path.startsWith(miniLOL.path))location.href=a.full;else a=a.full.replace(RegExp("^.*"+miniLOL.path),"")}else if(a.charAt(0)!="#")a="#"+a;a=a.replace(/#!/,"#");var b=a.toQueryParams(),d=a.match(/#(([^=&]*)&|([^=&]*)$)/),f=false;b.menu&&miniLOL.menu.change(b.menu);if(d){b.page=d[2]||d[3];if(b.page)f=miniLOL.page.get(b.page,b,a);else c||(f=miniLOL.go("#{page}&#{queries}".interpolate({page:miniLOL.config.core.homePage,
queries:Object.toQueryString(b)}),true))}else if(b.module)f=miniLOL.module.execute(b.module,b,true);else if(b.page){d=b.page;delete b.page;miniLOL.page.load(d,b,a)}else f=miniLOL.go(miniLOL.config.core.homePage);f&&Event.fire(document,":go",a.getHashFragment());return f}};
(function(){if(Prototype.Browser.IE)Prototype.Browser.InternetExplorer=true;if(Prototype.Browser.Gecko)Prototype.Browser.Mozilla=true;if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=true;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=true;if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Good=true;else Prototype.Browser.Bad=true;Prototype.Browser.Name=window.navigator.appName;var a=window.navigator.appVersion;try{if(Prototype.Browser.IE)Prototype.Browser.Version=
parseFloat(a.match(/MSIE ([^;]*)/)[1]);else if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Version=parseFloat(a);else throw null;}catch(c){Prototype.Browser.Version=0}if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:(this.stack||"").replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};
else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};if(Prototype.Browser.IE){if(!window.DOMParser)window.DOMParser=
Class.create({parseFromString:function(b){var d=new AciveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(b);return d}});if(!window.XMLSerializer)window.XMLSerializer=Class.create({serializeToString:function(b){return b.xml}})}})();Function.empty=function(){};Object.extend(Function,function(){return{parse:function(a){matches=a.match(/^function\s*\((.*?)\)[\s\n]*\{([\s\S]*)\}[\s\n]*/m);if(!matches)return null;a=matches[1].split(/\s*,\s*/);return new Function(a,matches[2])}}}());
Object.extend(Function.prototype,function(){return{clone:function(){return Function.parse(this.toString())}}}());
Object.extend(Object,function(){var a,c;if(function(){for(var e in{toString:1})if(e==="toString")return false;return true}()){var b=Object.keys,d=Object.values,f=["toString","valueOf"];a=function(e){var j=b(e);f.each(function(k){e[k]!=Object.prototype[k]&&j.push(k)});return j};c=function(e){var j=d(e);f.each(function(k){e[k]!=Object.prototype[k]&&j.push(e[k])});return j}}else{a=Object.keys;c=Object.values}var g=Object.isFunction(Object.defineProperty)?Object.defineProperty:function(e,j,k){Object.isFunction(k.get)&&
Object.isFunction(e.__defineGetter__)&&e.__defineGetter__(j,k.get);Object.isFunction(k.set)&&Object.isFunction(e.__defineSetter__)&&e.__defineSetter__(j,k.set)};if(Object.isFunction(Object.defineProperties))var i=Object.defineProperties;else Object.defineProperties=function(e,j){for(var k in j)Object.defineProperty(e,k,j[k])};if(Object.isFunction(Object.create))var h=Object.create;else Object.create=function(e,j){var k=Object(e);Object.defineProperties(k,j);return k};return{is:function(e,j){return!Object.isUndefined(j)&&
(j instanceof e||j==e)},isObject:function(e){return typeof e=="object"&&e.constructor===Object},isBoolean:function(e){return typeof e=="boolean"||e.constructor===Boolean},isRegExp:function(e){return!Object.isUndefined(e)&&e.constructor==window.RegExp},isClass:function(e){return Boolean(e["__miniLOL.Class__"])},isDocument:function(e){return e.nodeType===Node.DOCUMENT_NODE},isXML:function(e){if(typeof e!=="object")return false;e=e.ownerDocument||e;if(!e.documentElement)return false;return e.documentElement.nodeName!=
"HTML"},fromAttributes:function(e){for(var j={},k=0;k<e.length;k++)j[e.item(k).nodeName]=e.item(k).nodeName;return j},toQueryString:function(e){var j="";for(var k in e)j+="#{name}=#{value}&".interpolate({name:k,value:e[k]});return j.substr(0,j.length-1)},keys:a,values:c,extend:function(e,j,k){k=Object.isUndefined(k)?true:Boolean(k);for(var l=Object.keys(j||{}),m=0,n=l.length;m<n;m++){var o=l[m];if(k||Object.isUndefined(destionation[o]))e[o]=j[o]}return e},extendAttributes:function(e,j,k){k=Object.isUndefined(k)?
true:Boolean(k);for(var l in j)if(k||Object.isUndefined(destionation[l]))(function(){var m;e[l]=function(n,o){return Object.isUndefined(n)&&!o?Object.isFunction(j[l].get)?j[l].get(m):m:Object.isFunction(j[l].set)?m=j[l].set(m,n):m=n}})();return e},without:function(e,j){var k=Object.extend({},e);if(Object.isArray(j))j.each(function(l){delete k[l]});else delete k[j];return k},defineProperty:g,defineProperties:i,create:h}}());
Object.extend(String,function(){return{fromAttributes:function(a){for(var c="",b=0;b<a.length;b++)c+='#{name}="#{value}" '.interpolate({name:a.item(b).nodeName,value:a.item(b).nodeValue});return c},fromXML:function(a){if(!Object.isXML(a))return false;return(new XMLSerializer).serializeToString(a)}}}());
Object.extend(String.prototype,function(){function a(g){Object.isRegExp(g)||(g=/&/);var i={},h=this.match(/[?#](.*?)([#?]|$)/);if(!h)return i;g=h[1].split(g);for(h=0;h<g.length;h++){var e=g[h].split(/=/),j=e[0].decodeURIComponent();if(e=e[1])if(Object.isUndefined(i[j]))i[j]=e.decodeURIComponent();else if(Object.isArray(i[j]))i[j].push(e);else i[j]=[i[j],e];else i[j]=true}return i}var c=window.encodeURI,b=window.decodeURI,d=window.encodeURIComponent,f=window.decodeURIComponent;return{toQueryParams:a,
parseQuery:a,toXML:function(){return(new DOMParser).parseFromString(this,"text/xml")},isURL:function(){return/^(\w+):(\/\/.+?(:\d)?)(\/)?/.test(this)||/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/.test(this)},parseURL:function(){var g;if(g=this.match(/^mailto:(([\w.%+-]+)@([\w.]+\.[A-Za-z]{2,4}))$/))return{protocol:"mailto",uri:g[1],user:g[2],host:g[3]};if(g=this.match(/^((\w+):\/\/(((.+?)(:(\d+))?)(\/.*)?))$/))return{full:g[1],protocol:g[2],uri:g[3],host:g[4],hostname:g[5],port:g[7],path:g[8]};return false},
blank:function(){return this==0},getHashFragment:function(){var g=this.match(/(#.*)$/);return g?g[1]:""},splitEvery:function(g){for(var i=[],h=0;h<this.length;h+=g)i.push(this.substr(h,g));return i},test:function(g){return g.test(this)},commonChars:function(g){return this.toArray().intersect(g.toArray())},format:function(g){var i=this;for(var h in g)i=i.replace(RegExp("\\{"+h+"\\}","g"),g[h].toString());return i},reverse:function(){return this.toArray().reverse().join("")},translate:function(g,i){var h=
this;i?Object.keys(g).each(function(e){if(!i[e])throw Error("The second table value is missing.");h=g[e].is(RegExp)?h.replace(eval(g[e].global?g[e].toString():g[e].toString()+"g")):h.replace(RegExp(g[e],"g"),i[e])}):Object.values(g).each(function(e){if(e.length!=2)throw Error("The array has to be [regex, translation].");h=e[0].is(RegExp)?h.replace(eval(e[0].global?e[0].toString():e[0].toString()+"g"),e[1]):h.replace(RegExp(e[0],"g"),e[1])});return h},interpolate:function(g,i){return Object.isRegExp(i)?
(new Template(this,i)).evaluate(g):(new miniLOL.Template(this,i)).evaluate(g)},toNumber:function(g){return g?parseInt(this):parseFloat(this)},toBase:function(g){return this.toNumber().toBase(g)},fromBase:function(g){return parseInt(this,g)},toCode:function(){return this.charCodeAt(0)},toPaddedString:function(g,i,h){i=Object.isUndefined(h||i)?"0":(h||i).toString();return i.times(g-this.length)+this},toInvertedCase:function(){for(var g="",i=0,h=this.length;i<h;i++){var e=this.charAt(i),j=e.toLowerCase(),
k=e.toUpperCase();g+=k==j?j:e==j?k:j}return g},encodeURI:function(){return c(this)},decodeURI:function(){return b(this)},encodeURIComponent:function(){return d(this)},decodeURIComponent:function(){return f(this)}}}());
Object.extend(Number.prototype,function(){function a(){return this*1E3}function c(){return this}function b(){return this*60}function d(){return this*60*60}function f(){return this*60*60*24}function g(){return this*60*60*24*7}function i(){return this*60*60*24*375}return{milliseconds:a,ms:a,seconds:c,second:c,minutes:b,minute:b,hours:d,hour:d,days:f,day:f,weeks:g,week:g,years:i,year:i,upTo:function(h,e,j){$R(this,h+1,true).each(e,j);return this},isEven:function(){return this%2==0},isOdd:function(){return this%
2!=0},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)},log:function(){return Math.log(this)},pow:function(h){return Math.pow(this,h)},sqrt:function(){return Math.sqrt(this)},sin:function(){return Math.sin(this)},cos:function(){return Math.cos(this)},tan:function(){return Math.tan(this)},asin:function(){return Math.asin(this)},acos:function(){return Math.acos(this)},atan:function(){return Math.atan(this)},
toPaddedString:function(h,e,j){j=Object.isUndefined(j)?"0":j.toString();e=this.toString(e||10);return j.times(h-e.length)+e},toBase:function(h){return this.toString(h).toUpperCase()},toChar:function(){return String.fromCharCode(this)},digits:function(){var h=this.toString().match(/e(.*)$/);return h?h[1].toNumber()>0?1+h[1].toNumber():0:this.toString().length},ordinalized:function(){switch(parseInt(this)){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}}());
Object.extend(Enumerable,function(){return{empty:function(){return this.length==0}}}());Object.extend(Array.prototype,Enumerable);Hash.addMethods(function(){var a=Hash.prototype.toJSON;return{remove:Hash.prototype.unset,clear:function(){var c=this._object;this._object={};return c},replace:function(c){var b=this._object;this._object=Object.isString(c)?miniLOL.JSON.unserialize(c):Object.extend({},c);return b},toJSON:function(c){return c?miniLOL.JSON.serialize(this._object)||"{}":a.call(this)}}}());
(function(){Date.weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.months=["January","February","March","April","May","June","July","August","September","October","November","December"];var a={d:2,H:2,I:2,j:3,k:2,l:2,m:2,M:2,N:9,S:2,U:2,V:2,W:2,y:2,i:3};Object.extend(Date,function(){var b=Date.parse;return{parse:function(d){if(!d.include("%"))return b(d)}}}());var c={flag:{"-":function(b){return b},_:function(b,d){return b.toPaddedString(d,10," ")},"0":function(b,
d){return b.toPaddedString(d,10,"0")},"^":function(b,d){return b.toString().toUpperCase().toPaddedString(d," ")},"#":function(b,d){return b.toString().toInvertedCase().toPaddedString(d," ")}},"%":function(){return"%"},a:function(b){return Date.weekDays[b.getDay()].substr(0,3)},A:function(b){return Date.weekDays[b.getDay()]},b:function(b){return Date.months[b.getMonth()].substr(0,3)},B:function(b){return Date.months[b.getMonth()]},c:function(b){return b.format("%a %b %_d %X %Y")},C:function(b){return b.getFullYear().toString().substr(0,
2)},d:function(b){return b.getDate()},D:function(b){return b.format("%m/%d/%y")},e:function(b){return b.format("%_d")},F:function(b){return b.format("%Y-%m-%d")},g:function(b){return b.format("%y")},G:function(b){return b.format("%Y")},h:function(b){return b.format("%b")},H:function(b){return b.getHours()},I:function(b){b=b.getHours();return b+1>12?(b+1)/2:b+1},j:function(b){var d=new Date;d.setFullYear(b.getFullYear());d.setDate(1);d.setMonth(0);return((b.getTime()-d.getTime())/1E3/60/60/24).ceil()},
k:function(b){return b.format("%_H")},l:function(b){return b.format("%_l")},m:function(b){return b.getMonth()+1},M:function(b){return b.getMinutes()},n:function(){return"\n"},N:function(b){return b.getMilliseconds()*1E6},p:function(b){return b.getHours()>12?"PM":"AM"},P:function(b){return b.format("%#p")},r:function(b){return b.format("%I:%M:%S %p")},R:function(b){return b.format("%H:%M")},s:function(b){return b.getDate()},S:function(b){return b.getSeconds()},t:function(){return"\t"},T:function(b){return b.format("%H:%M:%S")},
u:function(b){return b.getDay()==0?7:b.getDay()},U:function(b){var d=new Date;d.setFullYear(b.getFullYear());d.setDate(1);d.setMonth(0);return((b.getTime()-d.getTime())/1E3/60/60/24/7).ceil()},V:function(b){return b.format("%U")},w:function(b){return b.getDay()},W:function(b){return b.format("%U")},x:function(b){return b.format("%m/%d/%y")},X:function(b){return b.format("%T")},y:function(b){return b.getFullYear().toString().substr(2,2)},Y:function(b){return b.getFullYear()},E:function(b){if(b.getMonth()%
2==0)return 31;if(b.getMonth()==1)return b.getFullYear()%4==0?29:28;return 30},o:function(b){return b.getDate().ordinalized()},O:function(b){return b.getFullYear()%4?0:1},i:function(b){var d=new Date(b);d.setHours(0);d.setSeconds(0);d.setMinutes(0);return((b.getTime()-d.getTime())/1E3/86.4).toFixed(2)}};Object.extend(Date.prototype,function(){return{format:function(b){var d=this;return b.gsub(/%([\-_0^#])?(\d+)?(.)/,function(f){var g=f[1]||"0",i=parseInt(f[2]||a[h]||"0"),h=f[3];if(!c[h])return f[0];
return c.flag[g](c[h](d),i)})}}}())})();
Element.addMethods(function(){return{load:function(a,c){if(c&&!Object.isUndefined(c.frequency))new Ajax.PeriodicalUpdater(this,a,c);else new Ajax.Updater(this,a,c)},xpath:Prototype.Browser.IE?function(a,c){if(Object.isUndefined(c)){c=a;a=this}for(var b=[],d=a.selectNodes(c),f=0;f<d.length;f++)b.push(d.item(f));return b}:function(a,c){if(Object.isUndefined(c)){c=a;a=this}for(var b=[],d=(a.ownerDocument||a).evaluate(c,a,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=0;f<d.snapshotLength;f++)b.push(d.snapshotItem(f));
return b},select:function(a,c){if(Object.isUndefined(c)){c=a;a=this}return Prototype.Selector.select(c,a)},getTextDescendants:function(a){function c(d){for(d=d.firstChild;d;){Node.TEXT_NODE==d.nodeType&&b.push(d);Object.isElement(d)&&c(d);d=d.nextSibling}}a=a||this;var b=[];c(a);return b},getFirstText:function(a){a=a||this;var c="";if(Object.isElement(a))a=$A(a.childNodes);else Object.isArray(a)||(a=$A(a));a.each(function(b){switch(b.nodeType){case Node.ELEMENT_NODE:throw $break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(!b.nodeValue.blank()){c=
b.nodeValue.strip();throw $break;}break}});return c},toObject:function(a){a=a||this;var c={};if(!Object.isElement(a)&&!Object.isDocument(a))return c;$A(a.childNodes).each(function(b){if(b.nodeType==Node.ELEMENT_NODE)if(b.getElementsByTagName("*").length==0){var d="";$A(b.childNodes).each(function(f){f.nodeType!=Node.CDATA_SECTION_NODE&&f.nodeType!=Node.TEXT_NODE||f.nodeValue.blank()||(d+=f.nodeValue)});c[b.nodeName]=d}else c[b.nodeName]=Element.toObject(b)});return c}}}());
Ajax.Request.addMethods({request:function(a){this.url=a;this.method=this.options.method;if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();if(this.options.minified){a=this.url.replace(/\.([^.]+)$/,".min.$1");if(miniLOL.utils.exists(a))this.url=a}if(this.options.cached===false){this.url+=(this.url.include("?")?"&":"?")+Math.random();this.options.requestHeaders=Object.extend(this.options.requestHeaders||{},{"Cache-Control":"must-revalidate",Pragma:"no-cache"})}a=
Object.toQueryString(this.options.parameters);if(!["get","post","head"].include(this.method)){a+=(a?"&":"")+"_method="+this.method;this.method="post"}if(a)if(this.method=="get"||this.method=="head")this.url+=(this.url.include("?")?"&":"?")+a;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))a+="&_=";this.parameters=a.toQueryParams();try{var c=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(c);Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),
this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(b){this.dispatchException(b)}}});if(!Object.isObject(window.miniLOL))window.miniLOL={error:Function.empty,Framework:{Version:"0.1"}};
Class=function(){var a={Normal:1,Abstract:2},c=function(){return{addMethods:function(b){for(var d=this.superclass&&this.superclass.prototype,f=Object.keys(b),g=0,i=f.length;g<i;g++){var h=f[g],e=b[h];if(d&&Object.isFunction(e)&&e.argumentNames().first()=="$super"){var j=e;e=function(k){return function(){return d[k].apply(this,arguments)}}(h).wrap(j);e.valueOf=j.valueOf.bind(j);e.toString=j.toString.bind(j)}this.prototype[h]=e;if(this.__type__==Class.Abstract)this[h]=e}},addStatic:function(b){for(var d=
Object.keys(b),f=0,g=d.length;f<g;f++){var i=d[f];this[i]=b[i]}},addAttributes:function(b){Object.extendAttributes(this.prototype,b);this.__type__==Class.Abstract&&Object.extendAttributes(this,b)}}}();return{create:function(){var b=$A(arguments),d=Object.isFunction(b.first())?b.shift():null,f=function(){switch(this.__type__){case a.Abstract:throw Error("You cannot instantiate an abstract class.");default:if(Object.isFunction(this.initialize))return this.initialize.apply(this,arguments);break}return null};
f["__miniLOL.Class__"]=true;Object.extend(f,Class.Methods);f.superclass=d;f.subclasses=[];if(d){if(!d.__type__)d.__type__=a.Normal;if(!d.subclasses)d.subclasses=[];var g=Function.empty.clone();g.prototype=d.prototype;f.prototype=new g;d.subclasses.push(f)}f.__type__=f.prototype.__type__=b.first().type||Class.Normal;b.each(function(i){f.addMethods({initialize:i.initialize||i.constructor||Function.empty.clone()});f.addMethods(Object.without(i,["constructor","initialize","Methods","Static","Attributes"]));
f.addMethods(i.Methods||{});f.addStatic(i.Static||{});f.addAttributes(i.Attributes||{})});return f.prototype.constructor=f},Type:a,Methods:c}}();
miniLOL.utils=function(){return{exists:function(a){var c=false;new Ajax.Request(a,{method:"head",asynchronous:false,evalJS:false,onSuccess:function(){c=true}});return c},get:function(a,c){c=Object.extend({raw:true},c||{});var b;new Ajax.Request(a,Object.extend(c||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(d){if(c.raw)b=d.responseText;else try{b=JSON.unserialize(d.responseText)}catch(f){b=d.responseXML||d.responseText}}}));return b},execute:function(a,c){var b,d;new Ajax.Request(a,
Object.extend(c||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(f){try{b=window.eval(f.responseText)}catch(g){d=g;d.fileName=a;d.lineNumber-=5}},onFailure:function(f){d=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,status:f.status,statusText:f.statusText}));d.fileName=a;d.lineNumber=0}}));if(d)throw d;return b},include:function(a,c){if(a.startsWith("http")){$(document.head).insert(new Element("script",{type:"text/javascript",src:a,id:c.id}));
return true}var b=false;new Ajax.Request(a,Object.extend(c||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(d){try{window.eval(d.responseText);b=true}catch(f){b=false}}}));return b},require:function(a,c){if(a.startsWith("http")){$(document.head).insert(new Element("script",{type:"text/javascript",src:a,id:c.id}));return true}var b=false;new Ajax.Request(a,Object.extend(c||{},{method:"get",asynchronous:false,evalJS:false,onSuccess:function(d){try{window.eval(d.responseText)}catch(f){b=
f;b.fileName=a;b.lineNumber-=5}},onFailure:function(d){b=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:a,status:d.status,statusText:d.statusText}));b.fileName=a;b.lineNumber=0;b.http={status:d.status,text:d.statusText}}}));if(b)throw b;return true}}}();
miniLOL.File=Class.create({initialize:function(a,c){this.options=Object.extend({method:"get",asynchronous:false,evalJS:false,minified:false,cached:true,onSuccess:function(b){this.content=b.responseText;this.special=b.responseXML;this.loaded=true;Object.isFunction(this.options.onLoaded)&&this.options.onLoaded(this)}.bind(this),onFailure:function(b){this.error=Object.clone(b)}.bind(this)},c||{});this.loaded=false;this.path=a;this.extension=miniLOL.File.extension(a);new Ajax.Request(this.path,this.options)},
reload:function(){this.loaded=false;new Ajax.Request(this.path,this.options)},interpolate:function(a,c){return c?this.content.interpolate(a,c):(new miniLOL.Template(this)).evaluate(a)},Static:{extension:function(a){return(a=a.match(/\.([^.]+)$/))?a[1]:""}}});
miniLOL.Template=Class.create({initialize:function(a,c){if(Object.is(miniLOL.File,a)){if(!a.loaded||!a.extension)throw"The File has to be loaded and have an extension.";this.engine=miniLOL.Template.Engine.get(a.extension);if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(a.content)}else{this.engine=miniLOL.Template.Engine.get(c)||Template;if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(a)}},evaluate:function(a,
c){return this.template.evaluate(a,c)}});miniLOL.Template.Engine=function(){var a={},c={};return{get:function(b){return a[(b||"").toLowerCase()]},add:function(b,d){a[b.toLowerCase()]||(a[b.toLowerCase()]=d)},load:function(b,d){if(!c[b]){miniLOL.utils.execute(b,d);c[b]=true}}}}();
miniLOL.Document=function(){return{fix:Prototype.Browser.IE?function(a){if(a){a={real:a};a.documentElement=a.real.documentElement;a.getElementsByTagName=function(c){return this.real.getElementsByTagName(c)};a.getElementById=function(c){return Element.xpath(this,"//*[@id='#{0}']".interpolate([c])).first()}.bind(a.real);a.real.setProperty("SelectionLanguage","XPath");a.xpath=Element.xpath.bind(a.real);a.select=Element.select.bind(a.real);return a}}:Prototype.Browser.Good?function(a){if(a){a.xpath=Element.xpath;
a.select=Element.select;return a}}:function(a){if(a){a.getElementById=function(c){return this.xpath("//*[@id='#{0}']".interpolate([c])).first()};a.xpath=Element.xpath;a.select=Element.select;return a}},check:function(a,c){var b=false;a||(b="There is a syntax error.");if(a.documentElement.nodeName=="parsererror")b=a.documentElement.textContent;if(c&&b){miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:c,error:b}),true);return b}return b}}}();
miniLOL.CSS=function(){return{include:function(a,c){if(c)c=a.replace(/\.css$/,".min.css");var b=$$("link").find(function(d){return d.getAttribute("href")==a||d.getAttribute("href")===c});if(!b){if(c&&miniLOL.utils.exists(c))a=c;else if(!miniLOL.utils.exists(a))return false;b=new Element("link",{rel:"stylesheet",href:a,type:"text/css"});$$("head")[0].insert(b);Event.fire(document,":css.included",b)}return b},create:function(a,c){var b=new Element("style",{type:"text/css"});if(Prototype.Browser.IE)b.styleSheet.cssText=
a;else b.update(a);c&&b.setAttribute("id",c);$$("head").first().appendChild(b);Event.fire(document,":css.created",b);return b}}}();
miniLOL.Resource=Class.create({initialize:function(a,c){if(!c)throw Error("No wrapper has been passed.");this.name=a;this.wrapper=c;if(!this.wrapper.clear)this.wrapper.clear=function(){this.data={}};for(var b in this.wrapper){if(Object.isFunction(this.wrapper[b])){if(this.wrapper[b].parent==this.wrapper)break;this.wrapper[b]=this.wrapper[b].bind(this.wrapper);this.wrapper[b].parent=this.wrapper}if(Object.isUndefined(this[b]))this[b]=this.wrapper[b]}this.clear();this.flush();this.wrapper.initialize&&
this.wrapper.initialize()},load:function(){var a,c=$A(arguments);Event.fire(document,":resource.load",{resource:this,arguments:c});this.calls.push(c);try{a=this.wrapper.load.apply(this.wrapper,c)}catch(b){miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this.name,error:b.toString()}));return false}Event.fire(document,":resource.loaded",{resource:this,arguments:c});return a},reload:function(){Event.fire(document,":resource.reload",{resource:this});this.wrapper.clear();
this.flush().each(function(a){this.load.apply(this,a)},this);Event.fire(document,":resource.reloaded",{resource:this})},clear:function(){Event.fire(document,":resource.clear",{resource:this});this.wrapper.clear()},flush:function(a){Event.fire(document,":resource.flush",{resource:this,call:a});var c;if(Object.isArray(a)){if(c=this.calls.find(function(b){if(b.length!=a.length)return false;for(var d=false,f=0;f<b.length;f++){if(a[f]==b[f])d=true;if(!d)break}return d}))this.calls=this.calls.filter(function(b){return b!=
c})}else{c=this.calls;this.calls=[]}return c},data:function(){return this.wrapper.data}});
miniLOL.JSON=function(){function a(b){return Object.isObject(b)?b.__miniLOL_is_xml?b.value.toXML():b.__miniLOL_is_function?Function.parse(b.value):miniLOL.JSON.unserializeSpecial(b):Object.isXML(b)?{__miniLOL_is_xml:true,value:String.fromXML(b)}:Object.isFunction(b)?{__miniLOL_is_function:true,value:b.toString()}:miniLOL.JSON.serializeSpecial(b)}function c(b){var d;if(Object.isObject(b)){d=Object.clone(b);for(var f in b)d[f]=a(b[f])}else if(Object.isArray(b)){d=[];b.each(function(g){d.push(a(g))})}else d=
b;return d}return{special:c,serializeSpecial:c,unserializeSpecial:c,serialize:function(b){try{return Object.toJSON(miniLOL.JSON.serializeSpecial(b))}catch(d){return false}},unserialize:function(b){if(!Object.isString(b))return null;try{return miniLOL.JSON.unserializeSpecial(b.evalJSON())}catch(d){return null}},convert:a}}();
miniLOL.Cookie=function(){function a(g){return Object.extend({expires:new Date(Date.now()+(1).day().ms()),path:"",domain:"",secure:"",raw:false},g||{})}function c(g,i,h){if(Object.isUndefined(h))h={};return"#{key}=#{value}; #{maxAge}#{expires}#{path}#{domain}#{secure}".interpolate({key:g.encodeURIComponent(),value:i.encodeURIComponent(),maxAge:!Object.isUndefined(h.maxAge)?"max-age=#{0}; ".interpolate([h.maxAge]):"",expires:!Object.isUndefined(h.expires)?"expires=#{0}; ".interpolate([h.expires.toUTCString()]):
"",path:!Object.isUndefined(h.path)?"path=#{0}; ".interpolate([h.path]):"",domain:!Object.isUndefined(h.domain)?"domain=#{0}; ".interpolate([h.domain]):"",secure:h.secure?"secure":""})}function b(){var g=[];window.document.cookie.split(/; /).each(function(i){i=i.split(/=/);g.push(i[0])});return g.uniq()}function d(g,i){i=a(i);var h=window.document.cookie.match(RegExp.escape(g.encodeURIComponent())+"=([^;]*)","g");if(h){var e=[];$A(h).each(function(j){j=j.match(/^.*?=(.*)$/)[1].decodeURIComponent();
e.push(i.raw?j:miniLOL.JSON.unserialize(j)||j)});if(e.length==1)e=e[0];return e}}function f(g,i){window.document.cookie=c(g,"",Object.extend(a(i),{expires:new Date(0)}))}return Object.extend(Enumerable,{_each:function(g){b().each(function(i){var h=d(i),e=[i,h];e.name=i;e.key=i;e.value=h;g(e)})},encode:c,keys:b,get:d,set:function(g,i,h){h=a(h);h.raw||(i=miniLOL.JSON.serialize(i)||i);window.document.cookie=c(g,i,h)},remove:f,unset:f,clear:function(){b().each(function(g){f(g)})}})}();
miniLOL.Storage=Class.create({initialize:function(a,c){this.name=a;this.backend=miniLOL.Storage.Instances[a]?miniLOL.Storage.Instances[a]:miniLOL.Storage.Instances[a]=new (c||miniLOL.Storage.Backends.available())(a)},get:function(a){return this.backend.get(a.toString())},set:function(a,c,b){return this.backend.set(a.toString(),c,b)},remove:function(a,c){return this.backend.remove(a.toString(),c)},clear:function(a){return this.backend.clear(a)},size:function(){return this.backend.size},save:function(){this.backend.save()}});
miniLOL.Storage.Instances={};
miniLOL.Storage.Backend=Class.create(Hash,{initialize:function($super,c,b){$super((Object.isString(b)?miniLOL.JSON.unserialize(b):b)||{});this.name=miniLOL.Storage.Backend.filter(c);if(Object.isString(b))this.size=b.size},get:function($super,c){return $super(c)},set:function($super,c,b,d){c=$super(c,b);d||this.save();return c},remove:function($super,c,b){c=$super(c);b||this.save();return c},clear:function($super,c){var b=$super();c||this.save();return b},replace:function($super,c){this.size=Object.isString(c)?
c.length:0;return $super(c)},Static:{filter:function(a){return a.replace(/\s/g,"")}}});
miniLOL.Storage.Backends={available:function(){try{return window.localStorage?miniLOL.Storage.Backends.LocalStorage:window.globalStorage?miniLOL.Storage.Backends.GlobalStorage:document.body.addBehavior?miniLOL.Storage.Backends.UserDataBehavior:miniLOL.Storage.Backends.Cookie}catch(a){return miniLOL.Storage.Backends.Null}},LocalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,c){$super(c);this.replace(window.localStorage["__miniLOL.storage."+this.name]||"{}")},save:function(){var a=
this.toJSON(true);this.size=a.length;window.localStorage["__miniLOL.storage."+this.name]=a}}),GlobalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,c){$super(c);this.replace(window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]||"{}")},save:function(){var a=this.toJSON(true);this.size=a.length;window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]=a}}),UserDataBehavior:Class.create(miniLOL.Storage.Backend,{initialize:function($super,
c){$super(c);this.element=document.createElement("link");this.element.addBehavior("#default#userData");$$("head")[0].appendChild(this.element);this.element.load("__miniLOL.storage."+c);var b=this.element.getAttribute("__miniLOL.storage."+this.name)||"{}";this.size=b.length;this.replace(b)},save:function(){var a=this.toJSON(true);this.size=a.length;this.element.setAttribute("__miniLOL.storage."+this.name,a);this.element.save("__miniLOL.storage."+this.name)}}),Cookie:Class.create(miniLOL.Storage.Backend,
{initialize:function($super,c){$super(c);this.replace(miniLOL.Cookie.get("__miniLOL.storage."+this.name,{raw:true})||"{}")},save:function(){var a=this.toJSON(true);this.size=a.length;miniLOL.Cookie.set("__miniLOL.storage."+this.name,a,{expires:31536E3,raw:true})}}),Null:Class.create(miniLOL.Storage.Backend,{save:Function.empty})};
miniLOL.History={interval:0.15,initialize:function(){miniLOL.History.current=window.location.hash||"#";if(Prototype.Browser.Opera&&history.navigationMode)history.navigationMode="compatible";Event.observe(document,":url.change",function(a){miniLOL.History.current=a.memo.toString()||"#"});miniLOL.History.Initializers.get().call()},reset:function(a,c){if(Object.isNumber(a))miniLOL.History.interval=a;Object.isUndefined(miniLOL.History.timer)||clearInterval(miniLOL.History.timer);miniLOL.History.timer=
setInterval(c,miniLOL.History.interval*1E3)},Initializers:{get:function(){return"onhashchange"in window&&!(Prototype.Browser.InternetExplorer&&Prototype.Browser.Version==7)?miniLOL.History.Initializers.Default:Prototype.Browser.InternetExplorer?miniLOL.History.Initializers.InternetExplorer:miniLOL.History.Initializers.Unsupported},Default:function(){Event.observe(window,"hashchange",function(){Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||
"#"))})},Unsupported:function(){document.observe("dom:loaded",function(){miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.Default)})},InternetExplorer:function(){document.observe("dom:loaded",function(){miniLOL.History.IE={check:function(){if(!miniLOL.History.IE.element.parentNode||miniLOL.History.IE.element.parentNode.nodeName=="#document-fragment")$(document.body).insert({top:miniLOL.History.IE.element})},put:function(a){miniLOL.History.IE.check();var c=miniLOL.History.IE.element.contentWindow.document;
c.open();c.close();c.location.hash=encodeURIComponent(a.substring(1))},get:function(){miniLOL.History.IE.check();return miniLOL.History.IE.element.contentWindow.document.location.hash},element:new Element("iframe",{id:"__miniLOL.History",style:"display: none !important; z-index: -9001 !important;",src:"javascript:false;"})};$(document.body).insert({top:miniLOL.History.IE.element});miniLOL.History.IE.put(miniLOL.History.current);miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.InternetExplorer)})}},
Checkers:{Default:function(){if(miniLOL.History.current!=window.location.hash)Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||"#"))},InternetExplorer:function(){var a={iframe:miniLOL.History.IE.get(),actual:window.location.hash||"#",current:miniLOL.History.current};if(a.actual!=a.iframe){if(a.actual&&a.actual==a.current)window.location.hash=(miniLOL.History.current=a.iframe).substring(1);else miniLOL.History.IE.put(miniLOL.History.current=
a.actual);Event.fire(document,":url.change",miniLOL.History.current)}}}};miniLOL.History.initialize();
