
/* miniLOL is released under AGPLv3. Copyleft meh. [http://meh.paranoid.pk | meh@paranoici.org] */
/* haml.js (c) 2009 Tim Caswell (http://github.com/creationix/haml-js) */
        
miniLOL.Template.Engine.add("haml",Class.create({initialize:function(i){this.template=Haml.optimize(Haml.compile(i))},evaluate:function(i,o){return Haml.execute(this.template,o||window,i)}}));var Haml;
(function(){function i(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;")}function o(a){var c,d,b=[];for(c in a)if(c!=="_content"&&a.hasOwnProperty(c))switch(a[c]){case "undefined":case "false":case "null":case '""':break;default:try{d=JSON.parse("["+a[c]+"]")[0];d=d===true?c:typeof d==="string"&&m.test(d)?'" +\n'+j(i(d))+' +\n"':i(d);b.push(" "+c+'=\\"'+d+'\\"')}catch(f){b.push(" "+c+'=\\"" + html_escape('+a[c]+') + "\\"')}}return b.join("")}function y(a){function c(){if(typeof g.start===
"number"&&typeof g.middle==="number"&&typeof g.end==="number"){var z=a.substr(g.start,g.middle-g.start).trim(),A=a.substr(g.middle+1,g.end-g.middle-1).trim();d[z]=A}g={start:null,middle:null,end:null}}var d={},b=a.length,f,e,h=1,k=false,p=false,l,q,s,r,g={start:1,middle:null,end:null};if(!(b>0&&(a.charAt(0)==="{"||a.charAt(0)==="(")))return{_content:a[0]===" "?a.substr(1,b):a};l=a.charAt(0);q=l==="{"?"}":")";s=l==="{"?":":"=";r=l==="{"?",":" ";for(f=1;h>0;f+=1){if(f>b)throw"Malformed attribute block";
e=a.charAt(f);if(p)p=false;else if(k){if(e==="\\")p=true;if(e===k)k=false}else{if(e==='"'||e==="'")k=e;if(h===1){if(e===s)g.middle=f;if(e===r||e===q){g.end=f;c();if(e===r)g.start=f+1}}if(e===l||e==="(")h+=1;if(e===q||h>1&&e===")")h-=1}}d._content=a.substr(f,a.length);return d}function j(a){for(var c=[],d=0,b=0,f;;){b=a.substr(d).search(m);if(b<0){d<a.length&&c.push(JSON.stringify(a.substr(d)));break}c.push(JSON.stringify(a.substr(d,b)));d+=b;f=a.substr(d).match(m);b=f[0].length;if(b<0)break;c.push(f[1]||
f[2]);d+=b}return c.filter(function(e){return e&&e.length>0}).join(" +\n")}function n(a){var c=false,d=[];if(typeof a==="string")a=a.trim().replace(/\n\r|\r/g,"\n").split("\n");a.forEach(function(b){var f,e=false;if(c)if(f=c.check_indent(b)){c.contents.push(f[1]||"");return}else{d.push(c.process());c=false}t.forEach(function(h){if(!e)if(f=h.regexp(b)){c={contents:[],matches:f,check_indent:RegExp("^(?:\\s*|"+f[1]+"  (.*))$"),process:h.process,render_contents:function(){return n(this.contents)}};e=
true}});e||d.push(function(){if(b[0]==="\\")return j(b.substr(1,b.length));if(b[0]==="="){b=b.substr(1,b.length).trim();try{return j(JSON.parse(b))}catch(h){return b}}if(b.substr(0,2)==="&="){b=b.substr(2,b.length).trim();try{return JSON.stringify(i(JSON.parse(b)))}catch(k){return"html_escape("+b+")"}}return j(b)}())});c&&d.push(c.process());return d.filter(function(b){return b&&b.length>0}).join(" +\n")}function u(a){function c(){if(b.length>0){d.push(JSON.stringify(b.join(""))+e);b=[]}}var d=[],
b=[],f,e;a.replace(/\n\r|\r/g,"\n").split("\n").forEach(function(h){if(f=h.match(/^(\".*\")(\s*\+\s*)?$/)){e=f[2]||"";f=f[1];try{b.push(JSON.parse(f))}catch(k){c();d.push(h)}}else{c();d.push(h)}});c();return d.join("\n")}function v(a,c,d){return function(){with(d||{})try{return eval("("+a+")")}catch(b){return"\n<pre class='error'>"+i(b.stack)+"</pre>\n"}}.call(c)}var t,w,m,x;m=/\#\{([^}]*)\}/;w=["meta","img","link","br","hr","input","area","base"];t=[{regexp:/^(\s*)((?:[.#%][a-z_\-][a-z0-9_:\-]*)+)(.*)$/i,
process:function(){var a,c,d,b;a=this.matches[2];c=a.match(/\.([a-z_\-][a-z0-9_\-]*)/gi);d=a.match(/\#([a-z_\-][a-z0-9_\-]*)/gi);a=(a=a.match(/\%([a-z_\-][a-z0-9_:\-]*)/gi))?a[0].substr(1,a[0].length):"div";if(b=this.matches[3]){b=y(b);if(b._content){this.contents.unshift(b._content.trim());delete b._content}}else b={};if(c){c=c.map(function(e){return e.substr(1,e.length)}).join(" ");if(b["class"])try{b["class"]=JSON.stringify(c+" "+JSON.parse(b["class"]))}catch(f){b["class"]=JSON.stringify(c+" ")+
" + "+b["class"]}else b["class"]=JSON.stringify(c)}if(d){d=d.map(function(e){return e.substr(1,e.length)}).join(" ");b.id=b.id?JSON.stringify(d+" ")+b.id:JSON.stringify(d)}b=o(b);c=this.render_contents();if(c==='""')c="";return(x?c.length>0:w.indexOf(a)==-1)?'"<'+a+b+'>"'+(c.length>0?" + \n"+c:"")+' + \n"</'+a+'>"':'"<'+a+b+' />"'}},{regexp:/^(\s*)(?::for|:each)\s+(?:([a-z_][a-z_\-]*),\s*)?([a-z_][a-z_\-]*)\s+in\s+(.*)(\s*)$/i,process:function(){var a=this.matches[2]||"__key__",c=this.matches[3],
d=this.matches[4];this.matches[5]&&this.contents.unshift(this.matches[5]);return"(function () { var __result__ = [], "+a+", "+c+"; for ("+a+" in "+d+") { if ("+d+".hasOwnProperty("+a+")) { "+c+" = "+d+"["+a+"]; __result__.push(\n"+(this.render_contents()||"''")+'\n); } } return __result__.join(""); }).call(this)'}},{regexp:/^(\s*):if\s+(.*)\s*$/i,process:function(){return"(function () { if ("+this.matches[2]+") { return (\n"+(this.render_contents()||"")+'\n);} else { return ""; } }).call(this)'}},
{regexp:/^()!!!(?:\s*(.*))\s*$/,process:function(){var a="";switch((this.matches[2]||"").toLowerCase()){case "":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';break;case "strict":case "1.0":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">';break;case "frameset":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">';
break;case "5":a="<!DOCTYPE html>";break;case "1.1":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">';break;case "basic":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">';break;case "mobile":a='<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">';break;case "xml":a="<?xml version='1.0' encoding='utf-8' ?>";break;
case "xml iso-8859-1":a="<?xml version='1.0' encoding='iso-8859-1' ?>";break}return JSON.stringify(a+"\n")}},{regexp:/^(\s*):markdown\s*$/i,process:function(){return j(exports.Markdown.encode(this.contents.join("\n")))}},{regexp:/^(\s*):(?:java)?script\s*$/,process:function(){return j('\n<script type="text/javascript">\n//<![CDATA[\n'+this.contents.join("\n")+"\n//]]\>\n<\/script>\n")}},{regexp:/^(\s*):css\s*$/,process:function(){return JSON.stringify('\n<style type="text/css">\n'+this.contents.join("\n")+
"\n</style>\n")}}];Haml=function(a,c){x=c;var d=u(n(a));return new Function("locals",i+"\nwith(locals || {}) {\n  try {\n    return ("+d+');\n  } catch (e) {\n    return "\\n<pre class=\'error\'>" + html_escape(e.stack) + "</pre>\\n";\n  }\n}')};Haml.compile=n;Haml.optimize=u;Haml.render=function(a,c){c=c||{};a=a||"";var d=n(a);if(c.optimize)d=Haml.optimize(d);return v(d,c.context||Haml,c.locals)};Haml.execute=v})();if(typeof module!=="undefined")module.exports=Haml;
