miniLOL={version:"1.2",initialize:function(){if(miniLOL.initialized)throw new Error("miniLOL has already been initialized.");miniLOL.initialized=false;miniLOL.path=location.href.match(/^(.*?)\/[^\/]*?(#|$)/)[1];miniLOL.resources={};[function(){Event.observe(document,":resource.loaded",function(b){if(!(b.memo.name!="miniLOL.config"||b.memo.arguments[0]!="resources/config.xml")){miniLOL.config.core||(miniLOL.config.core={});if(!miniLOL.config.core.siteTitle)miniLOL.config.core.siteTitle="miniLOL #{version}".interpolate(miniLOL);
if(!miniLOL.config.core.loadingMessage)miniLOL.config.core.loadingMessage="Loading...";if(miniLOL.config.core.homePage){if(miniLOL.config.core.homePage.charAt(0)!="#"&&!miniLOL.config.core.homePage.isURL())miniLOL.config.core.homePage="#"+miniLOL.config.core.homePage}else miniLOL.config.core.homePage="#home";if(!document.title)document.title=miniLOL.config.core.siteTitle}});miniLOL.resources.config=new miniLOL.Resource("miniLOL.config",{initialize:function(){miniLOL.config=this._data},load:function(b){var a=
this;new Ajax.Request(b,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.utils.checkXML(c.responseXML,b)){c.responseXML=miniLOL.utils.fixDOM(c.responseXML);var d=c.responseXML.documentElement.getAttribute("domain")||"core";miniLOL.config[d]=Object.extend(miniLOL.config[d]||{},a.parse(c.responseXML.documentElement))}},onFailure:function(c){miniLOL.error("Error while loading config.xml (#{status} - #{statusText})".interpolate(c))}});if(miniLOL.error())return false;return true},clear:function(){this._data=
miniLOL.config={}},parse:function(b,a){if(a){for(var c="",d=0;d<b.childNodes.length;d++){a=b.childNodes[d];if(!(a.nodeType!=Node.CDATA_SECTION_NODE&&a.nodeType!=Node.TEXT_NODE)){a=a.nodeValue;a.match(/^[\s\n]*$/m)||(c+=a)}}return c}if(b.nodeType!=Node.ELEMENT_NODE)return null;c={};for(d=0;d<b.childNodes.length;d++){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE)c[e.nodeName]=e.getElementsByTagName("*").length==0?this.parse(e,true):this.parse(e)}return c}});miniLOL.resources.config.load("resources/config.xml");
$(document.body).update(miniLOL.config.core.loadingMessage)},function(){miniLOL.resources.menus=new miniLOL.Resource("miniLOL.menus",{load:function(b){new Ajax.Request(b,{method:"get",asynchronous:false,onSuccess:function(a){if(!miniLOL.utils.checkXML(a.responseXML,b)){a=miniLOL.utils.fixDOM(a.responseXML);miniLOL.menus["default"]=a.getElementById("default");a=a.documentElement.childNodes;for(var c=0;c<a.length;c++)if(a[c].nodeType==Node.ELEMENT_NODE){var d=a[c].getAttribute("id");if(!d&&!miniLOL.menus["default"])miniLOL.menus["default"]=
a[c];else miniLOL.menus[d]=a[c]}miniLOL.menus["default"]||miniLOL.error("Error while analyzing menus.xml\n\nNo default menu was found.")}}});if(miniLOL.error())return false;return true},clear:function(){this._data=miniLOL.menus={}}});miniLOL.resources.menus.load("resources/menus.xml")},function(){miniLOL.resources.pages=new miniLOL.Resource("miniLOL.pages",{load:function(b){new Ajax.Request(b,{method:"get",asynchronous:false,onSuccess:function(a){if(!miniLOL.utils.checkXML(a.responseXML,b)){miniLOL.utils.fixDOM(a.responseXML);
a=a.responseXML.documentElement.getElementsByTagName("page");for(var c=0;c<a.length;c++){var d=a[c].getAttribute("id");delete miniLOL.pages.cache[d];miniLOL.pages.data[d]=a[c]}}},onFailure:function(a){miniLOL.error("Error while loading pages.xml (#{status} - #{statusText})".interpolate(a))}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.pages=this._data={data:{},cache:{}}}});miniLOL.utils.fileExists("resources/pages.xml")&&miniLOL.resources.pages.load("resources/pages.xml")},
function(){miniLOL.resources.functions=new miniLOL.Resource("miniLOL.functions",{load:function(b){new Ajax.Request(b,{method:"get",asynchronous:false,onSuccess:function(a){if(!miniLOL.utils.checkXML(a.responseXML,b)){a=a.responseXML.documentElement.getElementsByTagName("function");for(var c=0;c<a.length;c++)try{miniLOL.functions[a[c].getAttribute("name")]=new Function("var text = arguments[0]; var args = arguments[1]; #{code}; return text;".interpolate({code:a[c].firstChild.nodeValue}))}catch(d){miniLOL.error("Error while creating `#{name}` wrapper from #{path}:\n\n#{error}".interpolate({name:a[c].getAttribute("name"),
path:b,error:d.toString()}));return}}},onFailure:function(a){miniLOL.error("Error while loading functions.xml (#{status} - #{statusText}})".interpolate(a))}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.functions=this._data={}}});miniLOL.resources.functions.load("resources/functions.xml")},function(){if(miniLOL.config.core.theme){miniLOL.error(!miniLOL.theme.load(miniLOL.config.core.theme));miniLOL.theme.template.menu()}else miniLOL.error(!miniLOL.theme.deprecated())},function(){if(!miniLOL.theme.menu())miniLOL.menus=
null;miniLOL.menu.enabled()&&miniLOL.menu.set(miniLOL.config.core.loadingMessage)},function(){miniLOL.content.set("Loading modules...");miniLOL.resources.modules=new miniLOL.Resource("miniLOL.modules",{load:function(b,a){new Ajax.Request(b,{method:"get",asynchronous:false,onSuccess:function(c){if(!miniLOL.utils.checkXML(c.responseXML,b)){miniLOL.module.path=c.responseXML.documentElement.getAttribute("path")||"modules";c=c.responseXML.documentElement.getElementsByTagName("module");for(var d=0;d<c.length;d++){a&&
miniLOL.content.set("Loading `#{name}`... [#{number}/#{total}]".interpolate({name:c[d].getAttribute("name"),number:d+1,total:c.length}));miniLOL.module.load(c[d].getAttribute("name"))||miniLOL.error(true);if(miniLOL.error())break}}},onFailure:function(c){miniLOL.error("Error while loading modules.xml (#{status} - #{statusText})".interpolate(c))}});if(miniLOL.error())return false;return true},clear:function(){miniLOL.modules=this._data={}}});miniLOL.resources.modules.load("resources/modules.xml",true)},
function(){miniLOL.menu.enabled()&&miniLOL.menu.change("default")},function(){miniLOL.content.set("Checking dependencies...");try{miniLOL.module.dependencies.check()}catch(b){miniLOL.error("`#{module}` requires `#{require}`".interpolate(b),miniLOL.theme.content())}}].each(function(b){try{b()}catch(a){miniLOL.error(a.toString())}if(miniLOL.error())throw $break;});if(miniLOL.error()){document.body.innerHTML||miniLOL.error("Something went wrong, but nobody told me what :(");return false}miniLOL.go(/[#?]./.test(location.href)?
location.href.replace(/^.*[#?]/,"#"):miniLOL.config.core.homePage);miniLOL.config.core.initialization&&eval(miniLOL.config.core.initialization);Event.observe(document,":refresh",miniLOL.refresh);new PeriodicalExecuter(function(){Event.fire(document,":refresh")},miniLOL.config.core.refreshEvery||360);Event.fire(document,":initialized");Event.stopObserving(document,":initialized");miniLOL.initialized=true},error:function(b,a,c){if(Object.isUndefined(b))return Boolean(miniLOL.error._value);if(Object.isBoolean(b))return miniLOL.error._value=
b;a=a||document.body;$(a).update(b.replace(/<br\/>/g,"\n").escapeHTML().replace(/\n/g,"<br/>"));if(!c)miniLOL.error._value=true;Event.fire(document,":error",{text:b,element:a,minor:c})},content:{set:function(b){miniLOL.theme.content().update(b)},get:function(){return miniLOL.theme.content().innerHTML}},refresh:function(){miniLOL.resources.config.reload();miniLOL.resources.menus.reload();miniLOL.resources.pages.reload();miniLOL.resources.functions.reload()},theme:{style:{list:{},load:function(b,a,
c){a=a||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.style.load",{name:b,path:a,overload:Boolean(c)});if(miniLOL.theme.style.exists(b,a))if(c)miniLOL.theme.style.unload(miniLOL.theme.style.list[b],a);else return true;b="#{path}/#{style}.css".interpolate({path:a,style:b});a=miniLOL.utils.includeCSS(b);if(!a)return false;miniLOL.theme.style.list[b]=a;return true},unload:function(b,a){a=a||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,
theme:miniLOL.theme.name});Event.fire(document,":theme.style.unload",{name:b,path:a});var c="#{path}/#{style}.css".interpolate({path:a,style:b});if(miniLOL.theme.style.list[c]){miniLOL.theme.style.list[c].remove();delete miniLOL.theme.style.list[c]}},exists:function(b,a){a=a||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});return Boolean(miniLOL.theme.style.list["#{path}/#{style}.css".interpolate({path:a,style:b})])}},template:{load:function(b,a){if(!a&&!miniLOL.theme.name)return 0;
a=a||"#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:miniLOL.theme.name});Event.fire(document,":theme.template.load",{name:b,path:a});var c="#{path}/#{name}.xml".interpolate({path:a,name:b});if(!Object.isUndefined(miniLOL.theme.template._cache[c]))return miniLOL.theme.template._cache[c];new Ajax.Request(c,{method:"get",asynchronous:false,onSuccess:function(d){miniLOL.utils.checkXML(d.responseXML,c)||(miniLOL.theme.template._cache[c]=miniLOL.utils.fixDOM(d.responseXML))},onFailure:function(){miniLOL.theme.template._cache[c]=
false}});if(miniLOL.error())return false;return miniLOL.theme.template._cache[c]},menu:function(){return miniLOL.theme.template.load("menu")},exists:function(b,a){return Boolean(miniLOL.theme.template.load(b,a))},clearCache:function(){miniLOL.theme.template._cache={};miniLOL.theme.template.list={};miniLOL.theme.template.list["default"]={global:"<div #{attributes}>#{data}</div>",before:"#{data}",after:"#{data}",link:'<div class="#{class}" id="#{id}">#{before}<a href="#{url}" target="#{target}" #{attributes}>#{text}</a>#{after}</div>',
item:'<div class="#{class}" id="#{id}">#{before}<span #{attributes}>#{text}</span>#{after}</div>',nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'};miniLOL.theme.template.list.table={global:"<table #{attributes}>#{data}</table>",before:"#{data}",after:"#{data}",link:'<tr><td>#{before}</td><td><a href="#{url}" target="#{target}" #{attributes}>#{text}</a></td><td>#{after}</td></tr>',item:"<tr><td>#{before}</td><td>#{text}</td><td>#{after}</td></tr>",
nest:'<div class="#{class}" style="#{style}">#{data}</div>',data:'<div class="data">#{before}#{data}#{after}</div>'}}},load:function(b,a,c){miniLOL.theme.unload();var d=miniLOL.theme.path,e=miniLOL.theme.name,k=b.match(/^(.+?):(.+)$/);if(k){miniLOL.theme.path=k[1];miniLOL.theme.name=k[2]}else{miniLOL.theme.path="themes";miniLOL.theme.name=b}if(miniLOL.theme.name==e&&miniLOL.theme.path==d)return true;k="#{path}/#{theme}".interpolate({path:miniLOL.theme.path,theme:b});Event.fire(document,":theme.load",
{name:b,runtime:Boolean(a)});var j;new Ajax.Request("#{path}/theme.xml".interpolate({path:k,theme:b}),{method:"get",asynchronous:false,onSuccess:function(h){var n=miniLOL.theme.informations={};h=miniLOL.utils.fixDOM(h.responseXML);n.name=h.documentElement.getAttribute("name")||"Unknown";n.author=h.documentElement.getAttribute("author")||"Anonymous";n.homepage=h.documentElement.getAttribute("homepage")||"";miniLOL.theme.menu._node=h.documentElement.getAttribute("menu")||"menu";miniLOL.theme.content._node=
h.documentElement.getAttribute("content")||"body";try{var g=h.getElementsByTagName("initialize");miniLOL.theme.initialize=g.length?new Function(g[0].firstChild.nodeValue):new Function}catch(f){j="An error occurred on the theme's initialize function:\n\n"+f.toString();return false}try{var i=h.getElementsByTagName("finalize");miniLOL.theme.finalize=i.length?new Function(i[0].firstChild.nodeValue):new Function}catch(p){j="An error occurred on the theme's finalize function:\n\n"+p.toString();return false}n.styles=
[];$A(h.getElementsByTagName("style")).each(function(l){n.styles.push(l.getAttribute("name"))});g=h.getElementsByTagName("templates");var q;if(g&&(q=g.getElementsByTagName("list")))$A(q.getElementsByTagName("template")).each(function(l){var m,o=l.getAttribute("name")||"default";miniLOL.theme.template.list[o]={};if((m=l.getElementsByTagName("global")).length)miniLOL.theme.template.list[o].global=m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("before")).length)miniLOL.theme.template.list[o].before=
m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("after")).length)miniLOL.theme.template.list[o].after=m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("link")).length)miniLOL.theme.template.list[o].link=m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("item")).length)miniLOL.theme.template.list[o].item=m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("nest")).length)miniLOL.theme.template.list[o].nest=m[0].firstChild.nodeValue;if((m=l.getElementsByTagName("data")).length)miniLOL.theme.template.list[o].data=
m[0].firstChild.nodeValue})},onFailure:function(){j="Could not load theme's informations."}});if(j){miniLOL.error(j);return false}new Ajax.Request("#{path}/template.html".interpolate({path:k,theme:b}),{method:"get",asynchronous:false,onSuccess:function(h){$(document.body).update(h.responseText)},onFailure:function(){j="Could not load template.html."}});if(j){miniLOL.error(j);return false}for(d=0;d<miniLOL.theme.informations.styles.length;d++)if(!miniLOL.theme.style.load(miniLOL.theme.informations.styles[d],
false,true)){miniLOL.error("Couldn't load `#{style}` style.".interpolate({style:miniLOL.theme.informations.styles[d]}));return false}if(a&&miniLOL.initialized){miniLOL.menu.change(miniLOL.menu.current);miniLOL.go(location.href)}miniLOL.theme.data={};!c&&miniLOL.theme.initialize&&miniLOL.theme.initialize();Event.fire(document,":theme.loaded",{name:b,runtime:Boolean(a)});return true},unload:function(b){miniLOL.theme.data&&delete miniLOL.theme.data;miniLOL.theme.template.clearCache();if(miniLOL.theme.name){Event.fire(document,
":theme.unload",{name:miniLOL.theme.name});!b&&miniLOL.theme.finalize&&miniLOL.theme.finalize();for(b=0;b<miniLOL.theme.informations.styles.length;b++)miniLOL.theme.style.unload(miniLOL.theme.informations.styles[b]);delete miniLOL.theme.name;delete miniLOL.theme.initialize;delete miniLOL.theme.finalize;delete miniLOL.theme.informations}},content:function(){return $(miniLOL.theme.content._node)},menu:function(){return $(miniLOL.theme.menu._node)},deprecated:function(){miniLOL.theme.path="themes";miniLOL.theme.content._node=
miniLOL.config.core.contentNode||"body";miniLOL.theme.menu._node=miniLOL.config.core.menuNode||"menu";miniLOL.theme.template.clearCache();new Ajax.Request("resources/template.html",{method:"get",asynchronous:false,onSuccess:function(b){$(document.body).update(b.responseText)},onFailure:function(){$(document.body).update('<div id="menu"></div><div id="body"></div>')}});miniLOL.utils.includeCSS("resources/style.css");miniLOL.theme.template.clearCache();return true}},menu:{set:function(b){miniLOL.menu.enabled()&&
miniLOL.theme.menu().update(b)},get:function(b,a){a=a||0;if(!miniLOL.menu.enabled())return"";b=b||"default";if(!miniLOL.menu.exists(b))return null;return miniLOL.menu.parse(miniLOL.menus[b],a)},change:function(b,a){if(!(b==miniLOL.menu.current&&!a)){var c=miniLOL.menu.get(b);if(c){miniLOL.menu.set(c);miniLOL.menu.current=b}else{c="The menu `#{name}` doesn't exist.".interpolate({name:b});miniLOL.error(c);return c}Event.fire(document,":menu.change",miniLOL.menus[b])}},enabled:function(){return Boolean(miniLOL.menus)},
exists:function(b){return Boolean(miniLOL.menus[b])},parsers:{layer:function(b,a){var c={};if(b){var d=b.getElementById(a)||b.getElementById("default");if(d){if(d.getElementsByTagName("menu").length)c.menu=d.getElementsByTagName("menu")[0].firstChild.nodeValue;if(d.getElementsByTagName("item").length)c.item=d.getElementsByTagName("item")[0].firstChild.nodeValue}}if(!c.menu)c.menu="#{data}";if(!c.item)c.item='<a href="#{href}" #{attributes}>#{text}</a> ';return c},other:function(b,a){var c={};if(!b||
!a)return"";a=a.getElementsByTagName(b.nodeName);if(a.length==0)return"";else a=a[0];var d=miniLOL.utils.getFirstText(a.childNodes);$A(b.childNodes).each(function(e){if(e.nodeType==Node.ELEMENT_NODE)c[e.nodeName]=miniLOL.menu.parsers.other(e,a)});c.text=miniLOL.utils.getFirstText(b.childNodes);return d.interpolate(Object.extend(c,Object.fromAttributes(b.attributes)))}},parse:function(b,a){a=a||0;var c=miniLOL.theme.template.menu();if(!c||!b)if(miniLOL.error())return false;var d=true,e="";$A(b.childNodes).each(function(k){switch(k.nodeType){case Node.ELEMENT_NODE:if(k.nodeName==
"menu")e+=miniLOL.menu.parsers.layer(c,a+1).menu.interpolate({data:miniLOL.menu.parse(content,a+1)});else if(k.nodeName=="item"){var j=k.cloneNode(true),h=j.getAttribute("class")||"";j.removeAttribute("class");var n=j.getAttribute("id")||"";j.removeAttribute("id");var g=j.getAttribute("src")||j.getAttribute("href")||j.getAttribute("url")||"";j.removeAttribute("src");j.removeAttribute("href");j.removeAttribute("url");e+=miniLOL.menu.parsers.layer(c,a).item.interpolate(Object.extend(Object.fromAttributes(j.attributes),
{"class":h,id:n,url:g,src:g,href:g,attributes:String.fromAttributes(j.attributes),text:miniLOL.utils.getFirstText(k.childNodes),data:miniLOL.menu.parse(content,a+1)}))}else e+=miniLOL.menu.parsers.other(content,c);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:d||(e+=k.nodeValue);d=false;break}});return e.replace(/[\s\n]*/g,"")?a==0?miniLOL.menu.parsers.layer(c,a).menu.interpolate({data:e}):e:""}},page:{get:function(b,a,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,
":page.get",{name:b,queries:a});var d=miniLOL.pages.data[b],e=a.type;if(!d){miniLOL.content.set("404 - Not Found");return false}if(d.getAttribute("alias")){typeof a[b]!="string"&&delete a[b];delete a.page;if(!a.title&&d.getAttribute("title"))a.title=encodeURIComponent(d.getAttribute("title"));if(a=Object.toQuery(a))a="&"+a;d=d.getAttribute("alias");if(!d.isURL()&&d.charAt(0)!="#")d="#"+d;return miniLOL.go(d+a)}if(e==null)e=d.getAttribute("type");if(c){c={};Object.extend(c,miniLOL.config.core);Object.extend(c,
a);document.title=(a.title||d.getAttribute("title")||miniLOL.config.core.siteTitle).interpolate(c)}if(miniLOL.pages.cache[b]){miniLOL.functions[e]?miniLOL.content.set(miniLOL.functions[e](miniLOL.pages.cache[b],a)):miniLOL.content.set(miniLOL.pages.cache[b]);return true}if(c=d.getAttribute("arguments")){c=c.replace(/[ ,]+/g,"&amp;").parseQuery();for(var k in c)if(a[k]==null)a[k]=c[k]}d=miniLOL.page.parse(d);miniLOL.pages.cache[b]=d;if(miniLOL.functions[e])d=miniLOL.functions[e](d,a);miniLOL.content.set(d);
return true},parsers:{list:function(b,a){list=b.cloneNode(false);a=a||[b];var c=list.getAttribute("before")||a[0].getAttribute("before")||"";list.removeAttribute("before");var d=list.getAttribute("after")||a[0].getAttribute("after")||"";list.removeAttribute("after");var e=list.getAttribute("arguments")||a[0].getAttribute("arguments")||"";list.removeAttribute("arguments");var k=list.getAttribute("type")||a[0].getAttribute("type")||"";list.removeAttribute("type");var j=list.getAttribute("menu")||a[0].getAttribute("menu");
list.removeAttribute("menu");var h=list.getAttribute("template");list.removeAttribute("template");miniLOL.theme.template.list[h]||(h="default");var n="";$A(b.childNodes).each(function(g){if(g.nodeType==Node.ELEMENT_NODE)if(g.nodeName=="link"){var f=g.cloneNode(true),i=f.getAttribute("src")||f.getAttribute("href")||f.getAttribute("url")||"";f.removeAttribute("src");f.removeAttribute("href");f.removeAttribute("url");var p=f.getAttribute("target");f.removeAttribute("target");g=f.getAttribute("text")||
"";f.removeAttribute("text");var q=f.getAttribute("before")||c||"";f.removeAttribute("before");var l=f.getAttribute("after")||d||"";f.removeAttribute("after");var m=f.getAttribute("domain")||"";f.removeAttribute("domain");var o=f.getAttribute("arguments")||e;f.removeAttribute("arguments");var t=f.getAttribute("menu")||j;f.removeAttribute("menu");var r=f.getAttribute("title")||"";f.removeAttribute("title");var s=i.isURL(),u=f.getAttribute("class")||"";f.removeAttribute("class");var v=f.getAttribute("id")||
"";f.removeAttribute("id");if(p||s){i=!s?"data/"+i:i;p=p||"_blank";g=g||i}else{s=f.getAttribute("type")||k||"";f.removeAttribute("type");i=m=="in"||i.charAt(0)=="#"?i.charAt(0)=="#"?i:"#"+i:"#page="+i;g=g||i;o=o?"&"+o.replace(/[ ,]+/g,"&amp;"):"";s=s?"&type="+s:"";t=miniLOL.menu.enabled()&&t?"&amp;menu="+t:"";p="";if(r)r=r.interpolate({text:g,url:i,href:i,src:i});r=r?"&title="+encodeURIComponent(r):"";i=i+o+s+t+r}n+=miniLOL.theme.template.list[h].link.interpolate(Object.extend(Object.fromAttributes(f.attributes),
{"class":u,id:v,attributes:String.fromAttributes(f.attributes),before:miniLOL.theme.template.list[h].before.interpolate({data:q}),after:miniLOL.theme.template.list[h].after.interpolate({data:l}),url:i,src:i,href:i,target:p,text:g,title:r}))}else if(g.nodeName=="item"){f=g.cloneNode(true);g=f.getAttribute("text")||"";f.removeAttribute("text");q=f.getAttribute("before")||c||"";f.removeAttribute("before");l=f.getAttribute("after")||d||"";f.removeAttribute("after");i=f.getAttribute("class")||"";f.removeAttribute("class");
p=f.getAttribute("id")||"";f.removeAttribute("id");n+=miniLOL.theme.template.list[h].item.interpolate(Object.extend(Object.fromAttributes(f.attributes),{"class":i,id:p,attributes:String.fromAttributes(f.attributes),before:miniLOL.theme.template.list[h].before.interpolate({data:q}),after:miniLOL.theme.template.list[h].after.interpolate({data:l}),text:g}))}else if(g.nodeName=="list")n+=miniLOL.page.parse({childNodes:[g]},[b]);else{if(g.nodeName=="nest"){toParse=g.cloneNode(true);n+=miniLOL.theme.template.list[h].nest.interpolate({"class":g.getAttribute("class")||
"",style:g.getAttribute("style")||"",before:miniLOL.theme.template.list[h].before.interpolate({data:q}),after:miniLOL.theme.template.list[h].after.interpolate({data:l}),data:miniLOL.page.parse(toParse,[b])})}}else if(g.nodeType==Node.CDATA_SECTION_NODE||g.nodeType==Node.TEXT_NODE)if(g.nodeValue.replace(/[\s\n]+/g,""))n+=miniLOL.theme.template.list[h].data.interpolate({before:miniLOL.theme.template.list[h].before.interpolate({data:q}),after:miniLOL.theme.template.list[h].after.interpolate({data:l}),
data:g.nodeValue})});return miniLOL.theme.template.list[h].global.interpolate(Object.extend(Object.fromAttributes(b.attributes),{attributes:String.fromAttributes(b.attributes),data:n}))},include:function(b){b=b.cloneNode(false);var a=b.getAttribute("href");b.removeAttribute("href");b.getAttribute("update");b.removeAttribute("update");var c=location.href.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/)[3],d=a.match(/^http(s)?:\/\/(.*?)([^\.]\.\w+)/);d&&d[3]!=c&&'<iframe src="#{href}" #{attributes}></iframe>'.interpolate({href:a,
attributes:Object.fromAttributes(b.attributes)});return""}},parse:function(b,a){var c="";$A(b.childNodes).each(function(d){switch(d.nodeType){case Node.ELEMENT_NODE:if(Object.isFunction(miniLOL.page.parsers[d.nodeName]))c+=miniLOL.page.parsers[d.nodeName](d,a);break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:c+=d.nodeValue;break}});return c},load:function(b,a,c){miniLOL.content.set(miniLOL.config.core.loadingMessage);Event.fire(document,":page.load",{path:b,queries:a});if(c){var d={};Object.extend(d,
miniLOL.config.core);Object.extend(d,a);document.title=(a.title||miniLOL.config.core.siteTitle).interpolate(d)}new Ajax.Request("data/#{path}?#{queries}".interpolate({path:b,queries:Object.toQuery(a)}),{method:"get",onSuccess:function(e){miniLOL.functions[a.type]?miniLOL.content.set(miniLOL.functions[a.type](e.responseText,a)):miniLOL.content.set(e.responseText);Event.fire(document,":page.loaded",e);Event.fire(document,":go",c)},onFailure:function(e){miniLOL.content.set("#{status} - #{statusText}".interpolate(e));
Event.fire(document,":page.loaded",e)}})}},module:{create:function(b,a){if(!a){miniLOL.error("Like, do I know how this module is done?");return false}a.name=b;a.root="#{path}/#{module}".interpolate({path:miniLOL.module.path,module:b});if(!a.type)a.type="active";if(!a.execute)a.execute=new Function;for(var c in a)if(Object.isFunction(a[c]))a[c]=a[c].bind(a);if(a.initialize)try{if(a.initialize()===false){if(miniLOL.error())return false;throw new Error("An error occurred while initializing the module.");
}}catch(d){d.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,module:b});throw d;}miniLOL.modules[b]=a;if(a.aliases)for(c=0;c<a.aliases.length;c++)miniLOL.modules[a.aliases[c]]=a;Event.fire(document,":module.create",a)},execute:function(b,a,c){if(!b){miniLOL.error("What module should be executed?");return false}if(!miniLOL.module.exists(b)){c&&miniLOL.error("The module `#{name}` isn't loaded.".interpolate({name:b}),miniLOL.theme.content(),true);
return false}if(c){miniLOL.content.set(miniLOL.config.core.loadingMessage);c={};Object.extend(c,miniLOL.config.core);Object.extend(c,a);document.title=(a.title||miniLOL.module.get(b).title||miniLOL.config.core.siteTitle).interpolate(c)}a=Object.isArray(a)?a:[a];Event.fire(document,":module.execute",{name:b,arguments:a});var d;try{d=miniLOL.module.get(b).execute.apply(miniLOL.module.get(b),a)}catch(e){e.fileName="#{root}/#{path}/#{module}/main.js".interpolate({root:miniLOL.path,path:miniLOL.module.path,
module:b});miniLOL.error("An error occurred while executing the module `#{name}`\n\n#{file} @ #{line}:\n#{error}".interpolate({name:b,file:e.fileName,line:e.lineNumber,error:e.toString()}),miniLOL.theme.content());return false}Event.fire(document,":module.executed",{name:b,arguments:a,result:d});if(Object.isUndefined(d))d=true;return d},load:function(b){Event.fire(document,":module.load",b);try{miniLOL.utils.require("#{path}/#{module}/main.js".interpolate({path:miniLOL.module.path,module:b}));if(miniLOL.error())return false;
if(!miniLOL.module.exists(b))throw new Error("Something went wrong while loading the module `#{name}`.".interpolate({name:b}));Event.fire(document,":module.loaded",b);return true}catch(a){miniLOL.error("An error occurred while loading the module `#{name}`\n\n#{root}/#{file} @ #{line}:\n\n#{error}".interpolate({name:b,root:miniLOL.path,file:a.fileName,line:a.lineNumber,error:a.toString()}),miniLOL.theme.content());return false}},get:function(b){return miniLOL.modules[b]},exists:function(b){return Boolean(miniLOL.module.get(b))},
dependencies:{check:function(){for(var b in miniLOL.modules){var a=miniLOL.module.get(b).dependencies;if(a)for(var c=0;c<a.length;c++)if(!miniLOL.module.get(a[c]))throw{module:b,require:a[c]};}return true},needs:function(b,a,c,d){miniLOL.module.get(b)?a.call(c||window):setTimeout(function(){miniLOL.module.dependencies.needs(b,a,c)},d||10)}}},go:function(b){if(!b.startsWith(miniLOL.path)&&b.isURL()){location.href=b;return true}var a=b.parseQuery(),c=/#(([^=&]*)&|([^=&]*)$)/.exec(b),d=false;a.menu&&
miniLOL.menu.change(a.menu);if(c){a.page=c[2]||c[1];d=a.page&&a.page!="&"?miniLOL.page.get(a.page,a,b):miniLOL.go("#{page}&#{queries}".interpolate({page:miniLOL.config.core.homePage,queries:Object.toQuery(a)}))}else if(a.module)d=miniLOL.module.execute(a.module,a,true);else if(a.page){c=a.page;delete a.page;miniLOL.page.load(c,a,b)}else d=miniLOL.go(miniLOL.config.core.homePage);d&&Event.fire(document,":go",b);return d},utils:{getElementById:function(b){for(var a=this.getElementsByTagName("*"),c=
0;c<a.length;c++)if(a[c].getAttribute("id")==b)return a[c]},fixDOM:function(b){if(!b||Prototype.Browser.Good)return b;if(Prototype.Browser.IE){var a=b;b={};b._real=a;b.documentElement=a.documentElement;b.getElementsByTagName=function(c){return this._real.getElementsByTagName(c)};b.getElementById=function(c){return miniLOL.utils.getElementById.call(this._real,c)}}else b.getElementById=miniLOL.utils.getElementById;return b},checkXML:function(b,a){var c=false;b||(c="There's a syntax error.");if(b.documentElement.nodeName==
"parsererror")c=b.documentElement.textContent;if(a&&c){miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:a,error:c}));return c}return c},getFirstText:function(b){for(var a=0;a<b.length;a++)switch(b[a].nodeType){case Node.ELEMENT_NODE:return"";case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(b[a].nodeValue.replace(/[\s\n]/g,""))return b[a].nodeValue;break}return""},fileExists:function(b){var a=false;new Ajax.Request(b,{method:"head",asynchronous:false,onSuccess:function(){a=
true}});return a},includeCSS:function(b){var a=miniLOL.utils.fileExists(b);if(a){a=new Element("link",{rel:"stylesheet",href:b,type:"text/css"});$$("head")[0].insert(a)}return a},include:function(b){var a=null;new Ajax.Request(b,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(c){try{a=window.eval(c.responseText)}catch(d){}}});return a},require:function(b){var a,c;new Ajax.Request(b,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(d){try{a=window.eval(d.responseText)}catch(e){c=
e;c.fileName=b;c.lineNumber-=5}},onFailure:function(d){c=new Error("Failed to retrieve the file (#{status} - #{statusText}).".interpolate(d));c.fileName=b;c.lineNumber=0}});if(c)throw c;return a}}};
miniLOL.Resource=Class.create({initialize:function(b,a){if(!a)throw new Error("No wrapper has been passed.");this._name=b;this._wrapper=a;if(!this._wrapper.clear)this._wrapper.clear=function(){this._data={}};for(var c in this._wrapper)if(Object.isFunction(this._wrapper[c])){if(this._wrapper[c]._parent==this._wrapper)break;this._wrapper[c]=this._wrapper[c].bind(this._wrapper);this._wrapper[c]._parent=this._wrapper}this.clear();this.flush();this._wrapper.initialize&&this._wrapper.initialize()},load:function(){var b,
a=$A(arguments);Event.fire(document,":resource.load",{name:this._name,arguments:a});this._calls.push(a);try{b=this._wrapper.load.apply(this._wrapper,a)}catch(c){miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this._name,error:c.toString()}),miniLOL.theme.content());return false}Event.fire(document,":resource.loaded",{name:this._name,arguments:a});return b},reload:function(){Event.fire(document,":resource.reload",{name:this._name});this._wrapper.clear();for(var b=
this.flush(),a=0;a<b.length;a++)this.load.apply(this,b[a]);Event.fire(document,":resource.reloaded",{name:this._name})},clear:function(){Event.fire(document,":resource.clear",{name:this._name});this._wrapper.clear()},flush:function(b){Event.fire(document,":resource.flush",{name:this._name,call:b});var a;if(Object.isArray(b)){if(a=this._calls.find(function(c){if(c.length!=b.length)return false;for(var d=false,e=0;e<c.length;e++){if(b[e]==c[e])d=true;if(!d)break}return d}))this._calls=this._calls.filter(function(c){return c!=
a})}else{a=this._calls;this._calls=[]}return a},data:function(){return this._wrapper._data}});unFocus.History.addEventListener("historyChange",function(b){if(b){if(b.charAt(0)!="#")b="#"+b;miniLOL.go(b)}else miniLOL.go(miniLOL.config.core.homePage);miniLOL.theme.content().scrollTop=0});if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=true;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=true;
if(Prototype.Browser.Gecko||Prototype.Browser.Opera)Prototype.Browser.Good=true;else Prototype.Browser.Bad=true;
if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:this.stack.replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,
"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};Function.prototype.clone=Prototype.Browser.IE?function(){var b=this.toString();return new Function(b.substring(b.indexOf("{")+1,b.lastIndexOf("}")))}:function(){return eval("("+this.toString().replace(/^function .*?\(/,"function (")+")")};
Object.extend(Object,{isBoolean:function(b){return b.constructor===Boolean},fromAttributes:function(b){for(var a={},c=0;c<b.length;c++)a[b.item(c).nodeName]=b.item(c).nodeName;return a},toQuery:function(b){var a="";for(var c in b)a+="#{name}=#{value}&".interpolate({name:c,value:b[c]});return a.substr(0,a.length-1)}});Object.extend(String,{fromAttributes:function(b){for(var a="",c=0;c<b.length;c++)a+='#{name}="#{value}" '.interpolate({name:b.item(c).nodeName,value:b.item(c).nodeValue});return a}});
Object.extend(String.prototype,{parseQuery:function(){var b={},a=this.match(/[?#](.*)$/);if(!a)return b;a=a[1].split(/&/);for(var c=0;c<a.length;c++){var d=a[c].split(/=/),e=decodeURIComponent(d[0]);b[e]=d[1]?decodeURIComponent(d[1]):true}return b},isURL:function(){var b=this.match(/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/);if(b)return{protocol:"mailto",uri:b[1]};b=this.match(/^(\w+):(\/\/.+?(:\d)?)(\/)?/);if(!b)return false;return{protocol:b[1],uri:b[2]}}});
Element.addMethods({load:function(b,a){if(a&&!Object.isUndefined(a.frequency))new Ajax.PeriodicalUpdater(this,b,a);else new Ajax.Updater(this,b,a)},getTextDescendants:function(b){function a(d){for(d=d.firstChild;d;){Node.TEXT_NODE==d.nodeType&&c.push(d);Object.isElement(d)&&a(d);d=d.nextSibling}}var c=[];a(b);return c}});
